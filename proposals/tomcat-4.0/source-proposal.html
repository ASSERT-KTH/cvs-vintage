<html>
<head>
<title>Proposal for Tomcat 4.0 Source Code Organization</title>
</head>
<body bgcolor="white">

<div align="center">
<h1>Proposal for Tomcat 4.0 Source Code Organization</h1>
<h2>$Id: source-proposal.html,v 1.1 2000/08/09 05:50:41 craigmcc Exp $</h2>
</div>


<h2>Introduction</h2>

<p>Once Sun announced the contribution of the source code for the Java
Server Web Development Kit (JSWDK) at JavaOne in 1999, the primary focus
was on delivering code that was functionally complete, and could be built.
Little attention was expended to creating a source code module and directory
organization that made it easy to manage the concurrent development of
maintenance and enhancement support on an existing major version of the
software, while simultaneously supporting development on a new major version.
</p>

<p>In addition, all of the code was placed in a single CVS module, and the
source code for logically distinct components of the overall Tomcat suite
were intermixed.  Also, the build scripts were optimized to create an entire
Tomcat distribution, with no provision for creating subsets of the entire
suite when all of the components are not required.</p>

<p>This proposal describes an overall CVS module and source code organization
designed to facilitate continued support of the existing Tomcat 3.x code base
(in the current CVS module), while setting up a development environment for the
next major version of Tomcat (version 4.0) that will, among other things,
incorporate support for the new Servlet 2.3 and JSP 1.2 specifications, which
will enter their public review periods shortly.</p>

<p>Implementing the new source code organization described by this proposal
has many advantages, including the following:</p>
<ul>
<li>Support and enhancement of the existing Tomcat 3.x code base can continue
    uninterrupted, without disruptions caused by development on the next major
    version.  This is important because many developers (and server vendors)
    have adopted Tomcat 3.x (or plan to adopt Tomcat 3.2 shortly) into their
    environments, and will need continued support until they choose to migrate
    to Tomcat 4.x at some future date.</li>
<li>Work to integrate support for the new features of the Servlet 2.3 and
    JSP 1.2 specifications can begin immediately, without concern about
    compromising the existing Tomcat builds.</li>
<li>The proposed source code organization clearly separates the various
    components of Tomcat into logically distinct subdirectory structures,
    which are almost completely self contained.  This will facilitate
    understanding (especially for new developers) by supporting focus on
    one component at a time.</li>
<li>The components of Tomcat can be built individually by utilizing the build
    scripts within the corresponding subdirectories, while complete or subset
    distributions can be created by using the build scripts in the top
    level directory.</li>
</ul>

<p>Note that the proposed directory structure (see following section) assumes
that the proposal to use Catalina as the source code base for the servlet
container component of Tomcat is accepted.</p>

<p>There are precedents for the proposed CVS organization at several levels
within the Apache universe.  Among these precedents are:</p>
<ul>
<li>Separation of the source trees of the Apache web server itself, based
    on the major version (1.2, 1.3, and 2.0).</li>
<li>Organization of a particular project into cooperating subprojects where
    you can build just the subprojects you need, or the entire suite, as
    is done in the <code>jakarta-taglibs</code> project.</li>
</ul>

<p>Given those precedents, it is also be appropriate to rename the current
CVS repository module from <code>jakarta-tomcat</code> to
<code>jakarta-tomcat-3.0</code>, to make clear the scope of the code that
is contained within it.</p>


<h2>Proposed Source CVS Modules</h2>

<p>This proposal envisions that there will be three top-level CVS modules
visible in the Apache CVS repository:</p>
</ul>
<li><strong><code>jakarta-servletapi</code></strong> - The existing module
    containing the servlet API implementation classes for the "current" and
    "under development" versions of the servlet and JSP specifications.</li>
<li><strong><code>jakarta-tomcat-3.0</code></strong> - The existing module
    containing the source code for use in supporting and enhancing the
    Tomcat 3.x code base as long as is required, renamed for consistency.</li>
<li><strong><code>jakarta-tomcat-4.0</code></strong> - A new module containing
    the code for the next major release of Tomcat, which will be based on the
    Catalina and Jasper proposals, and organized as described below.</li>
</ul>


<h3>The <code>jakarta-servletapi</code> Module</h3>

<p>The <code>jakarta-servletapi</code> module was separated from the Tomcat
module several months ago, to provide an easily accessible means for anyone
who needs them to acquire and build a set of classes that conform to the
servlet and JSP specifications.  It is proposed that this module continue to
be used for this purpose, according to the following policies:</p>
<ul>
<li>At any point in time, the main branch of <code>jakarta-servletapi</code>
    will be the servlet and JSP implementation classes for the currently
    final versions of the specifications (2.2 and 1.1, respectively, at the
    time of this writing).</li>
<li>From time to time, errata to the servlet and JSP specifications will be
    published.  In some cases, errata will include changes to the servlet
    and JSP classes, or their corresponding Javadocs.  Such changes will be
    marked with a CVS tag that corresponds to the errata version(s) that
    include it (errata to a particular specification are cumulative), so that
    users can conveniently request the classes that correspond to the original
    specs, or to any particular errata that have been subsequently published.
<li>When new specifications are released for initial public review, a branch
    in this module will be created (starting from the most recent classes
    for the current official specifications), on which the changes required
    by the new specification versions will be committed.</li>
<li>As errata or revised specification drafts are published for the new
    specification versions, tags will be used to match classes to document
    versions in a manner similar to that described for errata to the current
    final specifications.</li>
<li>When the new specification becomes final, the old "main" branch will be
    migrated to an archival branch (which now represents the previous versions
    of the specification), and the branch used for the specs under development
    will become the main line branch.</li>
</ul>

<p>Note that, although this is a separate CVS source module, it is part of the
Tomcat project from an administrative viewpoint.  Among other things, this
means that anyone who is a committer for the <code>jakarta-tomcat</code>
module may have commit access to <code>jakarta-servletapi</code> as well by
simply asking -- no vote is required.</p>


<h3>The <code>jakarta-tomcat-3.0</code> Module</h3>

<p>The existing <code>jakarta-tomcat</code> module is proposed to continue
as it currently exists (except for being renamed), for use in supporting the
Tomcat 3.x code base for as long as this is appropriate.</p>

<p>The <code>proposals/catalina</code> directory in this module will be
abandoned once the conversions and imports have been performed into the
"catalina" subdirectory of the new CVS module described in the following
section.</p>


<h3>The <code>jakarta-tomcat-4.0</code> Module</h3>

<p>A new module will be created to contain the source code for what will
ultimately be distributed as Tomcat 4.0.  Besides separating the development
of this code from maintenance on the existing Tomcat version, creating a new
module offers us the opportunity to organize the new source code in a modular
manner, and facilitates building only those portions of the entire Tomcat
suite that a particular developer is interested in.</p>

<p>Note that, although this is a separate CVS source module, it is part of the
Tomcat project from an administrative viewpoint.  Among other things, this
means that anyone who is a committer for the current
<code>jakarta-tomcat</code> module will automatically be granted committer
access to the <code>jakarta-tomcat-4.0</code> module as well.</p>

<p>The top level directory in this module shall contain subdirectories for
each major component of Tomcat (as described below), plus build scripts that
are used to integrate the major components with required external components,
and produce distributions.  It shall be possible to build at least the
following distribution targets:</p>
<ul>
<li>The entire Tomcat suite, including servlet container, JSP support, and
    included web applications, pretty much equivalent to the
    <code>build dist</code> target of the current Tomcat module.</li>
<li>A minimal servlet container, with no JSP support and no included web
    applications.</li>
<li>A distribution of the JSP environment suitable for use on any
    servlet container compatible with the 2.3 specification.</li>
<li>A distribution of the web applications that are currently included in
    the official Tomcat distribution (root, examples, and so on).</li>
<li>A web application distribution of the user (and system administrator)
    documentation related to installing and configuring the entire Tomcat
    suite.</li>
<li>A web application distribution containing developer oriented documentation
    (and Javadoc API files) for the entire Tomcat suite.</li>
</ul>

<p>To support these goals, the following directory structure (within the
<code>jakarta-tomcat-4.0</code> module) is proposed:</p>
<pre>
jakarta-tomcat-4.0/

    README                               Overall installation and build
                                         instructions, and description of the
					 source module directory structure

    build.bat, build.sh, build.xml       Convenience build scripts that
                                         construct the distributions
					 described above, relying on the
					 build scripts in each subdirectory
					 for the detailed work

    admin/				 ADMINISTRATIVE WEB APPLICATION
        build.bat, build.sh, build.xml	 Build scripts
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        admin/
        web/		                 Static resources (html, jsp, etc.)
	    WEB-INF/			 Configuration files (web.xml, etc.)

    catalina/                            SERVLET CONTAINER
        build.bat, build.sh, build.xml	 Build scripts
	bin/                             Binaries and shell scripts
	conf/				 Configuration files
	doc/
	    developer/                   Developer documentation
	    user/                        User and administrator documentation
	src/                             Java source code
	    org/
	        apache/
		    catalina/
		    
    common/                              COMMONLY USED COMPONENTS 
                                         (such as XmlMapper)
        bin/				 Binaries and shell scripts
	conf/				 Configuration files
	doc/
	    developer/                   Developer documentation
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        common/

    examples/				 EXAMPLES WEB APPLICATION
        build.bat, build.sh, build.xml	 Build scripts
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        examples/
        web/		                 Static resources (html, jsp, etc.)
	    WEB-INF/			 Configuration files (web.xml, etc.)

    jasper/                              JSP COMPILER AND RUNTIME SYSTEM
        build.bat, build.sh, build.xml	 Build scripts
	bin/                             Binaries and shell scripts
	conf/				 Configuration files
	doc/
	    developer/                   Developer documentation
	    user/                        User documentation
	src/                             Java source code
	    org/
	        apache/
		    jasper/

    native/	                         NATIVE C CODE COMPONENTS
        Makefile                         Make file to build all of the
	                                 native components
        aolserver/			 AOLserver integration
        apache/				 Generic Apache integration
	apache1.3/			 Apache 1.3 integration
	apache2.0/			 Apache 2.0 integration
	iis/                             Microsoft IIS integration
	jk/                              Common integration libraries
	jni_connect/			 Common integration libraries
	netscape/                        Netscape/iPlanet integration
	nt_service/                      "Install As NT Service" application

    root/				 ROOT WEB APPLICATION
        build.bat, build.sh, build.xml	 Build scripts
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        examples/
        web/		                 Static resources (html, jsp, etc.)
	    WEB-INF/			 Configuration files (web.xml, etc.)

    test/				 TEST WEB APPLICATION
        build.bat, build.sh, build.xml	 Build scripts
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        examples/
        web/		                 Static resources (html, jsp, etc.)
	    WEB-INF/			 Configuration files (web.xml, etc.)

    webdav/                              WEBDAV WEB APPLICATION
        build.bat, build.sh, build.xml   Build scripts
	src/                             Java source code
	    org/
	        apache/
		    tomcat/
		        webdav/
        web/		                 Static resources (html, jsp, etc.)
	    WEB-INF/			 Configuration files (web.xml, etc.)

</pre>

</body>
</html>

