                              Apache Tomcat 3.3.1
                              ===================
                                 Release Notes
                                 =============

$Id: RELEASE-NOTES-3.3.1.txt,v 1.19 2002/01/08 00:49:24 larryi Exp $


This document describes the changes that have been made since the
last release of Tomcat 3.3.

=========
Bug Fixes
=========

Feature Additions:

Bug No.  Description

         Restored prefix attribute to InvokerInterceptor.  It was available in
         Tomcat 3.2.x.

         Added SingleThreadModel pooling to ServletHandler.  The default is to
         use pooling.

         Added optional checking (configured on SessionId module) to ensure
         that the SSL session IDs match for each request within a Tomcat
         session.  This check is disabled by default.

         Added org.apache.tomcat.util.net.URL class from Tomcat 4.0 so
         response.encodeURL() can work under SSL without JSSE.  This can occur
         if you have Apache forwarding SSL requests to a Tomcat that doesn't
         have JSSE installed.

	 Fixed logic for response.encodeURL() so that it will work correctly 
	 if the input URL includes an anchor tag.

	 Improved the handling of invalid web.xml files.  Now you get the same
	 error messages every time you parse the file.

	 Moved the setting of the default "*.jsp" mapping so that it is now 
	 possible to entirely disable support for jsp files.

	 Fixed problem with jsp_precompile parameter to JSP files.

         Context properties and ContextManager properties can now be set with
         <Property ... /> elements, i.e: 
             <Property name="propname" value="thevalue" />
         For backwards compatibility, the ContextManager "lower-case-p"
         <property ... /> version supported by Tomcat 3.3. is still supported.

         Added variable substitution handling to ContextXmlReader, allowing
         variable substitution to be used in <Context ...></Context>
         declarations.

	 Added support for PureTLS as an SSL option.

         The configuration files generated by ApacheConfig, IISConfig and
         NSConfig were improved for the case when the forwardAll attribute
         is false. Primarily, a servlet mapping like "/foo/*" now generates
         a mod_jk mapping for "/foo" as well as "/foo/*" to better match
         the servlet spec.

         The default log handler was updated to specify autoFlush=true for
         the PrintWriter so the output doesn't just go to a buffer.  Since
         this logger is replaced a new logger set by the LogSetter module,
         its reduction in efficiency won't affect normal operation.

         ServerXmlReader now logs a warning if the modules.xml file isn't
         found.

         The internal test script, test-tomcat.xml, has been made more
         configurable and the Admin app internal test page, test.jsp, has
         been updated to make use of this.  With appropriate input settings,
         the tests can be run against Tomcat standalone, Apache, IIS, and
         Netscape (v4.1) without and failures.

         Japanese resource strings were added and StaticInterceptor and
         ErrorHandler modules were updated to take advantage of them.  In
         addition, useAcceptLanguage and useCharset attributes were added
         to the StaticInterceptor module to allow configuration of how
         the locale and character set encoding of the directory listings
         are derived.

         Added a delaySocketClose attribute to Http10Interceptor.  The
         default is false.  If set true, a Thread.sleep(0) is executed
         before the socket is closed.  This was needed by Cactus when
         run on a high powered Windows XP box.  The sleep(0) helps ensure
         the test get a chance to receive its input before the socket
         is closed.  Otherwise, "Socket reset by peer" errors occur.


Server:

Bug No.  Description

4418     Ported Tomcat 3.2.x fix for race condition in ServerSocketFactory.

4436     Reduce log output from DecodeInterceptor if debug level is zero.  This
         avoids having a log entry for each request.

4564     Fix bug in Http10Interceptor where getRemoteAddr() returns 127.0.0.1
         instead of correct address.

4599     ThreadPool was updated to not reset the maxThreads, maxSpareThreads
         and minSpareThreads values in its start() method.

         Fixed problem in AccessInterceptor where the beginning characters
         of the login or error page match the context path.  Tomcat could
         mistakenly think that the context path had been incorrectly included
         in the login or error page setting.  It can still make this mistake
         if the page is under a sub-directory with the same name as the
         context path.
         
         The missing jdbcRealm.getCredentialsSQLException property string was
         added.

         Fixed bug with useJspServlet option in JspInterceptor.  If set to true
         untrusted web applications couldn't run the JspServlet because
         jasper.jar and tools.jar weren't accessible.

4955	 Fixed bug in the parsing of the query string to 
	 RequestDispatcher.include/forward wasn't handling the case where only
	 the parameter name was specified.

4948	 Fix DependClassLoader to be a Java2 ClassLoader when running under
	 a Java2 JVM.  

5005     If requested JSP file doesn't exist, avoid creating work directories
         and version file.

	 Fixed problem with jsp_precompile parameter to JSP files.

         Eliminated some hard coded '\n' line separators used by Jasper in the
         translated Java file.

	 Fixed the position of the ;jsessionid when Tomcat generates a 401 
	 response.  Now it is before the query string instead of after.

5497	 Ignore the If-Modified-Since header when including a static page.

	 Do not return a body with 304 responses (forbidden by HTTP/1.x and
	 confusing to NS < 6.x).

         HttpServletRequestFacade now resets the reader when recycled.
         Previously, calling getReader() on a recycled facade on which
         getReader() was called, you would get the old reader rather than
         a new reader for the current request.


Configuration:

Bug No.  Description

4313     Bug in property substitution for server.xml and apps.xml files was
         fixed.

4826     Fixed AutoWebApp so the dir attribute can be an absolute path on
         Windows systems.

5390	 Fixed the behavior of LoadOnStartup servlets when the servlet is
	 actually a JSP page.

5365	 Fixed the JasperMangler to handle Java reserved words correctly.


Connectors:

         A bug was fixed in isapi_redirect.dll where it would mistake an
         encoded '?' in the URI path as the query string delimitor.


Documentation:

Bug No.  Description

         Tomcat-on-NetWare-HowTo.html updated to fix errors related to new
         functionality in Tomcat 3.3.

         tomcat-ug.html updated with additional classloader information and
         details on the variable substitution available in Context
         declarations.
     
         serverxml.html updated to document new checkSSLSessionId attribute on
         SessionId module.  A note was added to Ajp12Connector to document the
         requirement for maxThreads to be 2 or more if it is to be used to
         shutdown Tomcat.  Section on variable substitution was updated.

         tomcat-iis-howto.html updated to make it clearer that the "Filter Dlls"
         key is used only on Win98.

         JDBCRealm-howto.html updated to name the correct class and its jar
         location for digested passwords.
