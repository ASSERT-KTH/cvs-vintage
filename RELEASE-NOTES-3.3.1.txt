                              Apache Tomcat 3.3.1
                              ===================
                                 Release Notes
                                 =============

$Id: RELEASE-NOTES-3.3.1.txt,v 1.35 2002/02/15 02:47:14 billbarker Exp $


This document describes the changes that have been made since the
last release of Tomcat 3.3.

=========
Bug Fixes
=========

Feature Additions:

Bug No.  Description

         Restored prefix attribute to InvokerInterceptor.  It was available in
         Tomcat 3.2.x.

         Added SingleThreadModel pooling to ServletHandler.  The default is to
         use pooling.

         Added optional checking (configured on SessionId module) to ensure
         that the SSL session IDs match for each request within a Tomcat
         session.  This check is disabled by default.

         Added org.apache.tomcat.util.net.URL class from Tomcat 4.0 so
         response.encodeURL() can work under SSL without JSSE.  This can occur
         if you have Apache forwarding SSL requests to a Tomcat that doesn't
         have JSSE installed.

	 Fixed logic for response.encodeURL() so that it will work correctly 
	 if the input URL includes an anchor tag.

	 Improved the handling of invalid web.xml files.  Now you get the same
	 error messages every time you parse the file.

	 Moved the setting of the default "*.jsp" mapping so that it is now 
	 possible to entirely disable support for jsp files.

	 Fixed problem with jsp_precompile parameter to JSP files.

         Context properties and ContextManager properties can now be set with
         <Property ... /> elements, i.e: 
             <Property name="propname" value="thevalue" />
         For backwards compatibility, the ContextManager "lower-case-p"
         <property ... /> version supported by Tomcat 3.3. is still supported.

         Added variable substitution handling to ContextXmlReader, allowing
         variable substitution to be used in <Context ...></Context>
         declarations.

	 Added support for PureTLS as an SSL option.  Also, any attribute
         used to create the socket factory, such as "rootfile" (or
         "keystoreType" for JSSE), is now settable on the Http10Connector
         element in server.xml.

         The configuration files generated by ApacheConfig, IISConfig and
         NSConfig were improved for the case when the forwardAll attribute
         is false. Primarily, a servlet mapping like "/foo/*" now generates
         a mod_jk mapping for "/foo" as well as "/foo/*" to better match
         the servlet spec.

         The default log handler was updated to specify autoFlush=true for
         the PrintWriter so the output doesn't just go to a buffer.  Since
         this logger is replaced a new logger set by the LogSetter module,
         its reduction in efficiency won't affect normal operation.

         ServerXmlReader now logs a warning if the modules.xml file isn't
         found.

         The internal test script, test-tomcat.xml, has been made more
         configurable and the Admin app internal test page, test.jsp, has
         been updated to make use of this.  With appropriate input settings,
         the tests can be run against Tomcat standalone, Apache, IIS, and
         Netscape (v4.1) without any failures.

         Japanese resource strings were added and StaticInterceptor and
         ErrorHandler modules were updated to take advantage of them.  In
         addition, useAcceptLanguage and useCharset attributes were added
         to the StaticInterceptor module to allow configuration of how
         the locale and character set encoding of the directory listings
         are derived.

         Added a socketCloseDelay attribute to Http10Interceptor.  The
         default is -1, which disables the delay.  If set > 0, a
         Thread.sleep(<delay>) is executed prior to reading and discarding
         unread input and closing the socket.  This is intended to
         help diagnose problems resulting from unread input that
         arrives during the closing of the socket.

	 Make the App-classloader configurable to allow using the 1.1
	 loader even when running under Java2.  This should allow for better
	 jar reloading at the cost of not enforcing sealing etc.  

         The IISConf module was updated to support an isapiRedirector
         attribute which specifies the name of the redirector plugin DLL.
         It also now writes a "properties" file the can be used for
         configuration of the redirector instead of registry settings.

         The isapi_redirect.dll was enhanced to support a uri_select
         configuration setting that controls which form of URL is forwarded
         to Tomcat.  The normalized/decoded URL used by Tomcat 3.3 is
         still the default.  The original URL or re-encoded normalized/decoded
         URL may be forwarded instead.  This was done to provide better
         support for isapi_redirect.dll's use with web servers other than
         Tomcat 3.3, such as Tomcat 3.2.x.

         Added a useWebAppCL attribute to JspInterceptor.  When true,
         Java compilation using "sun.tools.javac.Main" will run in the
         web application's classloader.  When false (the default), Java
         compilation using "sun.tools.javac.Main" runs in the container
         classloader.  Using a value of true may help on certain HP-UX
         systems.  In all other cases, useWebAppCL should be false.
         Currently webWebAppCL="true" can not be used when running under a
         security manager, otherwise security exceptions will prevent
         JSPs from compiling.

         Added "reloadable" attribute to AutoWebApp module.  If true,
         reloading will be enabled in all added contexts.  If false, reloading
         will be disabled.  The default is true.

         Added "defaultRedirectStatus" attribute to ErrorHandler module. It
         may be set to "301" or "302".  The default is "301".  It determines
         the status code set by the "redirect" handler if a status code has
         not already been set.  This primarily affects the status code used
         when the StaticInterceptor module redirects a "directory" URL that
         doesn't end with a '/' and redirects to welcome files.

         Added shutdown support using Ajp13 and updated StopTomcat task
         to support automatic or explicit use of Ajp12 or Ajp13 protocol to
         shutdown Tomcat.  This includes use of an optional "secret" password
         with either protocol.


Server:

Bug No.  Description

         Fixed problem with JSP page names that match a Windows DOS device
         name, such as aux.jsp.  Instead of potentially hanging the thread
         that services the request, these requests now return "404 Not Found".

         DecodeInterceptor was updated to not convert '+' to space in the
         path portion of the request URL.  RFC2396 allows '+' in the path
         of a URL.

         Modified IntrospectionUtils.getClassPath() to add "classes"
         directory to the list prior to jars.

1657     JSPs with tag names that contain '-' or '.' will now compile without
         an "Invalid expression" error

4382     tomcat.sh script no longer deletes the ajp12.id file which could
         cause a problem shutting down if Tomcat was accidentally started
         twice.

5994     Fix seconds calculation problem in DateTool

4418     Ported Tomcat 3.2.x fix for race condition in ServerSocketFactory.

4436     Reduce log output from DecodeInterceptor if debug level is zero.  This
         avoids having a log entry for each request.

4564     Fix bug in Http10Interceptor where getRemoteAddr() returns 127.0.0.1
         instead of correct address.

4599     ThreadPool was updated to not reset the maxThreads, maxSpareThreads
         and minSpareThreads values in its start() method.

         Fixed problem in AccessInterceptor where the beginning characters
         of the login or error page match the context path.  Tomcat could
         mistakenly think that the context path had been incorrectly included
         in the login or error page setting.  It can still make this mistake
         if the page is under a sub-directory with the same name as the
         context path.
         
         The missing jdbcRealm.getCredentialsSQLException property string was
         added.

         Fixed bug with useJspServlet option in JspInterceptor.  If set to true
         untrusted web applications couldn't run the JspServlet because
         jasper.jar and tools.jar weren't accessible.

4923     Default permissions were added in PolicyInterceptor to allow direct
         read access to the webapp docBase and work directories.  This is
         in addition to the permissions allowing access to the contents of
         these directories.  These new permissions allows "exists()" to be
         executed on those directories without a security exception when
         running under a security manager.

4955	 Fixed bug in the parsing of the query string to 
	 RequestDispatcher.include/forward wasn't handling the case where only
	 the parameter name was specified.

4948	 Fix DependClassLoader to be a Java2 ClassLoader when running under
	 a Java2 JVM.  

5005     If requested JSP file doesn't exist, avoid creating work directories
         and version file.

	 Fixed problem with jsp_precompile parameter to JSP files.

         Eliminated some hard coded '\n' line separators used by Jasper in the
         translated Java file.

	 Fixed the position of the ;jsessionid when Tomcat generates a 401 
	 response.  Now it is before the query string instead of after.

5497	 Ignore the If-Modified-Since header when including a static page.

	 Do not return a body with 304 responses (forbidden by HTTP/1.x and
	 confusing to NS < 6.x).

         HttpServletRequestFacade now resets the reader when recycled.
         Previously, calling getReader() on a recycled facade on which
         getReader() was called, you would get the old reader rather than
         a new reader for the current request.

5724	 Supress the check for WEB-INF in the "Default Servlet" (aka 
	 StaticInterceptor).  The check was redundant, and was causing
	 Spec problems.

5191	 Fix parsing of JSP comments with extra '-' characters.

5983	 Fix the flushing of unread POST data on the HTTP connector.  On the
	 reported bug, it was mostly a nuisance.  In other cases (see 6143)
	 it was causing major problems.  To avoid DOS attacks, the number
         of flush attempts is configurable, with a default of 20.

6234	 Recycle the Writer in the ResponseFacade if it is the error state when
	 the facade is recycled.

6348     Fix problem with getNamedDispatcher() when used with a JSP mapped
         in the web.xml.


Configuration:

Bug No.  Description

4313     Bug in property substitution for server.xml and apps.xml files was
         fixed.

4826     Fixed AutoWebApp so the dir attribute can be an absolute path on
         Windows systems.

5390	 Fixed the behavior of LoadOnStartup servlets when the servlet is
	 actually a JSP page.

5365	 Fixed the JasperMangler to handle Java reserved words correctly.

5958     ApacheConfig, IISConfig, and NSConfig were updated so mappings that
         end with "/*" will write a mapping with and without the ending "/*".

6004     Updated Http10Connector to accept any attribute.  The attributes
         without predefined setters will be included with the predefined
         ones that are made available when the secure socket factory is
         created.

         Updated JSSEImplemention to support a separate keystorePass
         attribute as the keystore password.  It will default to the keypass
         attribute if not set.

6137     Fix the admin webapp to be more careful when using the remove-context
	 feature.  Also, the boxes were mis-labeled.

6341	 Fix the "guess home" logic so that it can work on Mac OS

Connectors:

         A bug was fixed in isapi_redirect.dll where it would mistake an
         encoded '?' in the URI path as the query string delimitor.


Documentation:

Bug No.  Description

         Tomcat-on-NetWare-HowTo.html updated to fix errors related to new
         functionality in Tomcat 3.3.

         tomcat-ug.html updated with additional classloader information and
         details on the variable substitution available in Context
         declarations.
     
         serverxml.html updated to document new checkSSLSessionId attribute on
         SessionId module.  A note was added to Ajp12Connector to document the
         requirement for maxThreads to be 2 or more if it is to be used to
         shutdown Tomcat.  Section on variable substitution was updated.

         tomcat-iis-howto.html updated to make it clearer that the "Filter Dlls"
         key is used only on Win98.

         JDBCRealm-howto.html updated to name the correct class and its jar
         location for digested passwords.
