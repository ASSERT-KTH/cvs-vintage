<?xml version="1.0"?>

<!-- Build file for Scarab -->

<project name="Scarab" default="compile" basedir=".">

    <!-- Allow the user to have multiple configuration files and
         specify them using -Dscarab.build.configuration=filename -->
    <property name="configuration.file" value="build.properties"/> 

    <!-- Give user a chance to override without editing this file
         (and without using -D arguments each time they build) -->
    <property file="${user.home}/scarab.build.properties" /> 
    <property file="${user.home}/build.properties" />
    <property file="${basedir}/${configuration.file}" />
    <property file="${basedir}/default.properties" />
    <property file="${basedir}/default.${scarab.database.type}.properties" />

    <property name="ant.home" value="."/>

    <property name="final.name" value="${project}-${version}"/>
    <property name="final.dir" value="${basedir}/../${final.name}/"/>

    <property name="src.conf.dir" value="${src.dir}/conf"/>
    <property name="www.dir" value="${src.dir}/../www"/>
    <property name="src.html.dir" value="${src.dir}/html"/>
    <property name="src.dtd.dir" value="${src.dir}/dtd"/>
    <property name="src.i18n.dir" value="${src.dir}/i18n"/>
    <property name="src.images.dir" value="${src.dir}/images"/>
    <property name="src.java.dir.scarab" value="${src.dir}/java"/>
    <property name="src.sql.dir" value="${src.dir}/sql"/>
    <property name="src.templates.dir" value="${src.dir}/templates"/>
    <property name="src.test.dir" value="${src.dir}/test"/>
    <property name="src.usecases.dir" value="${src.dir}/usecases"/>
    
    <property name="torque.dir.scarab" value="${build.src.scarab}/torque"/>
    <property name="javadoc.destdir" value="${build.project}/api"/>
    <property name="torquedoc.destdir" value="${src.html.dir}/docs"/>
    <property name="scarab.war.file" value="${build.webapps}/${scarab.context}.war"/>

    <!-- Build classpath -->
    <path id="classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar"/>
            <exclude name="**/xalan*.jar"/>
        </fileset>
        <fileset dir="${ant.home}/lib">
            <include name="**/ant*.jar"/>
        </fileset>
        <fileset dir="${tomcat.dist.dir}/common/lib">
            <include name="**/servlet*.jar"/>
        </fileset>
    </path>

    <!-- ================================================================== -->
    <!-- Check to see what optional dependencies are available              -->
    <!-- ================================================================== -->
    <target name="check_for_optional_packages">
        <available property="lucene.present"
                   classname="org.apache.lucene.document.Document">
            <classpath refid="classpath"/>
        </available>
        <available property="junit.present"
           classname="junit.framework.TestCase">
            <classpath refid="classpath"/>
        </available>
    </target>

    <!-- ================================================================== -->
    <!-- Prepares the Build directory                                       -->
    <!-- ================================================================== -->
    <target name="prepare-build-dir">

        <echo message="Build Dir: ${build.dir}"/>
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.dir}/webapps"/>
        <tstamp/>
    <echo>
  _________                         ___.    
 /   _____/ ____ _____ ____________ \_ |__  
 \_____  \_/ ___\\__  \\_  __ \__  \ | __ \ 
 /        \  \___ / __ \|  | \// __ \| \_\ \
/_______  /\___  >____  /__|  (____  /___  /
        \/     \/     \/           \/    \/ 

        [${version}-${DSTAMP}${TSTAMP}]
    </echo>

    <condition property="do-tomcat-build" value="true">
        <equals arg1="${scarab.build.tomcat}" arg2="true"/>
    </condition>

    </target>

    <!-- ================================================================== -->
    <!-- Prepares the Tomcat 4.1 directory                                  -->
    <!-- ================================================================== -->
    <target name="prepare-tomcat" depends="prepare-build-dir"
            if="do-tomcat-build">

        <!-- copy over tomcat -->
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.dir}/temp"/>
        <copy todir="${build.dir}/bin" filtering="no">
            <fileset dir="${tomcat.dist.dir}/bin"/>
        </copy>
        <copy todir="${build.dir}/common" filtering="no">
            <fileset dir="${tomcat.dist.dir}/common"/>
        </copy>
        <filter token="SCARAB_CONTEXT" value="${scarab.context}"/>
        <filter token="TOMCAT_SHUTDOWN_PORT" value="${scarab.tomcat.shutdown.port}"/>
        <filter token="TOMCAT_HTTP_PORT" value="${scarab.tomcat.http.port}"/>
        <filter token="TOMCAT_PROXY_NAME" value="${scarab.tomcat.proxy.name}"/>
        <filter token="TOMCAT_PROXY_PORT" value="${scarab.tomcat.proxy.port}"/>
        <copy todir="${build.dir}/conf" filtering="yes">
            <fileset dir="${tomcat.dist.dir}/conf"/>
        </copy>
        <!--
        <copy todir="${build.dir}/lib" filtering="no">
            <fileset dir="${tomcat.dist.dir}/lib"/>
        </copy> -->
        <copy todir="${build.dir}/server" filtering="no">
            <fileset dir="${tomcat.dist.dir}/server"/>
        </copy>
        <copy todir="${build.dir}" filtering="no">
            <fileset dir="${tomcat.dist.dir}">
                <include name="scarab.sh"/>
                <include name="scarab.bat"/>
            </fileset>
        </copy>
        <!-- no need to have two copies of this checked into CVS -->
        <copy todir="${build.dir}/server/lib" filtering="no">
             <fileset dir="${lib.dir}">
                <include name="**/jakarta-regexp*.jar"/>
            </fileset>
        </copy>
        <!-- no need to have two copies of this checked into CVS -->
        <copy todir="${build.dir}/server/lib" filtering="no">
             <fileset dir="${lib.dir}">
                <include name="**/commons-logging*.jar"/>
            </fileset>
        </copy>

        <chmod dir="${build.dir}" perm="ug+rx" includes="**/*.sh" />

        <mkdir dir="${build.dir}/logs"/>
        <mkdir dir="${build.dir}/work"/>
    </target>

    <!-- ================================================================== -->
    <!-- Prepare style.tigris.org for action                                -->
    <!-- ================================================================== -->
    <target name="style-expanded-check">
        <!-- we can check that style.zip is upToDate in order to know if
             the archive has already been expanded because it is expanded
             in the same target as it is copied to the directory -->
        <mkdir dir="${build.project}/style"/>
        <uptodate property="style.is.not.expanded"
            targetfile="${src.html.dir}/${tigris-style}.zip">
            <srcfiles dir="${build.project}/style" includes="**/*.css"/>
        </uptodate>    
    </target>

    <target name="style-init" depends="style-expanded-check"
            if="style.is.not.expanded">
        <unzip src="${src.html.dir}/${tigris-style}.zip" dest="${build.dir}"/>

        <filter token="SCARAB_CONTEXT" value="${scarab.context}"/>
        <filter token="SCARAB_HTML_REDIRECT" value="${scarab.html.redirect}"/>

        <copy todir="${build.project}/style" filtering="yes">
            <fileset dir="${build.dir}/${tigris-style}/css"
                     includes="**/*.css" />
        </copy>

        <copy todir="${build.project}/style" filtering="yes">
            <fileset dir="${src.html.dir}"
                     includes="**/*.css" />
            <fileset dir="${src.html.dir}"
                     includes="**/*.dtd" />
        </copy>

        <copy todir="${build.project}/images" filtering="no">
            <fileset dir="${src.images.dir}" />
            <fileset dir="${build.dir}/${tigris-style}/images"
                     includes="*.gif,*.png" />
        </copy>
        <delete dir="${build.dir}/${tigris-style}" quiet="true"/>
    </target>

    <!-- ================================================================== -->
    <!-- Prepares the build directory                                       -->
    <!-- ================================================================== -->
    <target name="prepare" depends="prepare-tomcat, style-init">

        <!-- things to go into the project directory -->
        
        <filter token="SCARAB_CONTEXT" value="${scarab.context}"/>
        <filter token="SCARAB_HTML_REDIRECT" value="${scarab.html.redirect}"/>
        <copy todir="${build.project}" filtering="yes">
            <fileset dir="${src.html.dir}">
                <include name="**/*.html"/>
                <include name="**/*.js"/>
            </fileset>
        </copy>

        <copy todir="${build.project}/dtd" filtering="yes">
            <fileset dir="${src.dtd.dir}">
                <include name="**/scarab.dtd"/>
                <include name="**/scarab-settings.dtd"/>
            </fileset>
        </copy>

        <!-- Conditionally copy templates -->
        <antcall target="copy-templates" />

        <copy todir="${build.project.webinf}" filtering="yes">
            <fileset dir="${src.conf.dir}/">
                <include name="web.xml"/>
            </fileset>
        </copy>

        <condition property="template.path" value="/WEB-INF">
            <equals arg1="${scarab.copy.templates}" arg2="true"/>
        </condition>
        <condition property="template.path" value="file://${src.dir}">
            <not>
                <equals arg1="${scarab.copy.templates}" arg2="true"/>
            </not>
        </condition>
        <!-- add custom template folders -->
        <available property="template.path" 
                      value="file://${scarab.template.path},${template.path}"
                       type="dir" file="${scarab.template.path}" />

        <!-- things to go into the web-inf directory -->
        <filter token="VERSION" value="${version}"/>
        <tstamp/>
        <filter token="BUILD_DATE" value="${DSTAMP}${TSTAMP}"/>
        <filter token="TEMPLATE_PATH" value="${template.path}"/>
        <filter token="HOMEPAGE" value="${scarab.homepage}"/>
        <filter token="PIPELINE_DESCRIPTOR"
            value="${scarab.default.pipeline.descriptor}"/>
        <filter token="ADMIN_USERNAME" value="${scarab.user.username}"/>
        <filter token="ADMIN_PASSWORD" value="${scarab.user.password}"/>
        <filter token="ADMIN_FIRSTNAME" value="${scarab.user.firstname}"/>
        <filter token="ADMIN_LASTNAME" value="${scarab.user.lastname}"/>
        <filter token="ADMIN_EMAIL" value="${scarab.user.email}"/>
        <filter token="DATABASE_PROP_NAME" value="${scarab.database.prop.name}"/>
        <filter token="DATABASE_TYPE" value="${scarab.database.type}"/>
        <filter token="DATABASE_NAME" value="${scarab.database.name}"/>
        <filter token="DATABASE_DRIVER" value="${scarab.database.jdbc.driver}"/>
        <filter token="DATABASE_URL" value="${scarab.database.url}"/>
        <filter token="DATABASE_HOST" value="${scarab.database.host}"/>
        <filter token="DATABASE_PORT" value="${scarab.database.port}"/>
        <filter token="DATABASE_USERNAME" value="${scarab.database.username}"/>
        <filter token="DATABASE_PASSWORD" value="${scarab.database.password}"/>
        <filter token="DATABASE_LOADORDER" value="${scarab.database.loadorder}"/>
        <filter token="TEST_DATABASE_URL" value="${scarab.test.database.url}"/>
        <filter token="TEST_DATABASE_USERNAME" value="${scarab.test.database.username}"/>
        <filter token="TEST_DATABASE_PASSWORD" value="${scarab.test.database.password}"/>

        <filter token="DATABASE_VALIDATION_QUERY" value="${scarab.database.validationQuery}"/>
        <filter token="SYSTEM_MAIL_HOST" value="${scarab.system.mail.host}"/>
        <filter token="TURBINE_MODE" value="${scarab.mode}"/>
        <filter token="SESSION_VALIDATOR" value="${scarab.sessionvalidator}"/>
        <filter token="USER_SERVICE" value="${scarab.user.service}"/>
        <filter token="MODULE_SERVICE" value="${scarab.module.service}"/>
        <filter token="LOCALIZATION_SERVICE" value="${scarab.localization.service}"/>
        <filter token="DATABASE_INIT_SERVICE" value="${scarab.dbinit.service}"/>
        <filter token="SCARAB_AUTOMATIC_ROLE_APPROVAL" value="${scarab.automatic.role.approval}"/>
        <filter token="SCARAB_SITE_NAME" value="${scarab.site.name}"/>
        <filter token="SCARAB_LINK" value="${scarab.pull.link}"/>
        <filter token="SCARAB_STATIC_LINK" value="${scarab.pull.staticlink}"/>
        <filter token="SESSION_TIMEOUT" value="${scarab.session.timeout}"/>
        <filter token="LUCENE_INDEX_PATH" value="${scarab.lucene.index.path}"/>
        <filter token="ATTACHMENTS_PATH" value="${scarab.attachments.path}"/>
        <filter token="INTAKE_SERIALIZE_FILE" value="${scarab.intake.serialize.file}"/>
        <filter token="INTAKE_OPTIONAL_GROUPS" value="${intake.optional.groups}"/>
        <filter token="FILE_UPLOAD_PATH" value="${scarab.file.upload.path}"/>
        <filter token="FILE_UPLOAD_MAX_SIZE" value="${scarab.file.max.size}"/>
        <filter token="SCARAB_REGISTER_CHECK_VALID_A" value="${scarab.register.email.checkValidA}"/>
        <filter token="SCARAB_REGISTER_BAD_EMAILS" value="${scarab.register.email.badEmails}"/>
        <filter token="TORQUE_MANAGER_CACHE" value="${scarab.torque.manager.cache}"/>
        <filter token="EXTRA_TR_PROPERTIES" 
            value="${scarab.extra.tr.properties}"/>
        <filter token="TIMEZONE" value="${scarab.timezone}"/>
        <filter token="LOG_PATTERN" value="${scarab.log.pattern}"/>
        <filter token="LOG_LEVEL_SCARAB" value="${scarab.log.level.scarab}"/>
        <filter token="LOG_FILE_SCARAB" value="${scarab.log.file.scarab}"/>
        <filter token="LOG_APPEND_SCARAB" value="${scarab.log.append.scarab}"/>
        <filter token="LOG_LEVEL_SCARAB_XML_IMPORT" value="${scarab.log.level.scarabxmlimport}"/>
        <filter token="LOG_FILE_SCARAB_XML_IMPORT" value="${scarab.log.file.scarabxmlimport}"/>
        <filter token="LOG_APPEND_SCARAB_XML_IMPORT" value="${scarab.log.append.scarabxmlimport}"/>
        <filter token="LOG_LEVEL_TURBINE" value="${scarab.log.level.turbine}"/>
        <filter token="LOG_FILE_TURBINE" value="${scarab.log.file.turbine}"/>
        <filter token="LOG_APPEND_TURBINE" value="${scarab.log.append.turbine}"/>
        <filter token="LOG_LEVEL_FULCRUM" value="${scarab.log.level.fulcrum}"/>
        <filter token="LOG_FILE_FULCRUM" value="${scarab.log.file.fulcrum}"/>
        <filter token="LOG_APPEND_FULCRUM" value="${scarab.log.append.fulcrum}"/>
        <filter token="LOG_LEVEL_TORQUE" value="${scarab.log.level.torque}"/>
        <filter token="LOG_FILE_TORQUE" value="${scarab.log.file.torque}"/>
        <filter token="LOG_APPEND_TORQUE" value="${scarab.log.append.torque}"/>
        <filter token="LOG_LEVEL_STRATUM" value="${scarab.log.level.stratum}"/>
        <filter token="LOG_FILE_STRATUM" value="${scarab.log.file.stratum}"/>
        <filter token="LOG_APPEND_STRATUM" value="${scarab.log.append.stratum}"/>
        <filter token="LOG_LEVEL_JCS" value="${scarab.log.level.jcs}"/>
        <filter token="LOG_FILE_JCS" value="${scarab.log.file.jcs}"/>
        <filter token="LOG_APPEND_JCS" value="${scarab.log.append.jcs}"/>
        <filter token="LOG_LEVEL_BEANUTILS" value="${scarab.log.level.beanutils}"/>
        <filter token="LOG_LEVEL_VELOCITY" value="${scarab.log.level.velocity}"/>
        <filter token="LOG_FILE_VELOCITY" value="${scarab.log.file.velocity}"/>
        <filter token="LOG_APPEND_VELOCITY" value="${scarab.log.append.velocity}"/>
        <filter token="TEMPLATE_CACHE" value="${scarab.template.cache}"/>
        <filter token="LOCALE_DEFAULT_LANGUAGE" 
            value="${scarab.locale.default.language}"/>
        <filter token="LOCALE_DEFAULT_COUNTRY" 
            value="${scarab.locale.default.country}"/>
         <filter token="EMAIL_ENCODING" value="${scarab.email.encoding}"/> 
        <filter token="SCARAB_EMAIL_DEFAULT_FROMNAME" 
            value="${scarab.email.default.fromName}"/>
        <filter token="SCARAB_EMAIL_DEFAULT_FROMADDRESS" 
            value="${scarab.email.default.fromAddress}"/>
        <filter token="SCARAB_EMAIL_REGISTER_FROMNAME" 
            value="${scarab.email.register.fromName}"/>
        <filter token="SCARAB_EMAIL_REGISTER_FROMADDRESS" 
            value="${scarab.email.register.fromAddress}"/>
        <filter token="SCARAB_EMAIL_FORGOTPASSWORD_FROMNAME" 
            value="${scarab.email.forgotpassword.fromName}"/>
        <filter token="SCARAB_EMAIL_FORGOTPASSWORD_FROMADDRESS" 
            value="${scarab.email.forgotpassword.fromAddress}"/>

        <copy todir="${build.project.webinf}/conf" filtering="yes" overwrite="true">
            <fileset dir="${src.conf.dir}/">
                <include name="*.properties"/>
                <include name="*.xml"/>
                <include name="mime.types"/>
            </fileset>
        </copy>

        <copy todir="${build.project.webinf}/lib" filtering="no">
            <fileset dir="${lib.dir}/">
                <exclude name="**/servlet*.jar"/>
                <exclude name="**/xalan*.jar"/>
                <exclude name="**/${torque.zip}"/>
                <exclude name="**/*mysql*.jar"/>
                <exclude name="**/*postgresql*.jar"/>
                <exclude name="**/*oracle*.jar"/>
                <include name="**/*.jar"/>
            </fileset>
        </copy>

        <echo>Using ${scarab.database.type} JDBC driver from:
    ${lib.dir}/${scarab.jdbc.driver.jar}
        </echo>
        <copy todir="${build.project.webinf}/lib" filtering="no"
              preservelastmodified="yes">
            <fileset dir="${lib.dir}/">
                <include name="**/${scarab.jdbc.driver.jar}"/>
            </fileset>
        </copy>

        <!-- clean out any accidentally left over generated .sql 
             files which should not be in the src.sql.dir -->
        <delete file="${src.sql.dir}/${project}-schema.sql" quiet="true" />
        <delete file="${src.sql.dir}/turbine-schema.sql" quiet="true" />
        <delete file="${src.sql.dir}/scheduler-schema.sql" quiet="true" />
        <delete file="${src.sql.dir}/id-table-schema.sql" quiet="true" />

        <!-- the SQL data population scripts directory -->
        <copy todir="${build.sql.scarab}" filtering="yes">
            <fileset dir="${src.sql.dir}">
                <include name="**/*.sql"/>
                <include name="**/*.sh"/>
                <include name="**/*.lst"/>
                <include name="**/dbsettings.props"/>
            </fileset>
        </copy>
        <chmod perm="+x">
            <fileset dir="${src.sql.dir}" includes="**/*.sh"/>
            <fileset dir="${build.sql.scarab}" includes="**/*.sh"/>
        </chmod>

        <!-- express the type of database we are generating -->
        <touch file="${build.sql.scarab}/${scarab.database.type}" />

        <!-- the source code directory -->
        <filter token="OM" value="org.tigris.scarab.om"/>
        <copy todir="${build.src.scarab}/org" filtering="yes">
            <fileset dir="${src.java.dir.scarab}/org">
                <include name="**/*.java"/>
                <include name="**/*.xml"/>
                <include name="**/*.properties"/>
                <include name="**/package.html"/>
                <exclude name="**/*Lucene*.java"/>
            </fileset>
        </copy>

        <!-- copy l18n stuff into classpath -->
        <mkdir dir="${build.dest.scarab}"/>
        <copy todir="${build.dest.scarab}" filtering="no">
            <fileset dir="${src.i18n.dir}">
                <include name="**/*.properties"/>
            </fileset>
        </copy>
        
        <!-- Set the default language if the Locale isn't present -->
        <copy tofile="${build.dest.scarab}/ScarabBundle_de.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_de_DE.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_en.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_en_US.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_fr.properties" 
              filtering="no" 
              file="${src.i18n.dir}/ScarabBundle_fr_FR.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_ja.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_ja_JP.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_ko.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_ko_KR.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_nl.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_nl_NL.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_pt.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_pt_BR.properties"/>
        <copy tofile="${build.dest.scarab}/ScarabBundle_ru.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_ru_RU.properties"/>
        <!-- final default language is english -->
        <copy tofile="${build.dest.scarab}/ScarabBundle.properties" 
              filtering="no"
              file="${src.i18n.dir}/ScarabBundle_en_US.properties"/>

        <!-- copy JCS configuration into classpath -->
        <filter token="JCS_CACHE_PROPERTIES" value="${scarab.jcs.cache.properties}"/>
        <copy todir="${build.dest.scarab}" filtering="yes">
            <fileset dir="${src.conf.dir}/">
                <include name="cache.ccf"/>
            </fileset>
        </copy>

        <!-- add Lucene code to source directory -->
        <antcall target="copy-lucene"/>
        
        <mkdir dir="${build.project}/logs"/>
    </target>

    <!-- ================================================================== -->
    <!-- Copies templates to WEB-INF directory, if specified                -->
    <!-- ================================================================== -->
    <target name="copy-templates" if="scarab.copy.templates">
        <copy todir="${build.project.webinf}/templates" filtering="no">
            <fileset dir="${src.templates.dir}"/>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Adds Lucene adaptor code to source directory                       -->
    <!-- ================================================================== -->
    <target name="copy-lucene" depends="check_for_optional_packages"
        if="lucene.present">

        <copy todir="${build.src.scarab}/org" filtering="yes">
            <fileset dir="${src.java.dir.scarab}/org">
                <include name="**/*Lucene*.java"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Prepare Torque for action                                          -->
    <!-- ================================================================== -->
    <target name="torque-expanded-check">
        <!-- we can check that torque.zip is upToDate in order to know if
             the archive has already been expanded because it is expanded
             in the same target as it is copied to the directory -->
        <uptodate property="torque.is.expanded"
            targetfile="${build.src.scarab}/${torque.zip}">
            <srcfiles dir="${lib.dir}" includes="${torque.zip}"/>
        </uptodate>    
    </target>

    <target name="torque-init" depends="prepare,torque-expanded-check"
            unless="torque.is.expanded">
        <copy file="${lib.dir}/${torque.zip}" todir="${build.src.scarab}"/>
        <unzip  src="${build.src.scarab}/${torque.zip}"
               dest="${build.src.scarab}" />
        <copy todir="${build.project.webinf.lib}">
            <fileset dir="${torque.dir.scarab}/lib">
                <include name="torque*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Copy all of the xml schema files into the torque directory         -->
    <!-- ================================================================== -->
    <target name="torque-copy-all-schema" depends="torque-init" 
            unless="schema.uptodate">
        <!-- copy the schema's to the torque directory -->
        <copy file="${src.sql.dir}/${project}-schema.xml" 
              todir="${torque.dir.scarab}/schema"
              filtering="true" overwrite="true"/>
        <copy file="${src.sql.dir}/id-table-schema.xml" 
              todir="${torque.dir.scarab}/schema"
              filtering="true" overwrite="true"/>
        <copy file="${src.sql.dir}/turbine-schema.xml" 
              todir="${torque.dir.scarab}/schema"
              filtering="true" overwrite="true"/>
        <copy file="${src.sql.dir}/scheduler-schema.xml" 
              todir="${torque.dir.scarab}/schema"
              filtering="true" overwrite="true"/>
    </target>

    <!-- ================================================================== -->
    <!-- Check to see if SQL related stuff is up to date                    -->
    <!-- ================================================================== -->
    <target name="schema-check">
        <echo message="checking: ${build.sql.scarab}/${project}.sql"/>
        <uptodate property="schema.uptodate"
            targetfile="${build.sql.scarab}/${project}.sql">
            <srcfiles dir="${src.sql.dir}" includes="turbine-schema.xml"/>
            <srcfiles dir="${src.sql.dir}" includes="id-table-schema.xml"/>
            <srcfiles dir="${src.sql.dir}" includes="scheduler-schema.xml"/>
            <srcfiles dir="${src.sql.dir}" includes="${project}-schema.xml"/>
            <srcfiles dir="${user.home}" includes="scarab.build.properties"/>
            <srcfiles dir="${user.home}" includes="build.properties"/>
            <srcfiles dir="${basedir}" includes="${configuration.file}"/>
        </uptodate>
    </target>

    <!-- ================================================================== -->
    <!-- Generate SQL from Torque                                           -->
    <!-- ================================================================== -->
    <target name="sql" depends="prepare-build-dir,schema-check,torque-init,torque-copy-all-schema" 
            unless="schema.uptodate">

        <!-- removing sample schema that comes packaged with torque -->
        <delete file="${torque.dir.scarab}/schema/project-schema.xml"/>
        <filter token="DATABASE_PROP_NAME" value="${scarab.database.prop.name}"/>
        <filter token="DATABASE_TYPE" value="${scarab.database.type}"/>
        <filter token="DATABASE_URL" value="${scarab.database.url}"/>
        <filter token="DATABASE_ADMIN_URL" 
                value="${scarab.database.admin.url}"/>
        <filter token="DATABASE_DRIVER" value="${scarab.database.jdbc.driver}"/>
        <filter token="DATABASE_USER" value="${scarab.database.username}"/>
        <filter token="DATABASE_PASSWORD" value="${scarab.database.password}"/>
        <!-- copy the scarab specific build.properties over -->
        <copy file="${src.conf.dir}/torque.props" 
              tofile="${torque.dir.scarab}/build.properties"
              filtering="true" overwrite="true"/>

        <!-- move the generated .sql files into the target directory -->
        <ant antfile="build-torque.xml"
             dir="${torque.dir.scarab}" target="sql"
             inheritAll="false">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="lib.dir" value="${build.project.webinf.lib}"/>
            <property name="build.properties"
                      value="${torque.dir.scarab}/build.properties"/>
            <property name="idTableXMLFile" value=""/>
        </ant>

        <move file="${src.sql.dir}/${project}-schema.sql"
            tofile="${build.sql.scarab}/${project}.sql"/>
        <move file="${src.sql.dir}/turbine-schema.sql"
            tofile="${build.sql.scarab}/turbine.sql"/>
        <move file="${src.sql.dir}/scheduler-schema.sql"
            tofile="${build.sql.scarab}/scheduler.sql"/>
        <move file="${src.sql.dir}/id-table-schema.sql"
            tofile="${build.sql.scarab}/id-table.sql"/>
    </target>

    <!-- ================================================================== -->
    <!-- Generate OM/Peer classes from Torque                               -->
    <!-- ================================================================== -->
    <target name="generated-check" depends="prepare">
        <echo message="checking: ${torque.dir.scarab}/report.scarab.om.generation"/>
        <uptodate property="gen.uptodate"
            targetfile=
               "${torque.dir.scarab}/report.scarab.om.generation">
            <srcfiles dir="${src.sql.dir}" includes="scarab-schema.xml"/>
        </uptodate>
    </target>

    <target name="om-peer" depends="generated-check,torque-init,sql" 
            unless="gen.uptodate">

        <!-- we don't want to generate the OM objects for Turbine 
             tables because they already exists in the fulcrum.jar -->
        <delete file="${torque.dir.scarab}/schema/turbine-schema.xml"/>
        <delete file="${torque.dir.scarab}/schema/scheduler-schema.xml"/>

        <ant antfile="build-torque.xml" dir="${torque.dir.scarab}" 
                target="om" inheritAll="false">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="lib.dir" value="${build.project.webinf.lib}"/>
            <property name="build.properties" value="${torque.dir.scarab}/build.properties"/>
        </ant>

        <move todir="${build.src.scarab}/org/tigris/scarab/om" filtering="yes">
            <fileset dir="${src.java.dir.scarab}/org/tigris/scarab/om">
                <include name="**/Base*.java"/>
                <exclude name="**/BaseScarabObject.java"/>
                <include name="**/map/*MapBuilder.java"/>
                <include name="report.scarab.om.generation"/>
            </fileset>
        </move>

        <copy file="${src.java.dir.scarab}/report.scarab.om.generation" 
              overwrite="true" todir="${torque.dir.scarab}"/>

        <delete dir="${src.java.dir.scarab}/org/tigris/scarab/om/map"/>
    </target>

    <!-- ================================================================== -->
    <!-- Check for databases that could require alternate or more complex   -->
    <!-- methods for schema creation                                        -->
    <!-- ================================================================== -->
    <target name="db-type-check" depends="sql">
        <condition property="auto.create.db">
        <not>
            <or>
                <equals arg1="${scarab.database.type}" arg2="oracle"/>
                <equals arg1="${scarab.database.type}" arg2="db2"/>
                <equals arg1="${scarab.database.type}" arg2="mssql"/>
            </or>
        </not>
        </condition>
    </target>

    <!-- ================================================================== -->
    <!-- Test to make sure the database connection works                    -->
    <!-- ================================================================== -->
    <target name="test-db-connection" depends="sql">
        <echo message="Connecting to ${scarab.database.type} at ${scarab.database.url}"/>
        <sql
            driver="${scarab.database.jdbc.driver}"
            url="${scarab.database.url}"
            userid="${scarab.database.username}"
            password="${scarab.database.password}">
            <classpath refid="classpath"/>
        CREATE TABLE scarab_test (
          scarab_test integer
        );
        drop table scarab_test;
        </sql>
    </target>

    <!-- ================================================================== -->
    <!-- Create database if not bypassed in "db-type-check"                 -->
    <!-- ================================================================== -->
    <target name="create-db-schema" depends="db-type-check,sql" 
            if="auto.create.db">

        <filter token="DATABASE_NAME" value="${scarab.database.name}"/>
        <copy file="${src.sql.dir}/create-${scarab.database.type}-db.sql" 
              todir="${build.src.scarab}"
              filtering="true" overwrite="true"/>
        <echo message="Connecting to ${scarab.database.type} at ${scarab.database.admin.url}"/>
        <sql
            driver="${scarab.database.jdbc.driver}"
            url="${scarab.database.admin.url}"
            userid="${scarab.database.admin.username}"
            password="${scarab.database.admin.password}">
            <classpath refid="classpath"/>
            <transaction 
                src="${build.src.scarab}/create-${scarab.database.type}-db.sql"/>
        </sql>

    </target>

    <!-- ================================================================== -->
    <!-- Load default data                                                  -->
    <!-- ================================================================== -->
    <target name="load-default-data" depends="create-db-schema">

        <property name="file.prefix" value="${build.sql.scarab}/"/>

        <!-- Oracle does not have any type of conditional execution    -->
        <!-- of "drop table".  So when running the table creation,     -->
        <!-- it fails when dropping a table.  Rather than setting the  -->
        <!-- onerror of the actual creation class to "continue", this  -->
        <!-- pre-creates dummy tables (ignoring any errors if the      -->
        <!-- tables already exist) so that they can be dropped.        -->
        <sql
            rdbms="oracle"
            onerror="continue"
            driver="${scarab.database.jdbc.driver}"
            url="${scarab.database.admin.url}"
            userid="${scarab.database.admin.username}"
            password="${scarab.database.admin.password}">
            <classpath refid="classpath"/>
            <transaction 
                src="${file.prefix}prepare-dummy-tables.sql"/>
        </sql>


        <echo message=
            "Connecting to ${scarab.database.type} at ${scarab.database.url}"/>
        <sql
            driver="${scarab.database.jdbc.driver}"
            url="${scarab.database.url}"
            userid="${scarab.database.admin.username}"
            password="${scarab.database.admin.password}">
            <classpath refid="classpath"/>
            <transaction src="${file.prefix}standard-${scarab.database.type}-init.sql"/>

            <transaction src="${file.prefix}turbine.sql"/>
            <transaction src="${file.prefix}${project}.sql"/>
            <transaction src="${file.prefix}scheduler.sql"/>
            <transaction src="${file.prefix}id-table.sql"/>
            <transaction src="${file.prefix}turbine-id-table-init.sql"/>
            <transaction src="${file.prefix}${project}-id-table-init.sql"/>
            <transaction src="${file.prefix}${project}-required-data.sql"/>
            <transaction src="${file.prefix}${project}-default-data.sql"/>
            <transaction src="${file.prefix}${project}-security.sql"/>
        </sql>
    </target>

    <!-- ================================================================== -->
    <!-- Load seed data unless bypassed by setting "skip.seed.data"         -->
    <!-- to any value in "build.properties"                                 -->
    <!-- ================================================================== -->
    <target name="load-seed-data" depends="load-default-data"
            unless="skip.seed.data">
        <!-- ============================================================== -->
        <!-- Alternate initial data file may be specified                   -->
        <!-- in "build.properties" by setting "seed.data.sql"               -->
        <!-- to an alternate file.                                          -->
        <!-- ============================================================== -->
        <property name="file.prefix" value="${build.sql.scarab}/"/>
        <property name="seed.data.sql"
            value="${file.prefix}${project}-sample-data.sql"/>
        <sql
            driver="${scarab.database.jdbc.driver}"
            url="${scarab.database.url}"
            userid="${scarab.database.admin.username}"
            password="${scarab.database.admin.password}">
            <classpath refid="classpath"/>
            <transaction src="${file.prefix}standard-${scarab.database.type}-init.sql"/>
            <transaction src="${seed.data.sql}"/>
        </sql>
    </target>

    <!-- ================================================================== -->
    <!-- Create DB from Torque                                              -->
    <!-- ================================================================== -->
    <target name="create-db" depends="load-seed-data"/>

    <!-- ================================================================== -->
    <!-- Generate Data DTD from Torque                                      -->
    <!-- ================================================================== -->
    <target name="datadtd-check">
        <echo message="checking: ${src.sql.dir}/${project}-data.dtd"/>
        <uptodate property="datadtd.uptodate"
            targetfile="${src.sql.dir}/${project}-data.dtd">
            <srcfiles dir="${src.sql.dir}" includes="scarab-schema.xml"/>
        </uptodate>
    </target>

    <target name="datadtd" depends="datadtd-check,torque-init,compile"
            unless="datadtd.uptodate">
        <copy file="${src.sql.dir}/${project}-schema.xml"
              todir="${torque.dir.scarab}/schema"/>
        <copy file="${src.conf.dir}/torque.props"
              overwrite="true" tofile="${torque.dir.scarab}/build.properties"/>
        <ant antfile="build-torque.xml"
                dir="${torque.dir.scarab}" target="datadtd" inheritAll="false">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="databaseName" value="default"/>
            <property name="lib.dir" value="${build.project.webinf.lib}"/>
            <property name="build.properties" value="${torque.dir.scarab}/build.properties"/>
        </ant>

        <echo message="${src.java.dir.scarab}/${project}-data.dtd"/>
        <echo message="${src.sql.dir}/${project}-data.dtd"/>

        <move file="${src.dir}/${project}-data.dtd"
            tofile="${src.sql.dir}/${project}-data.dtd"/>
    </target>

    <!-- ================================================================== -->
    <!-- Generate SQL from data XML                                         -->
    <!-- ================================================================== -->
    <target name="datasql" depends="prepare,datadtd,compile">
        <copy file="${src.sql.dir}/${project}-schema.xml"
            todir="${torque.dir.scarab}/schema"/>
        <copy file="${src.sql.dir}/${project}-data.xml"
            todir="${torque.dir.scarab}/schema"/>
        <copy file="${src.sql.dir}/${project}-data.dtd"
            todir="${torque.dir.scarab}/schema"/>
        <copy file="${src.conf.dir}/torque.props" overwrite="true"
            tofile="${torque.dir.scarab}/build.properties"
	    filtering="true"/>
        <ant antfile="build-torque.xml" dir="${torque.dir.scarab}"
            target="datasql" inheritAll="false">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="lib.dir" value="${build.project.webinf.lib}"/>
            <property name="build.properties" value="${torque.dir.scarab}/build.properties"/>
        </ant>
        <move file="${src.java.dir.scarab}/${project}-data.sql"
            tofile="${src.sql.dir}/${project}-data.sql"/>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the source directory                                      -->
    <!-- ================================================================== -->
    <target name="compile" depends="om-peer,prepare">
        <mkdir dir="${build.dest.scarab}"/>
        <javac srcdir="${build.src.scarab}"
            destdir="${build.dest.scarab}"
            excludes="**/package.html,torque/**"
            debug="${debug}"
            deprecation="${deprecation}"
            optimize="${optimize}">

        <classpath refid="classpath"/>

        <classpath>
            <fileset dir="${build.project.webinf.lib}">
                <include name="**/torque*.jar"/>
            </fileset>
        </classpath>

        </javac>

        <copy todir="${build.dest.scarab}/org" filtering="no">
            <fileset dir="${build.src.scarab}/org">
                <include name="**/*.xml"/>
                <include name="**/*.properties"/>
            </fileset>
        </copy>

    </target>

    <target name="compile-tests" depends="compile">
        <javac srcdir="${src.test.dir}"
            destdir="${build.dest.scarab}"
            excludes="**/package.html,torque/**"
            debug="${debug}"
            deprecation="${deprecation}"
            optimize="${optimize}">

        <classpath refid="classpath"/>

        <classpath>
            <fileset dir="${build.project.webinf.lib}">
                <include name="**/torque*.jar"/>
            </fileset>
        </classpath>

        </javac>

        <copy todir="${build.dest.scarab}/org" filtering="no">
            <fileset dir="${src.test.dir}/org">
                <include name="**/*.xml"/>
            </fileset>
        </copy>

    </target>

    <!-- ================================================================== -->
    <!-- Runs configuration                                                 -->
    <!-- ================================================================== -->
    <target name="configure">
        <ant antfile="configure.xml" dir="${basedir}" inheritall="false">
            <property name="configuration.file"
                      value="${configuration.file}"/>
        </ant>
    </target>

    <!-- ================================================================== -->
    <!-- Runs the test suite                                                -->
    <!-- ================================================================== -->
    <target name="tests" depends="compile-tests">
        <ant antfile="run-tests.xml" dir="${basedir}" inheritall="false"/>
    </target>

    <!-- ================================================================== -->
    <!-- jars the source directory                                          -->
    <!-- ================================================================== -->
    <target name="jarsrc" depends="prepare">
        <jar jarfile="${build.dir}/${final.name}.src.jar"
            basedir="${build.src.scarab}"
            excludes="**/package.html"/>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Tomcat 4.1 easily                           -->
    <!-- ================================================================== -->
    <target name="upgrade-tomcat-4-1-bin">
        <echo>
        Upgrading Tomcat 4.1 from: ${tomcat.binary.dir}
        </echo>
    
        <copy todir="${tomcat.dist.dir}/bin" filtering="no">
            <fileset dir="${tomcat.binary.dir}/bin"/>
        </copy>
        <copy todir="${tomcat.dist.dir}/common/endorsed" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/endorsed">
                <include name="**/xmlParserAPIs.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/server/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/endorsed">
                <include name="**/xercesImpl.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/common/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/lib">
                <include name="**/commons-collections.jar"/>
                <include name="**/naming-common.jar"/>
                <include name="**/naming-resources.jar"/>
                <include name="**/servlet.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/server/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/server/lib">
                <include name="**/catalina.jar"/>
                <include name="**/commons-beanutils.jar"/>
                <include name="**/commons-digester.jar"/>
                <include name="**/servlets-common.jar"/>
                <include name="**/servlets-default.jar"/>
                <include name="**/servlets-invoker.jar"/>
                <include name="**/tomcat-coyote.jar"/>
                <include name="**/tomcat-http11.jar"/>
                <include name="**/tomcat-util.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Turbine easily                                -->
    <!-- ================================================================== -->
    <target name="build-turbine">
        <exec executable="maven" dir="${turbine.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="maven" dir="${turbine.dir}" />
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Torque easily                                 -->
    <!-- ================================================================== -->
    <target name="build-torque">
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml clean"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml update-jars"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml dist-lite"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Fulcrum easily                                -->
    <!-- ================================================================== -->
    <target name="build-fulcrum">

<echo>
<![CDATA[
!!!!!!!!!!!!!!!!!!!!!!!! Important !!!!!!!!!!!!!!!!!!!!!!!! 
You must make sure to patch the fulcrum project.xml file as 
shown to work with xerces-1.4.4, if the fulcrum jar is to be
used with scarab

Index: project.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-fulcrum/project.xml,v
retrieving revision 1.26
diff -u -r1.26 project.xml
--- project.xml 18 Apr 2002 17:17:17 -0000  1.26
+++ project.xml 26 Apr 2002 19:23:56 -0000
@@ -210,14 +210,8 @@
     <dependency>
       <name>xml-xerces</name>
       <type>required</type>
-      <version>2.0.0</version>
-      <jar>xercesImpl-2.0.0.jar</jar>
-    </dependency>
-    <dependency>
-      <name>xml-apis</name>
-      <type>required</type>
-      <version>2.0.0</version>
-      <jar>xmlParserAPIs-2.0.0.jar</jar>
+      <version>1.4.4</version>
+      <jar>xerces-1.4.4.jar</jar>
     </dependency>
     <dependency>
       <name>xml-rpc</name>
]]>
</echo>

        <exec executable="maven" dir="${fulcrum.dir}">
            <arg line="clean"/>
        </exec>
<!-- maven b6 does not accept multiple -D overrides, and i could not get it
     to take a build.properties override file either, so i just modified
     project.properties.  This is supposed to work better in the latest code.
-->
        <exec executable="maven" dir="${fulcrum.dir}">
            <arg line="-Dscheduler.database.name=${scarab.database.prop.name} -Dsecurity.database.javatype=${scarab.turbineSecurity.defaultJavaType} -Dsecurity.database.name=${scarab.database.prop.name} "/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Stratum easily                                -->
    <!-- ================================================================== -->
    <target name="build-stratum">
        <exec executable="ant" dir="${stratum.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${stratum.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of JCS easily                                    -->
    <!-- ================================================================== -->
    <target name="build-jcs">

<echo>
<![CDATA[
!!!!!!!!!!!!!!!!!!!!!!!!!! Important !!!!!!!!!!!!!!!!!!!!!!!!!! 
You must make sure to patch the JCS project.xml and build.xml 
files as shown to remove test configuration which causes logging
errors in jcs when used in an application, if the jcs jar is 
to be used with scarab


Index: build.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-jcs/build.xml,v
retrieving revision 1.5
diff -u -r1.5 build.xml
--- build.xml   19 Apr 2002 08:27:09 -0000  1.5
+++ build.xml   26 Apr 2002 19:37:26 -0000
@@ -46,12 +46,12 @@
   </target>
 
   <target
-    name="maven:jar" depends="jcs:test-prepare">
+    name="maven:jar">
     <ant antfile="${maven.home}/build-maven.xml" target="jar"/>
   </target>
 
   <target
-    name="maven:install-jar" depends="jcs:test-prepare">
+    name="maven:install-jar">
     <ant antfile="${maven.home}/build-maven.xml" target="install-jar"/>
   </target>
 
Index: project.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-jcs/project.xml,v
retrieving revision 1.5
diff -u -r1.5 project.xml
--- project.xml 19 Apr 2002 08:26:27 -0000  1.5
+++ project.xml 26 Apr 2002 19:37:27 -0000
@@ -139,14 +139,6 @@
     <sourceDirectories>
       <sourceDirectory>src/java</sourceDirectory>
     </sourceDirectories>
-    <unitTestSourceDirectory>src/test</unitTestSourceDirectory>
-    <aspectSourceDirectories></aspectSourceDirectories>
-    <unitTestPatterns>
-      <unitTestPattern>include = **/TestJCS.java</unitTestPattern>
-      <unitTestPattern>include = **/TestSimpleLoad.java</unitTestPattern>
-      <unitTestPattern>include = **/TestDiskCache.java</unitTestPattern>
-      <unitTestPattern>include = **/TestDiskCacheConcurrent.java</unitTestPattern>
-    </unitTestPatterns>
     <jarResources></jarResources>
     <jars></jars>
   </build>
]]>
</echo>

        <exec executable="ant" dir="${jcs.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${jcs.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Collections easily                    -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-collections">
        <exec executable="ant" dir="${commons-collections.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-collections.dir}">
            <arg line="dist"/>
        </exec>
        <copy todir="${lib.repo}">
            <fileset dir="${commons-collections.dir}">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Configuration easily          -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-configuration">
        <exec executable="ant" dir="${commons-sandbox-configuration.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-configuration.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Xo easily          -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-xo">
        <exec executable="ant" dir="${commons-sandbox-xo.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-xo.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Util easily                   -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-util">
        <exec executable="ant" dir="${commons-sandbox-util.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-util.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Email easily                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-email">
        <exec executable="maven" dir="${commons-sandbox-email.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="maven" dir="${commons-sandbox-email.dir}">
            <arg line="java:jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Codec easily                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-codec">
        <exec executable="ant" dir="${commons-sandbox-codec.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-codec.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Lang easily                   -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-lang">
        <exec executable="ant" dir="${commons-sandbox-lang.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-lang.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Beanutils easily                      -->
    <!-- ================================================================== -->
    <target name="build-commons-beanutils">
        <exec executable="ant" dir="${commons-beanutils.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-beanutils.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Turbine easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-turbine" depends="build-turbine">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/turbine*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${turbine.dir}/target">
                <include name="**/turbine*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Torque easily                               -->
    <!-- ================================================================== -->
    <target name="upgrade-torque" depends="build-torque">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/${torque.zip}"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${torque.dir}/target">
                <include name="**/${torque.zip}"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Fulcrum easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-fulcrum" depends="build-fulcrum">

        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/fulcrum*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${fulcrum.dir}/target">
                <include name="**/fulcrum*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Stratum easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-stratum" depends="build-stratum">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/stratum*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${stratum.dir}/target">
                <include name="**/stratum*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of JCS easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-jcs" depends="build-jcs">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/jcs*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${jcs.dir}/target">
                <include name="**/jcs*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Collections easily                  -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-collections" depends="build-commons-collections">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-collections.dir}/dist">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Configuration easily        -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-configuration" depends="build-commons-sandbox-configuration">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-configuration*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-configuration.dir}/target">
                <include name="**/commons-configuration*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Xo easily        -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-xo" depends="build-commons-sandbox-xo">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-xo*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-xo.dir}/target">
                <include name="**/commons-xo*.jar"/>
            </fileset>
        </copy>
    </target>


    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Util easily                 -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-util" depends="build-commons-sandbox-util">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-util*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-util.dir}/target">
                <include name="**/commons-util*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Email easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-email" depends="build-commons-sandbox-email">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-email*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-email.dir}/target">
                <include name="**/commons-email*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Codec easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-codec" depends="build-commons-sandbox-codec">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-codec*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-codec.dir}/dist">
                <include name="**/commons-codec*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Lang easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-lang" depends="build-commons-sandbox-lang">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-lang*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-lang.dir}/dist">
                <include name="**/commons-lang*.jar"/>
            </fileset>
        </copy>
    </target>

   <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Beanutils easily                    -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-beanutils" depends="build-commons-beanutils">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-beanutils*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-beanutils.dir}/dist">
                <include name="**/commons-beanutils.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our dependencies easily                                    -->
    <!-- These are in dependency order for themselves                       -->
    <!-- ================================================================== -->
    <target name="upgrade-jakarta" 
            depends="upgrade-commons-collections,
                     upgrade-commons-sandbox-util,
                     upgrade-commons-sandbox-configuration,
                     upgrade-commons-sandbox-xo,
                     upgrade-commons-sandbox-email,
                     upgrade-commons-sandbox-codec,
                     upgrade-commons-sandbox-lang,
                     upgrade-commons-beanutils,
                     upgrade-torque,upgrade-fulcrum,upgrade-stratum,
                     upgrade-turbine,upgrade-jcs
                     ">
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our cvs dependencies easily                                -->
    <!-- ================================================================== -->
    <target name="upgrade-jakarta-cvs">
        <echo>${fulcrum.dir}</echo>
        <cvs dest="${fulcrum.dir}" command="update"/>
        <echo>${stratum.dir}</echo>
        <cvs dest="${stratum.dir}" command="update"/>
        <echo>${jcs.dir}</echo>
        <cvs dest="${jcs.dir}" command="update"/>
        <echo>${torque.dir}</echo>
        <cvs dest="${torque.dir}" command="update"/>
        <echo>${turbine.dir}</echo>
        <cvs dest="${turbine.dir}" command="update"/>
        <echo>${commons-beanutils.dir}</echo>
        <cvs dest="${commons-beanutils.dir}" command="update"/>
        <echo>${commons-sandbox-util.dir}</echo>
        <cvs dest="${commons-sandbox-util.dir}" command="update"/>
        <echo>${commons-sandbox-configuration.dir}</echo>
        <cvs dest="${commons-sandbox-configuration.dir}" command="update"/>
        <echo>${commons-sandbox-xo.dir}</echo>
        <cvs dest="${commons-sandbox-xo.dir}" command="update"/>
        <echo>${commons-sandbox-email.dir}</echo>
        <cvs dest="${commons-sandbox-email.dir}" command="update"/>
        <echo>${commons-sandbox-codec.dir}</echo>
        <cvs dest="${commons-sandbox-codec.dir}" command="update"/>
    </target>

    <!-- ================================================================== -->
    <!-- Creates the API documentation                                      -->
    <!-- ================================================================== -->
    <target name="javadocs" depends="om-peer,prepare">
        <mkdir dir="${javadoc.destdir}"/>
        <javadoc
            sourcepath="${build.src.scarab}"
            packagenames="org.tigris.scarab.*"
            destdir="${javadoc.destdir}"
            author="true"
            private="true"
            version="true"
            use="true"
            windowtitle="${Name} ${version} API"
            doctitle="${Name} ${version} API"
            bottom="Copyright &amp;copy; ${year} CollabNet. All Rights Reserved."
        >
            <classpath refid="classpath"/>
            <classpath>
                <fileset dir="${build.project.webinf.lib}">
                    <include name="**/torque*.jar"/>
                </fileset>
            </classpath>
        </javadoc>
    </target>

    <!-- ================================================================== -->
    <!-- Creates the API documentation. Added a param -breakiterator        -->
    <!-- that is specific for 1.4.1 and prevents ugly error messages        -->
    <!-- ================================================================== -->
    <target name="javadocs141" depends="om-peer,prepare">
        <mkdir dir="${javadoc.destdir}"/>
        <javadoc
            sourcepath="${build.src.scarab}"
            packagenames="org.tigris.scarab.*"
            destdir="${javadoc.destdir}"
            author="true"
            private="true"
            version="true"
            use="true"
            windowtitle="${Name} ${version} API"
            doctitle="${Name} ${version} API"
            bottom="Copyright &amp;copy; ${year} CollabNet. All Rights Reserved."
            additionalparam="-breakiterator"
        >
            <classpath refid="classpath"/>
            <classpath>
                <fileset dir="${build.project.webinf.lib}">
                    <include name="**/torque*.jar"/>
                </fileset>
            </classpath>
        </javadoc>
    </target>

    <!-- ================================================================== -->
    <!-- Creates the Usecase documentation                                  -->
    <!-- ================================================================== -->
    <target name="usecases" depends="prepare">
        <ant antfile="build.xml" 
                dir="${src.usecases.dir}" target="docs">
        </ant>
    </target>
    
    <!-- ================================================================== -->
    <!-- Cleans up the build directory                                      -->
    <!-- ================================================================== -->
    <target name="clean" depends="prepare-build-dir">
        <delete dir="${build.dir}" quiet="true"/>
    </target>
    <target name="clean-all" depends="prepare-build-dir">
        <delete file="${scarab.log.file.scarab}" quiet="true"/>
        <delete file="${scarab.log.file.turbine}" quiet="true"/>
        <delete file="${scarab.log.file.torque}" quiet="true"/>
        <delete file="${scarab.log.file.fulcrum}" quiet="true"/>
        <delete file="${scarab.log.file.stratum}" quiet="true"/>
        <delete file="${scarab.log.file.velocity}" quiet="true"/>
        <delete file="${scarab.log.file.jcs}" quiet="true"/>
        <delete dir="${build.dir}" quiet="true"/>
        <delete quiet="true">
            <fileset dir="..">
                <include name="${final.name}*"/>
            </fileset>
        </delete>
    </target>

    <!-- ================================================================== -->
    <!-- Package (creates a .zip and .tar.gz)                               -->
    <!-- ================================================================== -->
    <target name="package" depends="package-zip,package-tgz">
    </target>

    <!-- ================================================================== -->
    <!-- Packages the distribution with ZIP                                 -->
    <!-- ================================================================== -->
    <target name="package-zip" depends="dist">
        <delete file="../${final.name}.zip" quiet="true" />
        <zip zipfile="../${final.name}.zip" 
             basedir="../" includes="**/${final.name}/**"/>
    </target>

    <!-- ================================================================== -->
    <!-- Packages the distribution with TAR-GZIP                            -->
    <!-- ================================================================== -->
    <target name="package-tgz" depends="dist">
        <delete file="../${final.name}.tar" quiet="true"/>
        <delete file="../${final.name}.tar.gz" quiet="true" />
        <tar longfile="gnu" tarfile="../${final.name}.tar" 
             basedir="../" includes="**/${final.name}/**"/>
        <gzip zipfile="../${final.name}.tar.gz" 
                  src="../${final.name}.tar"/>
        <delete file="../${final.name}.tar"/>
    </target>

    <!-- ================================================================== -->
    <!-- Creates the Binary distribution directory                          -->
    <!-- ================================================================== -->
    <target name="dist">
        <delete dir="${final.dir}" quiet="true" />
        <mkdir dir="${final.dir}"/>

        <copy todir="${final.dir}" preservelastmodified="true"
              includeEmptyDirs="false">
            <fileset dir="../">
                <exclude name="**/build/nightly.sh"/>
                <exclude name="**/build/run-tests*"/>
                <exclude name="**/build/velocity.log*"/>
                <exclude name="**/lib/jakarta-turbine-*.gz"/>
                <exclude name="**/src/sql/${scarab.database.type}-scarab.sql"/>
                <exclude name="**/src/sql/report.scarab.sql.generation"/>
                <exclude name="**/src/sql/project-schema.sql"/>
                <exclude name="**/src/sql/sqldb.map"/>
                <exclude name="**/src/sql/id-table-schema.sql"/>
                <exclude name="**/src/sql/*.DM1"/>
                <exclude name="**/src/sql/*.jpg"/>
                <exclude name="**/src/sql/schema-design-notes.txt"/>
                <exclude name="**/src/sql/sql_questions.txt"/>
                <exclude name="**/src/test/**"/>
                <exclude name="**/src/usecases/**"/>
                <exclude name="**/target/**"/>
                <exclude name="**/www/**"/>
            </fileset>
        </copy>

        <!-- In the distribution, turn on Velocity template caching -->
        <replace file="${final.dir}/build/default.properties">
            <replacetoken><![CDATA[scarab.template.cache=false]]></replacetoken>
            <replacevalue><![CDATA[scarab.template.cache=true]]></replacevalue>
        </replace>

        <!-- In the distribution, turn on template copying so that 
             paths are relative -->
        <replace file="${final.dir}/build/default.properties">
            <replacetoken><![CDATA[#scarab.copy.templates=true]]></replacetoken>
            <replacevalue><![CDATA[scarab.copy.templates=true]]></replacevalue>
        </replace>

    </target>

    <!-- ================================================================== -->
    <!-- Check to ensure that templates are in the war file                 -->
    <!-- ================================================================== -->
    <target name="war-requirements-check" depends="prepare">
        <condition property="cannot.build.war" value="true">
          <not>
            <equals arg1="${scarab.copy.templates}" arg2="true"/>
          </not>
        </condition>
    </target>

    <target name="war-requirements-failure" depends="war-requirements-check"
            if="cannot.build.war">
        <fail message="In order to create a war file, the property scarab.copy.templates must be set to true"/>
    </target>

    <!-- ================================================================== -->
    <!-- Create a war file                                                  -->
    <!-- ================================================================== -->
    <target name="war" depends="war-requirements-failure,compile">

        <war warfile="${scarab.war.file}"
              webxml="${build.project.webinf}/web.xml">

          <fileset dir="${build.project}">
            <exclude name="WEB-INF/**"/>
          </fileset>
          <lib dir="${build.project.webinf.lib}">
            <include name="*.jar"/>
          </lib>
          <classes dir="${build.dest.scarab}">
            <include name="**"/>
          </classes>
          <webinf dir="${build.project.webinf}">
            <exclude name="web.xml"/>
            <exclude name="classes/**"/>
            <exclude name="lib/**"/>
          </webinf>
        </war>
        <chmod dir="${final.dir}" perm="ug+rx" includes="**/*.sh" />
    </target>

    <target name="checkstyle" depends="compile">
        <echo>
  Using: ${checkstyle.all.jar}
        </echo>
        <taskdef name="checkstyle"
            classname="com.puppycrawl.tools.checkstyle.CheckStyleTask">
            <classpath>
                <pathelement location="${checkstyle.all.jar}"/>
            </classpath>
        </taskdef>
        <checkstyle config="${basedir}/checkstyle-config.xml"
                    failOnViolation="false"
                    failureProperty="checkstyle.failure">
            <classpath refid="classpath"/>
            <classpath>
                <fileset dir="${build.project.webinf.lib}">
                    <include name="**/torque*.jar"/>
                </fileset>
            </classpath>
            <property key="checkstyle.cache.file" file="${build.dir}/checkstyle.cache"/>
            <fileset dir="${build.src.scarab}/org">
                 <include name="**/*.java"/>
                 <exclude name="**/Base*.java"/>
                 <exclude name="**/*MapBuilder.java"/>
            </fileset>
            <formatter type="xml" toFile="${build.dir}/checkstyle.xml"/>
        </checkstyle>
        <antcall target="checkstyle-style" />
    </target>

    <target name="checkstyle-style">
        <style in="${build.dir}/checkstyle.xml" 
              out="${build.dir}/checkstyle.txt"
            style="${basedir}/checkstyle2txt.xsl"/>
    </target>

    <target name="checkstyle-mail" depends="checkstyle"
            if="checkstyle.failure">
        <mail from="${scarab.checkstyle.email.from}"
              tolist="${scarab.checkstyle.email.to}"
              mailhost="${scarab.system.mail.host}"
              subject="Checkstyle violation(s) in project ${Name}"
              messagefile="${build.dir}/checkstyle.txt"/>
    </target>

<!-- ============================================================= -->
<!-- Targets beyond this point are currently considered broken or  -->
<!-- experimental - User Beware!                                  -->
<!-- ============================================================= -->

    <!-- ================================================================== -->
    <!-- Tool to create proper import statements                            -->
    <!-- ==================================================================
    <target name="scrub" depends="om-peer,prepare">
        <taskdef name="scrub" 
          classname="org.apache.tools.ant.taskdefs.optional.importscrubber.ImportScrubberTask"/>

        <property name="tmp.dir" value="tmp"/>

        <delete dir="${tmp.dir}" quiet="true"/>

        <copy todir="${tmp.dir}/org">
          <fileset dir="${build.src.scarab}/org"/>
        </copy>

        <javac srcdir="${tmp.dir}"
            destdir="${tmp.dir}"
            excludes="**/package.html,torque/**"
            debug="true">

          <classpath refid="classpath"/>

          <classpath>
            <fileset dir="${build.project.webinf.lib}">
              <include name="**/torque*.jar"/>
            </fileset>
          </classpath>
        </javac>
        
        <scrub root="${tmp.dir}" format="nobreaks" recurse="true"/>

        <delete>
          <fileset dir="${tmp.dir}" includes="**/*.class"/>
        </delete>

        <copy todir="${src.java.dir.scarab}/org" overwrite="true">
          <fileset dir="${tmp.dir}/org"/>
        </copy>

    </target>
    -->

    <!-- ================================================================== -->
    <!-- Creates the Torque documentation                                   -->
    <!-- ================================================================== -->
    <target name="datadoc" depends="torque-init,torque-copy-all-schema,sql">
        <mkdir dir="${torquedoc.destdir}"/>
        <ant antfile="build-torque.xml" dir="${torque.dir.scarab}"
	     target="doc">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="lib.dir" value="${build.project.webinf}/lib"/>
            <property name="build.properties"
                      value="${torque.dir.scarab}/build.properties"/> 
            <property name="torque.doc.dir"
                      value="${torquedoc.destdir}"/> 
        </ant>
    </target>
    

    <!-- ================================================================== -->
    <!-- Dump data from DB into xml                                         -->
    <!-- ================================================================== -->
    <target name="datadump" depends="sql,compile">
        <ant antfile="build-torque.xml" dir="${torque.dir.scarab}"
            target="datadump">
            <property name="torque.home" value="${torque.dir.scarab}"/>
            <property name="lib.dir" value="${build.project.webinf}/lib"/>
            <property name="build.properties"
                      value="${torque.dir.scarab}/build.properties"/> 
            <property name="outputDirectory" value="schema"/> 
            <property name="torque.database.driver"
	              value="${scarab.database.jdbc.driver}"/>
            <property name="torque.database.url"
	              value="${scarab.database.url}"/>
            <property name="torque.database.user"
	              value="${scarab.database.username}"/>
            <property name="torque.database.password"
	              value="${scarab.database.password}"/>
        </ant>
        <move file="${torque.dir.scarab}/schema/${project}-${project}-all-data.xml"
            tofile="${src.sql.dir}/${project}-${project}-all-data.xml"/>
    </target>

    <!-- ================================================================== -->
    <!-- Generates an Html description of the DB schema                     -->
    <!-- This should be integrated with torque, so effort to integrate      -->
    <!-- into the build has not been done                                   -->
    <!-- ================================================================== -->
    <target name="html-schema">
        <echo message="This task expects you to have xalan-j_2_3_1 binary
                       distribution located at ${lib.repo}/xalan-j_2_3_1"/>
        <java classname="org.apache.xalan.xslt.Process" fork="yes"
              args="-XSL ${src.dir}/dtd/XMLSchemaToHTML.xsl 
                    -IN  ${src.sql.dir}/scarab-schema.xml 
                    -OUT ${src.sql.dir}/scarab-schema.html">
           <!-- it seems ant is treating these as jvmarg ??
           <arg value="-XSL ${src.dir}/dtd/XMLSchemaToHTML.xsl"/>
           <arg value="-IN  ${src.sql.dir}/scarab-schema.xml"/>
           <arg value="-OUT ${src.sql.dir}/scarab-schema.html"/>
           -->
           <classpath>
               <fileset dir="${lib.repo}/xalan-j_2_3_1/bin">
                   <include name="xalan.jar"/>
                   <include name="xml-apis.jar"/>
                   <include name="xercesImpl.jar"/>
               </fileset>
           </classpath>
        </java>

        <copy file="${src.sql.dir}/scarab-schema.html"
            tofile="${www.dir}/generated-scarab-schema.html"/>

    </target>


</project>

