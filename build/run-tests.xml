<?xml version="1.0"?>

<!-- Testcases for Scarab -->
<project name="main" default="test-all" basedir=".">

  <property name="webapps.scarab" value="../target/webapps/scarab"/>
  <property name="web.inf" value="${webapps.scarab}/WEB-INF"/>
  <property name="web.inf.lib" value="${web.inf}/lib"/>
  <property name="build.dest" value="${web.inf}/classes"/>
  <property name="ant.home" value="."/>
  <property name="test.home" value="../test"/>
  <property name="junit.jar" value="../lib/junit-3.7.jar"/>
  <property name="config.dir"
           value="-Dconfig.dir=${webapps.scarab}"/>

  <!-- JUnit Testbed properties -->
  <property name="test.runner" value="junit.textui.TestRunner"/>

  <!-- Turns on/off overall failure if one test fails -->
  <property name="testbed.failonerror" value="true"/>

  <!-- Build classpath -->
  <path id="classpath">
    <fileset dir="../lib">
      <include name="servlet*.jar"/>
    </fileset>
    <fileset dir="${web.inf.lib}">
      <include name="**/*.jar"/>
    </fileset>
    <pathelement location="${build.dest}"/>
  </path>

  <target name="compile">
    <ant dir="${basedir}" target="compile-tests"/>
  </target>

  <target name="test-all" depends="compile">
    <echo>Running All OM tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AllTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-all-old" depends="test-issue,
                                   test-attribute,
                                   test-query"/>

  <target name="test-issue" depends="compile">
    <echo>Running Issue tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.IssueTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attribute" depends="compile">
    <echo>Running Attribute tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attributeoption" depends="compile">
    <echo>Running AttributeOption tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeOptionTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-query" depends="compile">
    <echo>Running Query tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.QueryTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-scarabmodule" depends="compile">
    <echo>Running ScarabModule tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.ScarabModuleTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-scarabuser" depends="compile">
    <echo>Running ScarabUser tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.ScarabUserTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

</project>
