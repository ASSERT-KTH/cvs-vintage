<?xml version="1.0"?>

<!-- Testcases for Scarab -->
<project name="main" default="test-all" basedir=".">

  <!-- Allow the user to have multiple configuration files and
       specify them using -Dscarab.build.configuration=filename -->
  <property name="configuration.file" value="build.properties"/> 

  <!-- Give user a chance to override without editing this file
       (and without using -D arguments each time they build) -->
  <property file="${user.home}/scarab.build.properties" /> 
  <property file="${user.home}/build.properties" />
  <property file="${basedir}/${configuration.file}" />
  <property file="${basedir}/default.${scarab.database.type}.properties" />
  <property file="${basedir}/default.properties" />

  <property name="webapps.scarab" value="../target/webapps/scarab"/>
  <property name="web.inf" value="${webapps.scarab}/WEB-INF"/>
  <property name="web.inf.lib" value="${web.inf}/lib"/>
  <property name="build.dest" value="${web.inf}/classes"/>
  <property name="test.home" value="../test"/>
  <property name="junit.jar" value="../lib/junit-3.7.jar"/>
  <property name="config.dir"
           value="-Dconfig.dir=${webapps.scarab}"/>

  <property name="clover.dbdir" value="${web.inf}/src"/>
  <property name="clover.dbfile" value="${clover.dbdir}/scarab_coverage.db"/>
  <property name="clover.initstring" value="${clover.dbfile}"/>
  <property name="clover.html.outdir" value="${webapps.scarab}/clover"/>

  <!-- JUnit Testbed properties -->
  <property name="test.runner" value="junit.textui.TestRunner"/>

  <!-- Turns on/off overall failure if one test fails -->
  <property name="testbed.failonerror" value="true"/>

  <!-- Build classpath -->
  <path id="classpath">
    <fileset dir="${tomcat.dist.dir}/common/lib">
        <include name="**/servlet*.jar"/>
    </fileset>
    <fileset dir="${web.inf.lib}">
      <include name="**/*.jar"/>
    </fileset>
    <pathelement location="${build.dest}"/>
  </path>

  <target name="with.clover">
	<property name="build.compiler" 
	    value="org.apache.tools.ant.taskdefs.CloverCompilerAdapter"/>
  </target>

  <target name="compile">
    <ant dir="${basedir}" target="compile-tests"/>
  </target>

  <!-- =================================================================== -->
  <!-- generate a html report                                              -->
  <!-- =================================================================== -->
  <target name="clover.report.html">
    <java classname="com.cortexeb.tools.clover.reporters.html.HtmlReporter">
	  <arg line="-o ${clover.html.outdir} -i ${clover.initstring} -t 'scarab'"/>
	  <classpath refid="classpath"/>
	</java>
  </target>

  <target name="test-all" depends="test-all-om, test-all-util">
  </target>

  <target name="test-all-util" depends="compile">
    <echo>Running All Util tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.util.AllTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-all-om" depends="compile">
    <echo>Running All OM tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AllTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-issue" depends="compile">
    <echo>Running Issue tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.IssueTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-issuetype" depends="compile">
    <echo>Running IssueType tests...</echo>

    <java classname="${test.runner}" fork="yes" 
          failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.IssueTypeTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attribute" depends="compile">
    <echo>Running Attribute tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attributeoption" depends="compile">
    <echo>Running AttributeOption tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeOptionTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attributevalue" depends="compile">
    <echo>Running Attribute Value tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeValueTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-attributegroup" depends="compile">
    <echo>Running Attribute Group tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttributeGroupTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-rmoduleattribute" depends="compile">
    <echo>Running RModuleAttribute tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.RModuleAttributeTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-rmoduleissuetype" depends="compile">
    <echo>Running RModuleIssueType tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.RModuleIssueTypeTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-rmoduleoption" depends="compile">
    <echo>Running RModuleOption tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.RModuleOptionTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>


  <target name="test-query" depends="compile">
    <echo>Running Query tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.QueryTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-activity" depends="compile">
    <echo>Running Activity tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.ActivityTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-transaction" depends="compile">
    <echo>Running Transaction tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.TransactionTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>


  <target name="test-attachment" depends="compile">
    <echo>Running Attachment tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.AttachmentTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-scarabmodule" depends="compile">
    <echo>Running ScarabModule tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.ScarabModuleTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

  <target name="test-scarabuser" depends="compile">
    <echo>Running ScarabUser tests...</echo>

    <java     classname="${test.runner}" fork="yes" 
            failonerror="${testbed.failonerror}">
      <jvmarg value="${config.dir}"/>
      <arg value="org.tigris.scarab.om.ScarabUserTest"/>
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>

</project>
