<?xml version="1.0"?>

<!-- Upgrade various Projects for Scarab -->
<!-- Note: This looks like it hasn't been maintained in a very long time,
	and I think it should be considered deprecated as of Oct 17, 2003.
	If it doesn't work in a month or so, we should delete it!
	-->
<project name="main" default="test-all" basedir=".">

    <!-- Allow the user to have multiple configuration files and
         specify them using -Dconfiguration.file=filename -->
    <property name="configuration.file" value="build.properties"/> 

    <!-- Give user a chance to override without editing this file
         (and without using -D arguments each time they build) -->
    <property file="${user.home}/scarab.build.properties" /> 
    <property file="${user.home}/build.properties" />
    <property file="${basedir}/${configuration.file}" />
    <property file="${basedir}/default.properties" />
    <property file="${basedir}/default.${scarab.database.type}.properties" />

    <property name="ant.home" value=".."/>

    <property name="final.name" value="${project}-${version}"/>
    <property name="final.dir" value="${basedir}/../${final.name}/"/>

    <property name="src.conf.dir" value="${src.dir}/conf"/>
    <property name="www.dir" value="${src.dir}/../www"/>
    <property name="src.html.dir" value="${src.dir}/html"/>
    <property name="src.dtd.dir" value="${src.dir}/dtd"/>
    <property name="src.i18n.dir" value="${src.dir}/i18n"/>
    <property name="src.images.dir" value="${src.dir}/images"/>
    <property name="src.java.dir.scarab" value="${src.dir}/java"/>
    <property name="src.sql.dir" value="${src.dir}/sql"/>
    <property name="src.templates.dir" value="${src.dir}/templates"/>
    <property name="src.test.dir" value="${src.dir}/test"/>
    <property name="src.usecases.dir" value="${src.dir}/usecases"/>
    
    <property name="torque.dir.scarab" value="${build.src.scarab}/torque"/>
    <property name="javadoc.destdir" value="${build.project}/api"/>
    <property name="torquedoc.destdir" value="${src.html.dir}/docs"/>
    <property name="scarab.war.file.dir" value="${build.webapps}"/>
    <property name="scarab.war.file.name" value="${scarab.context}.war"/>
    <property name="scarab.war.file" value="${scarab.war.file.dir}/${scarab.war.file.name}"/>
    <property name="scarab.ear.file.dir" value="${build.webapps}"/>
    <property name="scarab.ear.file.name" value="${scarab.context}.ear"/>

    <property name="extensions.lib.dir" value="${extensions.dir}/lib"/>
    <property name="extensions.templates.dir" value="${extensions.dir}/templates"/>
    <property name="extensions.conf.dir" value="${extensions.dir}/conf"/>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Tomcat 4.1 easily                           -->
    <!-- ================================================================== -->
    <target name="upgrade-tomcat-4-1-bin">
        <echo>
        Upgrading Tomcat 4.1 from: ${tomcat.binary.dir}
        </echo>
    
        <copy todir="${tomcat.dist.dir}/bin" filtering="no">
            <fileset dir="${tomcat.binary.dir}/bin"/>
        </copy>
        <copy todir="${tomcat.dist.dir}/common/endorsed" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/endorsed">
                <include name="**/xmlParserAPIs.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/server/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/endorsed">
                <include name="**/xercesImpl.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/common/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/common/lib">
                <include name="**/commons-collections.jar"/>
                <include name="**/naming-common.jar"/>
                <include name="**/naming-resources.jar"/>
                <include name="**/servlet.jar"/>
            </fileset>
        </copy>
        <copy todir="${tomcat.dist.dir}/server/lib" filtering="no">
            <fileset dir="${tomcat.binary.dir}/server/lib">
                <include name="**/catalina.jar"/>
                <include name="**/commons-beanutils.jar"/>
                <include name="**/commons-digester.jar"/>
                <include name="**/servlets-common.jar"/>
                <include name="**/servlets-default.jar"/>
                <include name="**/servlets-invoker.jar"/>
                <include name="**/tomcat-coyote.jar"/>
                <include name="**/tomcat-http11.jar"/>
                <include name="**/tomcat-util.jar"/>
            </fileset>
        </copy>
    </target>
    
    <!-- ================================================================== -->
    <!-- Upgrade our dependencies easily                                    -->
    <!-- These are in dependency order for themselves                       -->
    <!-- ================================================================== -->
    <target name="upgrade-jakarta" 
            depends="upgrade-commons-collections,
                     upgrade-commons-sandbox-util,
                     upgrade-commons-sandbox-configuration,
                     upgrade-commons-sandbox-xo,
                     upgrade-commons-sandbox-email,
                     upgrade-commons-sandbox-codec,
                     upgrade-commons-sandbox-lang,
                     upgrade-commons-beanutils,
                     upgrade-torque,upgrade-fulcrum,upgrade-stratum,
                     upgrade-turbine,upgrade-jcs
                     ">
    </target>
    
    <!-- ================================================================== -->
    <!-- Build our version of Turbine easily                                -->
    <!-- ================================================================== -->
    <target name="build-turbine">
        <exec executable="maven" dir="${turbine.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="maven" dir="${turbine.dir}" />
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Torque easily                                 -->
    <!-- ================================================================== -->
    <target name="build-torque">
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml clean"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml update-jars"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml dist-lite"/>
        </exec>
        <exec executable="ant" dir="${torque.dir}">
            <arg line="-f build-legacy.xml install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Fulcrum easily                                -->
    <!-- ================================================================== -->
    <target name="build-fulcrum">

<echo>
<![CDATA[
!!!!!!!!!!!!!!!!!!!!!!!! Important !!!!!!!!!!!!!!!!!!!!!!!! 
You must make sure to patch the fulcrum project.xml file as 
shown to work with xerces-1.4.4, if the fulcrum jar is to be
used with scarab

Index: project.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-fulcrum/project.xml,v
retrieving revision 1.26
diff -u -r1.26 project.xml
--- project.xml 18 Apr 2002 17:17:17 -0000  1.26
+++ project.xml 26 Apr 2002 19:23:56 -0000
@@ -210,14 +210,8 @@
     <dependency>
       <name>xml-xerces</name>
       <type>required</type>
-      <version>2.0.0</version>
-      <jar>xercesImpl-2.0.0.jar</jar>
-    </dependency>
-    <dependency>
-      <name>xml-apis</name>
-      <type>required</type>
-      <version>2.0.0</version>
-      <jar>xmlParserAPIs-2.0.0.jar</jar>
+      <version>1.4.4</version>
+      <jar>xerces-1.4.4.jar</jar>
     </dependency>
     <dependency>
       <name>xml-rpc</name>
]]>
</echo>

        <exec executable="maven" dir="${fulcrum.dir}">
            <arg line="clean"/>
        </exec>
<!-- maven b6 does not accept multiple -D overrides, and i could not get it
     to take a build.properties override file either, so i just modified
     project.properties.  This is supposed to work better in the latest code.
-->
        <exec executable="maven" dir="${fulcrum.dir}">
            <arg line="-Dscheduler.database.name=${scarab.database.prop.name} -Dsecurity.database.javatype=${scarab.turbineSecurity.defaultJavaType} -Dsecurity.database.name=${scarab.database.prop.name} "/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Stratum easily                                -->
    <!-- ================================================================== -->
    <target name="build-stratum">
        <exec executable="ant" dir="${stratum.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${stratum.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of JCS easily                                    -->
    <!-- ================================================================== -->
    <target name="build-jcs">

<echo>
<![CDATA[
!!!!!!!!!!!!!!!!!!!!!!!!!! Important !!!!!!!!!!!!!!!!!!!!!!!!!! 
You must make sure to patch the JCS project.xml and build.xml 
files as shown to remove test configuration which causes logging
errors in jcs when used in an application, if the jcs jar is 
to be used with scarab


Index: build.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-jcs/build.xml,v
retrieving revision 1.5
diff -u -r1.5 build.xml
--- build.xml   19 Apr 2002 08:27:09 -0000  1.5
+++ build.xml   26 Apr 2002 19:37:26 -0000
@@ -46,12 +46,12 @@
   </target>
 
   <target
-    name="maven:jar" depends="jcs:test-prepare">
+    name="maven:jar">
     <ant antfile="${maven.home}/build-maven.xml" target="jar"/>
   </target>
 
   <target
-    name="maven:install-jar" depends="jcs:test-prepare">
+    name="maven:install-jar">
     <ant antfile="${maven.home}/build-maven.xml" target="install-jar"/>
   </target>
 
Index: project.xml
===================================================================
RCS file: /home/cvs/jakarta-turbine-jcs/project.xml,v
retrieving revision 1.5
diff -u -r1.5 project.xml
--- project.xml 19 Apr 2002 08:26:27 -0000  1.5
+++ project.xml 26 Apr 2002 19:37:27 -0000
@@ -139,14 +139,6 @@
     <sourceDirectories>
       <sourceDirectory>src/java</sourceDirectory>
     </sourceDirectories>
-    <unitTestSourceDirectory>src/test</unitTestSourceDirectory>
-    <aspectSourceDirectories></aspectSourceDirectories>
-    <unitTestPatterns>
-      <unitTestPattern>include = **/TestJCS.java</unitTestPattern>
-      <unitTestPattern>include = **/TestSimpleLoad.java</unitTestPattern>
-      <unitTestPattern>include = **/TestDiskCache.java</unitTestPattern>
-      <unitTestPattern>include = **/TestDiskCacheConcurrent.java</unitTestPattern>
-    </unitTestPatterns>
     <jarResources></jarResources>
     <jars></jars>
   </build>
]]>
</echo>

        <exec executable="ant" dir="${jcs.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${jcs.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Collections easily                    -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-collections">
        <exec executable="ant" dir="${commons-collections.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-collections.dir}">
            <arg line="dist"/>
        </exec>
        <copy todir="${lib.repo}">
            <fileset dir="${commons-collections.dir}">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Configuration easily          -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-configuration">
    	<echo message="dir:${commons-sandbox-configuration.dir}"/>
        <exec executable="ant" dir="${commons-sandbox-configuration.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-configuration.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Xo easily          -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-xo">
        <exec executable="ant" dir="${commons-sandbox-xo.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-xo.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Util easily                   -->
    <!-- There is a dependency on stuff in here in fulcrum                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-util">
        <exec executable="ant" dir="${commons-sandbox-util.dir}">
            <arg line="maven:clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-util.dir}">
            <arg line="maven:install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Email easily                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-email">
        <exec executable="maven" dir="${commons-sandbox-email.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="maven" dir="${commons-sandbox-email.dir}">
            <arg line="java:jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Codec easily                  -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-codec">
        <exec executable="ant" dir="${commons-sandbox-codec.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-codec.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Sandbox-Lang easily                   -->
    <!-- ================================================================== -->
    <target name="build-commons-sandbox-lang">
        <exec executable="ant" dir="${commons-sandbox-lang.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-sandbox-lang.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Build our version of Commons-Beanutils easily                      -->
    <!-- ================================================================== -->
    <target name="build-commons-beanutils">
        <exec executable="ant" dir="${commons-beanutils.dir}">
            <arg line="clean"/>
        </exec>
        <exec executable="ant" dir="${commons-beanutils.dir}">
            <arg line="install-jar"/>
        </exec>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Turbine easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-turbine" depends="build-turbine">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/turbine*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${turbine.dir}/target">
                <include name="**/turbine*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Torque easily                               -->
    <!-- ================================================================== -->
    <target name="upgrade-torque" depends="build-torque">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/${torque.zip}"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${torque.dir}/target">
                <include name="**/${torque.zip}"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Fulcrum easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-fulcrum" depends="build-fulcrum">

        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/fulcrum*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${fulcrum.dir}/target">
                <include name="**/fulcrum*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Stratum easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-stratum" depends="build-stratum">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/stratum*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${stratum.dir}/target">
                <include name="**/stratum*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of JCS easily                              -->
    <!-- ================================================================== -->
    <target name="upgrade-jcs" depends="build-jcs">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/jcs*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${jcs.dir}/target">
                <include name="**/jcs*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Collections easily                  -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-collections" depends="build-commons-collections">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-collections.dir}/dist">
                <include name="**/commons-collections*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Configuration easily        -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-configuration" depends="build-commons-sandbox-configuration">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-configuration*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-configuration.dir}/target">
                <include name="**/commons-configuration*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Xo easily        -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-xo" depends="build-commons-sandbox-xo">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-xo*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-xo.dir}/target">
                <include name="**/commons-xo*.jar"/>
            </fileset>
        </copy>
    </target>


    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Util easily                 -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-util" depends="build-commons-sandbox-util">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-util*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-util.dir}/target">
                <include name="**/commons-util*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Email easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-email" depends="build-commons-sandbox-email">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-email*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-email.dir}/target">
                <include name="**/commons-email*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Codec easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-codec" depends="build-commons-sandbox-codec">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-codec*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-codec.dir}/dist">
                <include name="**/commons-codec*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Sandbox-Lang easily                -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-sandbox-lang" depends="build-commons-sandbox-lang">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-lang*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-sandbox-lang.dir}/dist">
                <include name="**/commons-lang*.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our version of Commons-Beanutils easily                    -->
    <!-- ================================================================== -->
    <target name="upgrade-commons-beanutils" depends="build-commons-beanutils">
        <delete>
            <fileset dir="${lib.dir}">
                <include name="**/commons-beanutils*.jar"/>
            </fileset>
        </delete>
        <copy todir="${lib.dir}" filtering="no">
            <fileset dir="${commons-beanutils.dir}/dist">
                <include name="**/commons-beanutils.jar"/>
            </fileset>
        </copy>
    </target>

    <!-- ================================================================== -->
    <!-- Upgrade our cvs dependencies easily                                -->
    <!-- ================================================================== -->
    <target name="upgrade-jakarta-cvs">
        <echo>${fulcrum.dir}</echo>
        <cvs dest="${fulcrum.dir}" command="update"/>
        <echo>${stratum.dir}</echo>
        <cvs dest="${stratum.dir}" command="update"/>
        <echo>${jcs.dir}</echo>
        <cvs dest="${jcs.dir}" command="update"/>
        <echo>${torque.dir}</echo>
        <cvs dest="${torque.dir}" command="update"/>
        <echo>${turbine.dir}</echo>
        <cvs dest="${turbine.dir}" command="update"/>
        <echo>${commons-beanutils.dir}</echo>
        <cvs dest="${commons-beanutils.dir}" command="update"/>
        <echo>${commons-sandbox-util.dir}</echo>
        <cvs dest="${commons-sandbox-util.dir}" command="update"/>
        <echo>${commons-sandbox-configuration.dir}</echo>
        <cvs dest="${commons-sandbox-configuration.dir}" command="update"/>
        <echo>${commons-sandbox-xo.dir}</echo>
        <cvs dest="${commons-sandbox-xo.dir}" command="update"/>
        <echo>${commons-sandbox-email.dir}</echo>
        <cvs dest="${commons-sandbox-email.dir}" command="update"/>
        <echo>${commons-sandbox-codec.dir}</echo>
        <cvs dest="${commons-sandbox-codec.dir}" command="update"/>
    </target>
    
</project>
