<?xml version="1.0"?>

<!-- Scarab XML Import -->
<project name="import" default="xml-validate" basedir=".">

  <!-- Give user a chance to override without editing this file
      (and without typing -D each time it compiles it -->
  <property file="${user.home}/scarab.build.properties" /> 
  <property file="${user.home}/build.properties" />
  <property file="${basedir}/build.properties" />
  <property file="${basedir}/default.properties" />

  <property name="XMLImport.class" value="org.tigris.scarab.util.xml.XMLImport"/>
  <property name="scarab.import.xml" value="../src/dtd/scarab-sample.xml"/>
  <property name="scarab.import.config.file" value="/WEB-INF/conf/xmlimport.properties"/>
  <property name="scarab.import.trprops.file" value="/WEB-INF/conf/TurbineResources.properties"/>

  <!-- Build classpath -->
  <path id="classpath">
    <pathelement location="${build.dest.scarab}"/>
    <fileset dir="${basedir}/../lib">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${build.project.webinf.lib}">
      <include name="*.jar"/>
    </fileset>
  </path>

  <target name="prepare">
  
    <echo>
    Import file: ${scarab.import.xml}
    </echo>

    <available classname="${XMLImport.class}" 
               property="XMLImport.present">
      <classpath refid="classpath"/>
    </available>
  </target>

  <target name="prepare-error" depends="prepare" unless="XMLImport.present">
    <echo>
        XMLImport is not present! Please check to make sure that 
        Scarab has been built properly.
    </echo>
  </target>

  <target name="taskdef" depends="prepare-error">
    <taskdef name="XMLImport" 
             classname="${XMLImport.class}">
            <classpath refid="classpath"/>
    </taskdef>
  </target>

  <target name="xml-validate" depends="taskdef"
          description="Validate that the XML is correctly defined">

    <XMLImport
        xmlValidation="true"
        dbValidation="false"
        dbInsertion="false"
        xmlFile="${scarab.import.xml}"
        configDir="${build.project}"
        configFile="${scarab.import.config.file}"
        turbineResources="${scarab.import.trprops.file}"
        />
  </target>

  <target name="db-validate" depends="taskdef"
          description="Validate that the XML import will go into the database correctly">

    <XMLImport
        xmlValidation="true"
        dbValidation="true"
        dbInsertion="false"
        xmlFile="${scarab.import.xml}"
        configDir="${build.project}"
        configFile="${scarab.import.config.file}"
        turbineResources="${scarab.import.trprops.file}"
        />
  </target>

  <target name="db-import" depends="taskdef"
          description="Import the XML into the database">

    <XMLImport
        xmlValidation="false"
        dbValidation="true"
        dbInsertion="true"
        xmlFile="${scarab.import.xml}"
        configDir="${build.project}"
        configFile="${scarab.import.config.file}"
        turbineResources="${scarab.import.trprops.file}"
        />
  </target>

</project>
