<html>
<head>
<title>Scarab - MSSQL</title>
</head>

<body bgcolor="#ffffff">

<h2>Scarab - MSSQL</h2>
<h4>$Id: mssql.html,v 1.3 2003/07/18 18:28:22 dlr Exp $</h4>

<p>
Scarab has been developed with database independence in mind, however
our primary goal is to make Scarab work with MySQL. Therefore, our
support for other RDBM's is largely untested. We are relying on the user
community in order to help us test and develop further support for other
databases. This document outlines the steps that we think are required
to get Scarab working with MSSQL. <a
href="mailto:dev@scarab.tigris.org">Community feedback</a> on this
document will help improve things for others.
</p>

<p>The following instructions were supplied by Slobodan Mumovic who says
the one of the problems was the default jdbc connection pool configuration
does not work with MSSQL.</p>

<pre>
1. Override the default build properties by creating and editing the
scarab.build.properties file in the home directory. I used the following
settings:
scarab.database.type=mssql
scarab.database.host=yourMSSQLServer
scarab.database.port=1433
scarab.database.name=scarab
scarab.database.url=jdbc:microsoft:sqlserver://${scarab.database.host}:${sca
rab.database.port};databasename=${scarab.database.name};SelectMethod=Cursor
scarab.database.admin.url=jdbc:microsoft:sqlserver://${scarab.database.host}
:${scarab.database.port};databasename=${scarab.database.name};SelectMethod=C
ursor
scarab.database.jdbc.driver=com.microsoft.jdbc.sqlserver.SQLServerDriver
scarab.database.username=yourUserName
scarab.database.password=yourPassWord
scarab.database.admin.username=${scarab.database.username}
scarab.database.admin.password=${scarab.database.password}
scarab.database.manual.creation=true

2. Edit the <scarab>/src/conf/TurbineResources.properties file:
        2.1. comment out the following lines (this is important):
        #torque.dsfactory.scarab.factory=\
        #  org.apache.torque.dsfactory.Jdbc2PoolDataSourceFactory
        #torque.dsfactory.scarab.pool.defaultMaxActive=30
        #torque.dsfactory.scarab.pool.testOnBorrow=true


        2.2 add the following lines:
        
torque.dsfactory.scarab.factory=org.apache.torque.dsfactory.TorqueData
SourceFactory
        torque.dsfactory.scarab.pool.defaultMaxConnections=10
        torque.dsfactory.scarab.pool.maxExpiryTime=3600
        torque.dsfactory.scarab.pool.connectionWaitTimeout=10

3. Build the project using ant

4. Manually create the database in MSSQL Server with the user specified in
step 1. as the DBO

5. Execute the table creation scripts in:
<scarab>/target/webapps/scarab/WEB-INF/sql
according to the order in the LoadOrder.lst (or LoadOrder-Empty.lst) file

6. Start scarab.

A later email states Scarab is still not usable on MSSQL:

... So we never actually used Scarab on MSSQL due to the following problems:

1. Several tables are created with fields of type TEXT and IMAGE. This by
itself would not be a problem but the code (I believe torque) uses "SELECT
DISTINCT" on fields that contain TEXT and/or IMAGE. This could be fixed with
a clever and insightful remapping of the JDBC to MSSQL data types in torque
(/target/webapps/scarab/WEB-INF/src/torque/templates/sql/base/mssql/db.props
). But when I replaced IMAGE and TEXT with VARCHAR(xxxx) (where xxxx were
several experimental values chosen not to overflow over the allowed limit
for a data row) the result was that inserts of new issues simply hanged
without any log or debug message of the reason. 


I don't know on which of the following TABLES.FIELDS the SELECT DISTINCT
occurs, but here they are:
        TURBINE_USER.OBJECTDATA - has type IMAGE
        TURBINE_SCHEDULER_JOB.JOB_PROPERTY - has type IMAGE
        SCARAB_ACTIVITY.OLD_VALUE - type TEXT
        SCARAB_ACTIVITY.NEW_VALUE - type TEXT
        SCARAB_ATTACHMENT.ATTACHMENT_DATA - type TEXT
        SCARAB_ISSUE_ATTRIBUTE_VALUE.VALUE - type TEXT
        SCARAB_QUERY.VALUE - type TEXT
        SCARAB_REPORT.QUERY_STRING - type TEXT

2. The CONCAT SQL function is used in org.tigris.scarab.om.Issue in the
parseIssueList method. The CONCAT function is not supported by MSSQL and in
order to use a user defined function the function must be called with the
database user (eg. scarab.CONCAT) instead of just CONCAT. The problem is
solvable by editing the code and replacing CONCAT( x, y) with x + y (the
operator + is a concatenator in MSSQL). But that is far from elegant and it
certainly is not portable. So a better solution should be implemented. I
noticed this when trying to export issues to xml.

</pre>



</body>
</html>
