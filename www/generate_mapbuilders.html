<!-- $Id: generate_mapbuilders.html,v 1.1 2000/12/18 05:03:40 jon Exp $ -->
<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Jon Stevens">
<title>GenerateMapBuilders</title>
</head>
<body bgcolor="#F0F0F0">
&nbsp; 
<table border=0 cellpadding=2 width="98%" bgcolor="#FFFFFF" >
    <tr> 
        <td width="100%" bgcolor="#CCCC99"><font size=+1>GenerateMapBuilders</font></td>
    </tr>
</table>
<p>This is the documentation for <i>GenerateMapBuilders</i>, a Java tool for creating 
    MapBuilders from a SQL schema. Both <a href="http://java.apache.org/turbine/">Turbine</a> 
    and <a href="http://scarab.tigris.org/">Scarab</a> use Maps to perform Object-Relational 
    database mapping, essentially mapping a single object to a database table and 
    providing methods to store and retrieve information to and from the database 
    in a easy and convenient manner. The use of Maps is important because it can 
    alleviate the necessity of having to embed SQL code directly into the business 
    logic of an application. Instead, database logic is abstracted out into what 
    is called a <i>Peer</i> layer. Let us start off with a brief description of 
    some terminology... 
<p>A <i>MapBuilder</i> is a class that creates a <i>DatabaseMap</i>. A <i>DatabaseMap</i> 
    is an in memory representation of all the tables and columns in a database. 
    Thus, within a <i>DatabaseMap</i>, you will have a hashtable of <i>TableMaps</i> 
    and within the <i>TableMaps</i>, you will have a hashtable of <i>ColumnMaps</i>. 
<p>To create the various <i>MapBuilder</i> classes that <a href="http://scarab.tigris.org/">Scarab</a> 
    uses (see: <i>org.tigris.scarab.om.mapbuilder</i> package), you should employ 
    the <i>org.tigris.scarab.om.mapbuilder.GenerateMapBuilder</i> class to generate 
    the corresponding Java source files. Right now, the key items in this class 
    are all hard coded, so if you want to use it to generate the map builders yourself, 
    you will need to edit this class and hard code the paths to your scarab-mysql.sql 
    file and the directory where you want the generated files to be placed. <u>The 
    minor adjustments to this class to get it to take its arguments on the command 
    line would be an appreciated contribution. Please subscribe to the <a href="/project_mail.html">mailing 
    list</a> and post your contributions there.</u> 
<p>Essentially, the <i>GenerateMapBuilders</i> class functions by using some <a href="http://java.apache.org/turbine/">Turbine</a> 
    utility classes (see: <i>org.apache.turbine.util.db.map.MySQLSchemaToDatabaseMap</i>) 
    to build a <i>DatabaseMap</i> in memory and then dump that <i>DatabaseMap</i> 
    out to files with all the database relationships defined in the files. This 
    ends up saving about 3-4 days worth of tedious work and makes it easy to make 
    modifications to the .sql files and propogate those into the code that generates 
    the relationships. 
<p>Briefly, the generated code ends up looking something like the code below. The 
    <i>doBuild()</i> method is responsible for actually building the relationships 
    by adding the <i>ColumnMaps</i> and <i>TableMaps</i> to the <i>DatabaseMap</i>: 
<blockquote><font size=-1>&nbsp;&nbsp;&nbsp; /** SCARAB_ACTIVITY_ISSUE.ACTIVITY_ID 
    */</font> <br>
    <font size=-1>&nbsp;&nbsp;&nbsp; public static String getActivityIssue_ActivityId()</font> 
    <br>
    <font size=-1>&nbsp;&nbsp;&nbsp; {</font> <br>
    <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return getTable() + 
    ".ACTIVITY_ID";</font> <br>
    <font size=-1>&nbsp;&nbsp;&nbsp; }</font></blockquote>
<blockquote><font size=-1>&nbsp;&nbsp;&nbsp; public void doBuild ( )</font> <br>
    <font size=-1>&nbsp;&nbsp;&nbsp; {</font> <br>
    <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbMap = new DatabaseMap(getTable());</font> 
    <br>
    <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dbMap.addTable(getTable());</font> 
    <br>
    <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TableMap tMap = dbMap.getTable(getTable());</font> 
    <p><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tMap.addForeignPrimaryKey 
        ( getActivityIssue_ActivityId(), integer,</font> <br>
        <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
        ActivityMapBuilder.getTable(),</font> <br>
        <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
        ActivityMapBuilder.getActivity_ActivityId() );</font> 
    <p><font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tMap.addColumn ( 
        getActivityIssue_CreatedDate(), date);</font> <br>
        <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</font> <br>
        <font size=-1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</font> <br>
        <font size=-1>&nbsp;&nbsp;&nbsp; }</font> 
</blockquote>
<b>Why this is a good methodology</b> 
<p>Once the mappings have been defined, the next step is to create the <i>Peer</i> 
    objects for doing the actual database accesses (which will rely the static methods 
    in the <i>MapBuilders</i> in order to get the table names). The advantage of 
    this methodology is that you can change the name of a table or column and since 
    the <i>MapBuilder</i> static methods also share a similar naming convention, 
    you will get compiler warnings instead of having to search and replace through 
    your code. Additionally, by proxying all your database accesses through Peer 
    objects, modifications to those accesses are greatly simplified. Code is changed 
    in one place only (the corresponding Peer), rather than modifying a variety 
    of accesses scattered throughout your application's business logic. <br>
    &nbsp; 
</body>
</html>
