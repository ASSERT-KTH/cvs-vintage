<html>
<head>
<title>Scarab - Oracle</title>
</head>

<body bgcolor="#ffffff">

<h2>Scarab - Oracle</h2>
<h4>$Id: oracle.html,v 1.12 2003/05/13 13:14:15 thierrylach Exp $</h4>

<p>
Scarab has been developed with database independence in mind, however
our primary goal is to make Scarab work with MySQL. Therefore, our
support for other RDBM's is largely untested. We are relying on the user
community in order to help us test and develop further support for other
databases. This document outlines the steps that we think are required
to get Scarab working with Oracle. <a
href="mailto:dev@scarab.tigris.org">Community feedback</a> on this
document will help improve things for others.
</p>

<p>
<h4>Basic instructions</h4>
In order to get Torque to generate the right Scarab .sql files for
Oracle, try the following:
</p>

<ul>
    <li>Copy the Oracle jdbc driver .jar file into the scarab/lib/
        directory *before* building Scarab.
        If the jar is named to match the regular expression *oracle*.jar,
        the existing build process will copy it as necessary.</li>
    <li>Create a scarab/build/build.properties file.</li>
    <li>In it, fill out the following properties with the right information
pertaining to Oracle...ie: for database.*.url, create an Oracle JDBC URL.
For database.type, put 'oracle'. For jdbc.driver, put the Oracle
one....then, rm the target directory and rebuild.
</li>
</ul>

<p>
scarab.database.host=localhost<br />
scarab.database.port=<br />
scarab.database.url=<br />
scarab.database.admin.url=<br />
scarab.database.type=oracle<br />
scarab.database.jdbc.driver=oracle.jdbc.driver.OracleDriver<br />
scarab.database.username=<br />
scarab.database.password=<br />
scarab.database.admin.username=<br />
scarab.database.admin.password=<br />
<strike>scarab.database.validationQuery=SELECT 1 FROM DUAL</strike>
</p>

<small>Note: Effective with version 1.0 beta 12, it is no longer necessary
to add <code>scarab.database.validationQuery</code>
to <code>build.properties</code>.
It is automatically added when <code>scarab.database.type</code>
is set to <code>oracle</code>.
</small>

<p>
There is also some more discussion and information in <a
href="http://scarab.tigris.org/issues/show_bug.cgi?id=188">this reported
issue</a>.
</p>

<p>
<h4>Problem loading default data</h4>
<strike>
Recently another user has <a
href="http://scarab.tigris.org/issues/show_bug.cgi?id=259">reported</a>
 success with one required workaround.

The scarab-default-data.sql must be entered manually (in Oracle SQLPlus) 
after changing the default date format:
<pre>
SQL&gt;alter session set NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS';
SQL&gt;@scarab-default-data.sql
</pre>
</strike>
</p>
<small>Note: Effective with version 1.0 beta 12, it is no longer necessary
to manually execute <code>scarab-default-data.sql</code>
for it to load properly on Oracle.
The above <code>alter session</code>
is automatically run as part of the standard configuration.
</small>


<h4>Inconsistent Datatypes</h4>
There is an inconsistency with Turbine's handling
of <code>BLOB</code> datatypes under Oracle.
This usually manifests itself with an error similar to the following:

<pre>
  java.lang.RuntimeException: Please check turbine.log for more info: Failed to retrieve users: ORA-00932: inconsistent datatypes
	at org.tigris.scarab.om.ScarabModule.getUsers(ScarabModule.java:164)
	at org.tigris.scarab.tools.ScarabRequestTool.getUsers(ScarabRequestTool.java:1856)

        (remainder of stack trace omitted)

</pre>

There is currently no resolution to this problem.
<p>
A workaround is to edit the <code>webapps/scarab/WEB-INF/sql/turbine.sql</code> and
<code>webapps/scarab/WEB-INF/sql/scheduler.sql</code> files,
and change the columns defined as <code>BLOB</code>
to <code>VARCHAR2(4000)</code>. 

<p>

An alternate workaround would be to edit
<code>webapps/scarab/WEB-INF/src/torque/templates/sql/base/oracle/db.props</code>
and change the line which reads
<pre>

VARBINARY = BLOB

</pre>
to be
<pre>

VARBINARY = VARCHAR2(4000)

</pre>
This has the slight advantage of being slightly more persistent -
the only time that this file changes
is when a new version of Torque is added into Scarab,
or when "ant clean" or "ant clean-all" is run.


</body>
</html>
