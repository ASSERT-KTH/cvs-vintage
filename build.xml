<project name="Struts" default="compile.library" basedir=".">

  <!-- Initialization properties -->
  <property name="app.name"       value="struts"/>
  <property name="build.home"     value="target"/>
  <property name="catalina.home"  value="../jakarta-tomcat-4.0/build"/>
  <property name="debug"          value="true"/>
  <property name="deprecation"    value="false"/>
  <property name="dist.home"      value="${build.home}/dist"/>
  <property name="optimize"       value="true"/>
  <property name="project.name"   value="jakarta-struts"/>
  <property name="project.version" value="1.0-b1"/>
  <property name="tomcat.home"    value="../build/tomcat"/>

  <!-- BUILD:  Create directories and copy files for library -->
  <target name="prepare.library">
    <mkdir   dir="${build.home}"/>
    <mkdir   dir="${build.home}/library"/>
    <mkdir   dir="${build.home}/library/classes"/>
    <mkdir   dir="${build.home}/library/classes/META-INF"/>
    <mkdir   dir="${build.home}/library/classes/META-INF/tlds"/>
    <copy   file="src/conf/struts.tld"
          tofile="${build.home}/library/classes/META-INF/taglib.tld"/>
    <mkdir   dir="${build.home}/library/classes/org"/>
    <mkdir   dir="${build.home}/library/classes/org/apache"/>
    <mkdir   dir="${build.home}/library/classes/org/apache/struts"/>
    <mkdir   dir="${build.home}/library/classes/org/apache/struts/resources"/>
    <copy  todir="${build.home}/library/classes/org/apache/struts/resources">
      <fileset dir="src/conf" includes="**/*.dtd"/>
    </copy>
  </target>

  <!-- BUILD:  Prepare static directories for web applications -->
  <target name="static.webapps">
    <ant  antfile="build-webapps.xml" target="static">
    </ant>
  </target>

  <!-- BUILD:  Compile library directory components -->
  <target name="compile.library" depends="prepare.library">
    <javac srcdir="src/share"     destdir="${build.home}/library/classes"
           classpath="${servlet.jar}"
	   debug="${debug}" optimize="${optimize}"
     deprecation="${deprecation}"/>
    <copy   todir="${build.home}/library/classes">
      <fileset dir="src/share" includes="**/*.properties"/>
    </copy>
    <copy   todir="${build.home}/library">
      <fileset dir="src/conf" includes="*.dtd"/>
      <fileset dir="src/conf" includes="*.tld"/>
    </copy>
    <style basedir="src/doc" destdir="${build.home}/library"
         extension=".tld" style="stylesheets/tld.xsl"
          includes="struts-*.xml"/>
    <copy    todir="${build.home}/library/classes/META-INF/tlds">
      <fileset dir="${build.home}/library" includes="struts-*.tld"/>
    </copy>
    <jar  jarfile="${build.home}/library/${app.name}.jar"
         manifest="src/conf/MANIFEST.MF"
          basedir="${build.home}/library/classes" includes="**"/>
  </target>

  <!-- BUILD:  Compile code for web applications -->
  <target name="compile.webapps" depends="compile.library">
    <ant  antfile="build-webapps.xml" target="compile">
    </ant>
  </target>

  <!-- BUILD:  Create Javadoc documentation -->
  <target name="compile.javadoc">
    <delete   dir="${build.home}/documentation/api"/>
    <mkdir    dir="${build.home}/documentation/api"/>
    <javadoc sourcepath="src/share"
                destdir="${build.home}/documentation/api"
              classpath="${servlet.jar}:${java.class.path}"
           packagenames="org.apache.struts.*"
	         author="true"
                private="true"
                version="true"
            windowtitle="Apache Struts API Documentation"
               doctitle="&lt;h1&gt;Apache Struts Framework (Version ${project.version})&lt;/h1&gt;"
                 bottom="Copyright &#169; 2000-2001 - Apache Software Foundation"/>
  </target>

  <!-- DIST:  Create directories and copy files for distribution -->
  <target name="prepare.dist">
    <mkdir   dir="${dist.home}"/>
    <mkdir   dir="${dist.home}/etc"/>
    <mkdir   dir="${dist.home}/lib"/>
    <mkdir   dir="${dist.home}/src"/>
    <mkdir   dir="${dist.home}/web"/>
    <mkdir   dir="${dist.home}/webapps"/>
  </target>

  <!-- DIST:  Construct library distributables -->
  <target name="dist.library" depends="prepare.dist,compile.library">
    <copy   todir="${dist.home}/lib">
      <fileset dir="${build.home}/library" includes="*.dtd"/>
      <fileset dir="${build.home}/library" includes="*.jar"/>
      <fileset dir="${build.home}/library" includes="*.tld"/>
    </copy>
  </target>

  <!-- DIST:  Construct distributable web applications -->
  <target name="dist.webapps" depends="compile.javadoc">
    <ant  antfile="build-webapps.xml" target="dist">
    </ant>
  </target>

  <!-- DIST:  Copy sources -->
  <target name="dist.source" depends="prepare.dist">
    <copy   todir="${dist.home}/etc">
      <fileset dir="." includes="build.*"/>
    </copy>
    <copy    file="INSTALL" tofile="${dist.home}/INSTALL"/>
    <copy    file="LICENSE" tofile="${dist.home}/LICENSE"/>
    <copy    file="README"  tofile="${dist.home}/README"/>
    <copy   todir="${dist.home}/src">
      <fileset dir="src"/>
    </copy>
    <copy   todir="${dist.home}/web">
      <fileset dir="web"/>
    </copy>
  </target>

  <!-- DIST:  Construct complete release distribution -->
  <target name="dist"
       depends="dist.library,dist.webapps,dist.source"/>

  <!-- DEPLOY:  Deploy these applications on Catalina -->
  <target name="deploy.catalina" depends="compile.webapps">
    <mkdir   dir="${catalina.home}/webapps/struts-blank"/>
    <copy  todir="${catalina.home}/webapps/struts-blank">
      <fileset dir="${build.home}/blank"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-blank/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
    <mkdir   dir="${catalina.home}/webapps/struts-documentation"/>
    <copy  todir="${catalina.home}/webapps/struts-documentation">
      <fileset dir="${build.home}/documentation"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-documentation/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
    <mkdir   dir="${catalina.home}/webapps/struts-example"/>
    <copy  todir="${catalina.home}/webapps/struts-example">
      <fileset dir="${build.home}/example"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-example/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
    <mkdir   dir="${catalina.home}/webapps/struts-template"/>
    <copy  todir="${catalina.home}/webapps/struts-template">
      <fileset dir="${build.home}/template-example"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-template/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
    <mkdir   dir="${catalina.home}/webapps/struts-exercise-taglib"/>
    <copy  todir="${catalina.home}/webapps/struts-exercise-taglib">
      <fileset dir="${build.home}/exercise-taglib"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-exercise-taglib/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
    <mkdir   dir="${catalina.home}/webapps/struts-upload"/>
    <copy  todir="${catalina.home}/webapps/struts-upload">
      <fileset dir="${build.home}/upload"/>
    </copy>
    <copy  todir="${catalina.home}/webapps/struts-upload/WEB-INF/lib">
      <fileset dir="${xerces.home}" includes="xerces.jar"/>
    </copy>
  </target>

  <!-- DEPLOY:  Deploy these applications on Tomcat -->
  <target name="deploy.tomcat" depends="compile.webapps">
    <mkdir   dir="${tomcat.home}/webapps/struts-blank"/>
    <copy  todir="${tomcat.home}/webapps/struts-blank">
      <fileset dir="${build.home}/blank"/>
    </copy>
    <mkdir   dir="${tomcat.home}/webapps/struts-documentation"/>
    <copy  todir="${tomcat.home}/webapps/struts-documentation">
      <fileset dir="${build.home}/documentation"/>
    </copy>
    <mkdir   dir="${tomcat.home}/webapps/struts-example"/>
    <copy  todir="${tomcat.home}/webapps/struts-example">
      <fileset dir="${build.home}/example"/>
    </copy>
    <mkdir   dir="${tomcat.home}/webapps/struts-template"/>
    <copy  todir="${tomcat.home}/webapps/struts-template">
      <fileset dir="${build.home}/template-example"/>
    </copy>
    <mkdir   dir="${tomcat.home}/webapps/struts-exercise-taglib"/>
    <copy  todir="${tomcat.home}/webapps/struts-exercise-taglib">
      <fileset dir="${build.home}/exercise-taglib"/>
    </copy>
    <mkdir   dir="${tomcat.home}/webapps/struts-upload"/>
    <copy  todir="${tomcat.home}/webapps/struts-upload">
      <fileset dir="${build.home}/upload"/>
    </copy>
  </target>

  <!-- UTILITY:  Display all targets intended for developer use -->
  <target name="targets">
    <echo message=""/>
    <echo message="ANT build for ${project.name} ${project.version}"/>
    <echo message=""/>
    <echo message="The following targets are available:"/>
    <echo message="  all                     Cleans and builds library and webapps"/>
    <echo message="  clean                   Cleans the build and distribution directories"/>
    <echo message="  compile.javadoc         Builds Javadoc API docs for Struts"/>
    <echo message="  compile.library         Builds the main packages"/>
    <echo message="  compile.webapps         Builds the web applications"/>
    <echo message="  deploy.catalina         Deploys build to Catalina build directory"/>
    <echo message="  deploy.tomcat           Depoys build to Tomcat build directory"/>
    <echo message="  dist                    Builds binary distribution in dist directory"/>
    <echo message=""/>
    <echo message="Default target is 'compile.library'"/>
  </target>

  <!-- UTILITY:  Clean up build and distribution directories -->
  <target name="clean">
    <delete dir="${build.home}"/>
  </target>

  <!-- UTILITY:  All-in-one build target -->
  <target name="all"
       depends="clean,compile.library,compile.webapps"/>

</project>
