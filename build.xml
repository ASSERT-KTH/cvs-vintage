<project name="Tomcat" default="main" basedir=".">
  <property name="build.compiler" value="classic"/>
  <property name="dest" value="../build/tomcat"/>

  <target name="main">
    <mkdir dir="${dest}"/>
    <mkdir dir="${dest}"/>
    <mkdir dir="${dest}/classes"/>
    <mkdir dir="${dest}/etc"/>
    <mkdir dir="${dest}/src"/>
    <mkdir dir="${dest}/lib"/>
    <copydir src="src/webpages" dest="${dest}/webpages"/>
    <copydir src="src/examples" dest="${dest}/examples"/>
    <copydir src="src/share/javax" dest="${dest}/src/javax"/>
    <copyfile src="../jakarta-tools/projectx-tr2.jar"
     dest="${dest}/lib/xml.jar"/>
    
    <!-- XXX move all this copyfile stuff into a seperate dir so that
         we can just copy the dir into the correct location!!! -->
    
    <copyfile src="src/shell/startup.sh" dest="${dest}/startserver"/>
    <copyfile src="src/shell/startup.bat"
     dest="${dest}/startserver.bat"/>
    <copyfile src="src/shell/shutdown.sh" dest="${dest}/stopserver"/>
    <copyfile src="src/shell/shutdown.bat"
     dest="${dest}/stopserver.bat"/>
    <copyfile src="src/share/org/apache/tomcat/shell/deployment/server.xml"
     dest="${dest}/server.xml"/>
    <copyfile src="src/share/org/apache/tomcat/shell/deployment/server.xml"
     dest="${dest}/etc/server.xml"/>
    <copyfile src="src/share/org/apache/tomcat/shell/deployment/server.dtd"
     dest="${dest}/etc/server.dtd"/>
    <copyfile src="src/share/org/apache/tomcat/deployment/web.xml"
     dest="${dest}/etc/web.xml"/>
    <copyfile src="src/share/org/apache/tomcat/deployment/web.dtd"
     dest="${dest}/etc/web.dtd"/>
    <copyfile src="src/etc/license.txt" dest="${dest}/LICENSE"/>
    <copyfile src="src/etc/readme" dest="${dest}/README"/>
    <copyfile src="src/etc/faq" dest="${dest}/FAQ"/>
    <copyfile src="src/etc/SimpleStartup.java"
     dest="${dest}/etc/SimpleStartup.java"/>

    <javac srcdir="src/share" destdir="${dest}/classes"
     classpath="${dest}/lib/xml.jar" debug="on"/>
    <javac srcdir="src/examples/WEB-INF/classes"
     destdir="${dest}/examples/WEB-INF/classes"
     classpath="${dest}/classes"/>

    <javac srcdir="src/examples/jsp/plugin/applet"
     destdir="${dest}/examples/jsp/plugin/applet"/>

    <rmic base="${dest}/classes"
     class="org.apache.tomcat.shell.AdminImpl"/>

     <javac srcdir="${dest}/examples/WEB-INF/classes/jsp/tags"
            destdir="${dest}/examples/WEB-INF/classes/jsp/tags"
            classpath="${dest}/classes"/>
     <mkdir dir="${dest}/examples/jsp/libs"/>
     <jar jarfile="${dest}/examples/jsp/libs/taglib.jar" 
          basedir="${dest}/examples/WEB-INF/classes/jsp/tags"
          items="examples,META-INF/taglib.tld"/>

	  
  </target>

  <target name="dist" depends="main">
    <jar jarfile="${dest}/webserver.jar"
        basedir="${dest}/classes"
        items="org/apache/tomcat"/>
    <jar jarfile="${dest}/lib/servlet.jar"
        basedir="${dest}/classes"
        items="javax/servlet"/>
    <jar jarfile="${dest}/lib/jasper.jar"
        basedir="${dest}/classes"
        items="org/apache/jasper"/>
    <deltree dir="${dest}/classes"/> 
  </target>

  <target name="test" depends="main">
    <mkdir dir="./test"/>
    <mkdir dir="./test/tomcat"/>
    <mkdir dir="./test/tomcat/classes"/>
    <mkdir dir="./test/tomcat/lib"/>

    <copydir src="src/tests/webpages"
        dest="./test/tomcat/webpages"/>

    <copyfile src="src/shell/runtest.sh"
        dest="./test/tomcat/runtest"/>
    <copyfile src="src/shell/runtest.bat"
        dest="./test/tomcat/runtest.bat"/>
    <copyfile src="src/tests/server.xml"
        dest="./test/tomcat/server.xml"/>
    <copyfile src="src/tests/testlist.txt"
        dest="./test/tomcat/testlist.txt"/>
    <copyfile src="src/lib/moo.jar"
        dest="./test/tomcat/lib/moo.jar"/>

    <javac srcdir="src/tests/share"
        destdir="./test/tomcat/classes"
        classpath="${dest}/classes:${dest}/lib/servlet.jar:${dest}/webserver.jar:../jakarta-tools/moo.jar"/>
    <javac srcdir="src/tests/webpages/WEB-INF/classes"
        destdir="./test/tomcat/webpages/WEB-INF/classes"
        classpath="${dest}/classes:${dest}/lib/servlet.jar"/>
  </target>

  <target name="servlet">

    <mkdir dir="${dest}"/>
    <mkdir dir="${dest}/classes"/>

    <javac srcdir="src/share/javax" destdir="${dest}/classes"/>

    <jar jarfile="../jakarta-tools/servlet-2.2.0.jar"
        basedir="${dest}/classes"
        items="javax"/>

  </target>

  <target name="clean">
    <deltree dir="${dest}"/>
  </target>

    <target name="all" depends="clean,main,dist,test"/>
  
</project>
