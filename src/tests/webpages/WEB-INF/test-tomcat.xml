<project name="TestRun" default="main">
   <!-- 
        To test tomcat standalone, type:
          bin/tomcat.sh ant -f conf/test-tomcat.xml client
        or for Windows systems, type:
          bin\tomcat.bat ant -f conf/test-tomcat.xml client
        
        To test apache, type:
          bin/tomcat.sh ant -f conf/test-tomcat.xml -Dport=<your port> -Dhttp.protocol=HTTP/1.1 client-apache
        or for Windows systems, type:
          bin/tomcat.bat ant -f conf/test-tomcat.xml -Dport=<your port> -Dhttp.protocol=HTTP/1.1 client-apache
	  Specify <your port> from "Port" setting in apache's httpd.conf file.

        Works best if you manually start tomcat, and if necessary apache.  If you use this file's
        "main" or "apache" targets, tomcat may not start fast enough to avoid failing some of the
        early tests.
    -->
  
     <property name="host" value="localhost" />
     <property name="port"     value="8080" />
     <property name="outputType"     value="text" />
     <property name="debug"     value="0" />
     <property name="http.protocol" value="HTTP/1.0" />

     <property name="gdir" value="../Golden" />

     <!-- ==================== Tasks ==================== -->     
     <taskdef name="gtest" classname="org.apache.tomcat.util.test.GTest" />
     <taskdef name="httpClient" 
	      classname="org.apache.tomcat.util.test.HttpClient" />
     <taskdef name="header" 
	      classname="org.apache.tomcat.util.test.Header" />
     <taskdef name="body" 
	      classname="org.apache.tomcat.util.test.Body" />
     <taskdef name="defaultMatcher" 
	      classname="org.apache.tomcat.util.test.DefaultMatcher" />

     <taskdef name="gtestDefaults" 
	      classname="org.apache.tomcat.util.test.TestDefaults" />

  <!-- ==================== Defaults ==================== -->
  <target name="init" >
    <gtestDefaults port="${port}" 
		   host="${host}"
		   debug="${debug}" 
		   protocol="${http.protocol}"
		   outputType="${outputType}" />
  </target>
  <!-- ==================== File tests ==================== -->
  <target name="new-style" depends="init">
      <gtest>
          <httpClient path="/test/index.html" debug="0">
             <header name="foo" value="bar"/>
             <body>RequestBody</body>
          </httpClient>
          <defaultMatcher returnCode="200">
             <header name="Content-Type" value="text/html"/>
          </defaultMatcher>
      </gtest>
   </target>


  <!-- ==================== File tests ==================== -->
  <target name="file" depends="init">
    <gtest  description="Content Type Test"
           request="GET /test/binaries/image1.gif HTTP/1.0"
           expectHeaders="Content-Type:image/gif" />

    <gtest  description="File Integrity and Length Test"
           request="GET /test/binaries/image1.gif HTTP/1.0"
           goldenFile="${gdir}/image1.gif"
           exactMatch="true"  />

  </target>

  <target name="file-tomcat" depends="init,file">
    <gtest  description="Welcome File Test1"
           request="GET /test/welcome HTTP/1.0"
           expectHeaders="Location:/welcome/" 
           returnCode="${http.protocol} 302" />

    <gtest  description="Welcome File Test2"
           request="GET /test/binaries HTTP/1.0"
           returnCode="${http.protocol} 200" />

    <gtest  description="Welcome File Test3"
           request="GET /test/welcome/ HTTP/1.0"
           returnCode="${http.protocol} 302" 
           goldenFile="${gdir}/movedwelcome.txt" />
   </target>

  <target name="file-apache" depends="init,file">
    <gtest  description="Welcome File Test1"
           request="GET /test/welcome HTTP/1.0"
           expectHeaders="Location:/welcome/" 
           returnCode="${http.protocol} 301" />

    <gtest  description="Welcome File Test2"
           request="GET /test/binaries HTTP/1.0"
           returnCode="${http.protocol} 301" />

    <!-- Tomcat returns 302 --> 
    <gtest  description="Welcome File Test3"
           request="GET /test/welcome/ HTTP/1.0"
           returnCode="${http.protocol} 200" 
           goldenFile="${gdir}/welcome.txt" />
  </target>

  <!-- ==================== Dispatch tests ==================== -->
    <target name="dispatch" depends="init">
      <gtest  description="SimpleInclude"
             request="GET /test/servlet/dispatch.SimpleIncludeServlet HTTP/1.0"
             expectHeaders="Content-Type:text/foobar" 
             returnCode="${http.protocol} 200"
             goldenFile="${gdir}/SimpleInclude.txt" 
       />
      <gtest  description="SimpleForward"
             request="GET /test/servlet/dispatch.SimpleForwardServlet HTTP/1.0"
             expectHeaders="Content-Type:text/funky" 
             returnCode="${http.protocol} 200"
             goldenFile="${gdir}/SimpleForward.txt" 
       />

      <!-- Removed: the test calls RequestDispatcher.include(), and 
           the included servlet throws an exception. 
           Before Tomcat 3.2(3?) the exception was hidden - now we correctly
           throw it, so include() will throw exception, and since it's not
           catched no response should be seen. ( costin )
        

      <gtest  description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="PreInclude" 
       />
      <gtest  description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="PostInclude" 
       />
      <gtest  description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="Included servlet error: 500" 
       />
       End removed 
       -->
 
      <gtest  description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="${http.protocol} 500"
       />
 

      <gtest  description="Mismatch2"
             request="GET /test/servlet/dispatch.Mismatch2 HTTP/1.0"
             returnCode="${http.protocol} 200"
             goldenFile="${gdir}/Mismatch2.txt" 
       />

      <gtest  description="IncludeMismatch1-1"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="LINE1" 
       />

      <!-- BAD test: the included Target1 will call getWriter, 
          and IllegalState will be thrown - and catched by the IncludeMismatch.
          No error handler will be involved - the Dispatcher spec clearly 
          requires include() to propagate exceptions. 
          Previous behavior of tomcat was wrong. ( costin )
      <gtest  description="IncludeMismatch1-2"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="error: 500" 
       />
      -->

      <gtest  description="IncludeMismatch1-3"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="LINE1" 
       />

      <gtest  description="IncludeFile"
             request="GET /test/servlet/dispatch.IncludeFileServlet HTTP/1.0"
             returnCode="${http.protocol} 200"
             expectHeaders="Content-Type:text/foobar" 
             goldenFile="${gdir}/IncludeFile.txt" 
       />

      <!-- Parameter order may change 
      <gtest  description="ForwardWithQuery"
             request="GET /test/servlet/dispatch.ForwardWithQueryServlet?name=Sun%20Microsystems&amp;age=100000&amp;city=Cupertino HTTP/1.0"
             returnCode="${http.protocol} 200"
             expectHeaders="Content-Type:text/funky" 
             goldenFile="${gdir}/ForwardWithQuery.txt" 
       />    
       -->

    

    </target>

    <target name="dispatch-tomcat" depends="init,dispatch">
      <gtest  description="SimpleRedirect"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?/index.html HTTP/1.0"
             expectHeaders="Location:http://${host}:${port}/index.html" 
             returnCode="${http.protocol} 302" 
       />
      <gtest  description="SimpleRedirect2"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?index.html HTTP/1.0"
             expectHeaders="Location:http://${host}:${port}/test/servlet/index.html" 
             returnCode="${http.protocol} 302" 
       />
    </target>

    <target name="dispatch-apache" depends="init,dispatch">
      <gtest  description="SimpleRedirect"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?/index.html HTTP/1.0"
             returnCode="${http.protocol} 302" 
       />
      <gtest  description="SimpleRedirect2"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?index.html HTTP/1.0"
             returnCode="${http.protocol} 302" 
       />
    </target>

  <!-- ==================== Jsp tests ==================== -->
  <target name="jsp" depends="init">
    <gtest request="GET /test/jsp/special-name.foo.jsp HTTP/1.0"
	   returnCode="200"
    />

    <gtest  request="GET /test/jsp/HelloWorld.jsp HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
    />

    <gtest  request="GET /test/doesNotExist.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           description="Getting -- HTTP/1.0 302 Found"
           magnitude="false" />

    <gtest  request="GET /test/.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/HelloWorld.jsp?????? HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
           debug="0"
    />

    <gtest  request="GET /test/jsp/HelloWorld.jsp?a=b&amp;c=d HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
           debug="0"
    />

    <gtest  request="GET /test/jsp/HelloWorld.jsp?&amp;&amp; HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
    />

    <gtest  request="GET /test/jsp/declaration/IntegerOverflow.jsp HTTP/1.0"
           returnCode="${http.protocol} 500"
           debug="0"
    />

    <gtest  request="GET /test/jsp/error/err.jsp HTTP/1.0"
           goldenFile="${gdir}/Err.txt"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/forward/forward.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/jsptoserv/jsptoservlet.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/jsptoservlet.txt"
    />

    <gtest  request="GET /test/jsp/initDestroy.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/classTest.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/classTest.txt"
    />

    <gtest  request="GET /test/jsp/import.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/import.txt"
    />

    <gtest  request="GET /test/jsp/buffer.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/buffer.txt"
    />

    <gtest  request="GET /test/jsp/buffer1.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/buffer2.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/buffer3.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/buffer4.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/comments.jsp HTTP/1.0"
           returnCode="${http.protocol} 500"
    />

    <gtest  request="GET /test/jsp/parse.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/parse.txt"
    />

    <gtest  request="GET /test/jsp/pageInfo.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageLanguage.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageIsThreadSafe.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageSession.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageAutoFlush.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageError.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/pageExtends.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageIsErrorPage.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageContentType.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/pageImport2.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageImport.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/pageImport.txt"
    />

    <gtest  request="GET /test/jsp/beanTest1.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/beanTest.txt"
    />

    <gtest  request="GET /test/jsp/beanTest2.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/beanScopePage.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/beanScopeSession.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           debug="0"
    />

    <gtest  request="GET /test/jsp/implicitOut.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitOut.txt"
    />

    <gtest  request="GET /test/jsp/implicitConfig.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitConfig.txt"
    />

    <gtest  request="GET /test/jsp/implicitException.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitException.txt"
    />

    <gtest  request="GET /test/jsp/implicitPageContext.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitPageContext.txt"
    />

    <gtest  request="GET /test/jsp/implicitContext.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitContext.txt"
    />

    <gtest  request="GET /test/jsp/implicitRequest.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitRequest.txt"
    />

    <gtest  request="GET /test/jsp/implicitResponse.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitResponse.txt"
    />

    <gtest  request="GET /test/jsp/implicitSession.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitSession.txt"
    />

    <gtest  request="GET /test/jsp/implicitPageContext.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/implicitPageContext.txt"
    />

    <gtest  request="GET /test/jsp/pageInvalid.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageDouble.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET /test/jsp/pageContent3.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/servlet/servletParam1 HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/servletParam1.txt"
    />

    <gtest  request="GET /test/servlet/servletParam2 HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/servletParam2.txt"
    />

    <gtest  request="GET /test/servlet/ServletParam HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/ServletParam.txt"
    />

    <gtest  request="GET /test/jsp/bigDeclaration.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

    <gtest  request="GET /test/jsp/include/include.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           goldenFile="${gdir}/Include.txt"
    />
 
    <gtest  request="GET /test/jsp/chinese.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

   <gtest  request="GET /test/jsp/japanese.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

   <gtest  request="GET /test/jsp/extends1.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" 
    />

   <gtest  request="GET /test/jsp/extends2.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" 
    />

   <gtest  request="GET /test/jsp/extends3.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

   <gtest  request="GET /test/jsp/extends4.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
    />

   </target>

  <target name="jsp-tomcat" depends="init,jsp">
    <gtest  request="GET /test/jsp/ HTTP/1.0"
           goldenFile="${gdir}/movedindex.txt"  
           description="Redirects to index.html"
    />

   </target>

  <target name="jsp-apache" depends="init,jsp">
    <gtest  request="GET /test/jsp/ HTTP/1.0"
           goldenFile="${gdir}/index.txt"  
           description="Serves index.html"
    />

   </target>

  <target name="wrong_request" depends="init">
    <gtest  request="GET /test/*.jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <gtest  request="GET *jsp HTTP/1.0"
           returnCode="${http.protocol} 200"
           magnitude="false" />

    <!-- Hangs on apache - apache expects a 1.0 request 
        gtest  request="GET /test/jsp/HelloWorld.jsp HTTP"
           returnCode="${http.protocol} 400"
    /-->

    <!-- Hangs on apache - apache expects a 1.0 request 
        gtest  request="GET /test/jsp/HelloWorld.jsp 1.0"
           returnCode="${http.protocol} 400"
    / -->

    <!-- Hangs on apache - apache expects a 1.0 request 
       gtest  request="GET /test/jsp/HelloWorld.jsp /1.0"
           returnCode="${http.protocol} 400"
    / -->

  </target>

  <target name="http09" depends="init">
    <echo message="Testing HTTP 0.9 compatibility"/>


  </target> 

   <target name="get" depends="init">
      <!-- hit unavailable servlet 1st time -->
      <gtest  request="GET /test/servlet/Unavailable HTTP/1.0"
             returnCode="${http.protocol} 503"
      />

      <gtest  request="GET /test/servlet/Cookie25 HTTP/1.0"
             expectHeaders="Set-Cookie:foo=bar; Version=1; Max-Age=8640000"
      />

      <gtest  request="GET /test/servlet/ResponseError HTTP/1.0"
             returnCode="${http.protocol} 400"
             responseMatch="Wrong data"
      />

      <gtest description="HTTP 0.9 can't return a response code"
	     request="GET /test/request/uri/does/not/exist"
             returnCode="404" magnitude="false"
      />

      <gtest description="HTTP 0.9, check the body for 404"  
	     request="GET /test/request/uri/does/not/exist"
             responseMatch="404"
      />

      <gtest  request="GET /test/request/uri/does/not/exist HTTP/1.0"
             returnCode="${http.protocol} 404"
      />

      <gtest  request="GET /test/"
             returnCode="Error: "
             magnitude="false" />

      <!-- Hangs apache - it starts with " ", apache expects a 1.0 request
           gtest  request="   GET   /   "
             returnCode="Error: "
             magnitude="false" / -->

      <!-- tolerate bad request for now
      <gtest  request="   GET   /   HTTP/1.0"
             returnCode="${http.protocol} 200"
      />
      -->

      <!-- tolerate bad request for now
      <gtest  request="GET /test/index.ht ml HTTP/1.0"
             returnCode="${http.protocol} 400"
      />
      -->

      <!-- tolerate bad request for now
      <gtest  request="   GET   /index.ht ml HTTP/1.0 "  
             returnCode="${http.protocol} 400"
      />
      -->


      <gtest  request="GET /test/servlet HTTP/1.0"
             returnCode="${http.protocol} 404"
      />

      <gtest  request="GET /test/servlet/ HTTP/1.0"
             returnCode="${http.protocol} 404"
      />

      <gtest  request="GET /test/servlet/foo HTTP/1.0"
             returnCode="${http.protocol} 404"
      />

   </target>

   <target name="get-tomcat" depends="init,get" >
      <gtest  request="GET /test/ HTTP/1.0"
             returnCode="${http.protocol} 302"
      />

      <gtest  request="GET /test/welcome HTTP/1.0"
             returnCode="${http.protocol} 302"
      />
   </target>

   <target name="get-apache" depends="init,get">
      <gtest  request="GET /test/ HTTP/1.0"
             returnCode="${http.protocol} 200"
      />

      <gtest  request="GET /test/welcome HTTP/1.0"
             returnCode="${http.protocol} 301"
      />
   </target>

   <target name="requestMap" depends="init" >
      <gtest  description="/foo/bar/index.html : 1.0 : 200"
             request="GET /test/foo/bar/index.html HTTP/1.0"
             responseMatch="Servlet: Servlet1"
            />

      <gtest  description="/foo/bar/index.bop : 1.0 : 200"
             request="GET /test/foo/bar/index.bop HTTP/1.0"
             responseMatch="Servlet: Servlet1"
            />

      <gtest  description="/baz : 1.0 : 200"
             request="GET /test/baz HTTP/1.0"
             responseMatch="Servlet: Servlet2"
            />

      <gtest  description="/baz/index.html : 1.0 : 200"
             request="GET /test/baz/index.html HTTP/1.0"
             responseMatch="Servlet: Servlet2"
            />

      <gtest  description="/catalog : 1.0 : 200"
             request="GET /test/catalog HTTP/1.0"
             responseMatch="Servlet: Servlet3"
            />

      <gtest  description="/catalog/index.html : 1.0 : 200"
             request="GET /test/catalog/index.html HTTP/1.0"
             returnCode="${http.protocol} 404"
             />

      <gtest  description="/catalog/racecar.bop : 1.0 : 200"
             request="GET /test/catalog/racecar.bop HTTP/1.0"
             responseMatch="Servlet: Servlet4"
            />

      <gtest  description="/index.bop : 1.0 : 200"
             request="GET /test/index.bop HTTP/1.0"
             responseMatch="Servlet: Servlet4"
            />
   </target>

  <target name="post1" depends="init" > 
    <gtest  description="Content Type Test"
           request="POST /test/servlet/Post HTTP/1.0"
           debug="10"
           content="Test POST BODY" />
   </target>
   
   <target name="post" depends="init" >
      <gtest  request="POST /test/servlet/request.NotThere HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 404"
            />

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 200"
            />

      <gtest  request="GHOST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 501"
            />

      <!-- Hangs on apache, apache expects a 1.0 requets
        gtest  request="POST /test/servlet/request.EchoServlet HT TP/1.0"
             content="name=lightness of being"
             returnCode="Error: 400"
            /-->

      <!-- tomcat will wait a request - it's the same as if the client will do a post and stop
           transmiting.
           XXX XXX Tomcat needs timeout 
      <gtest  request="POST "
             content="name=lightness of being"
             returnCode="Error: 400"
            />
       -->

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content=""
             returnCode="${http.protocol} 200"
            />

      <gtest  request="POST /test/servlet HTTP/1.0"
             content=""
             returnCode="${http.protocol} 404"
            />

      <gtest  request="POST /test/servlet/ HTTP/1.0"
             content=""
             returnCode="${http.protocol} 404"
            />

      <gtest description="HTTP0.9 doesn't have a POST method" 
	     request="POST /test/"
             content=""
             returnCode="${http.protocol} 400"
	     magnitude="false"
            />

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 200"
            />

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being,,,,,,,....###///&amp;&amp;@@@@@***"
             returnCode="${http.protocol} 200"
            />

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being,,,,,,,....###///&amp;&amp;&amp;&amp;@@@@@***"
             returnCode="${http.protocol} 200"
            />

      <gtest  request="POST /test/servlet/request.EchoServlet?name=sun&amp;age=2000 HTTP/1.0"
             content="name=lightness of being,,,,,,,....###///&amp;@@@@@***"
             returnCode="${http.protocol} 200"
            />

      <!-- I have no idea what this should return - 
      <gtest  request="POST \ HTTP/1.0"
             content="name=lightness of being"
             returnCode="Error: 400"
            />
      -->

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 200"
            />

      <gtest  request="post /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="${http.protocol} 501"
            />

      <!-- tolerate bad request for now
      <gtest  request="GET http://www.javasoft.com/index.html HTTP/1.0   "
             returnCode="${http.protocol} 400"
            />
      -->

      <gtest  request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             headers="Content-Encoding: x-gzip"
             content="name=lightness of being"
             returnCode="${http.protocol} 200"
            />

      <!-- Can't be OK - we don't implement HTTP/4.4 
       gtest  request="POST /test/servlet/request.EchoServlet  HTTP/4.4"
             content="name=lightness of being"
             returnCode="${http.protocol} 200"
            / -->
   </target>

   <!-- ============= unavailable servlet tests ============= -->
   <target name="unavailable" depends="init" >
      <gtest  request="GET /test/servlet/PermanentlyUnavailable HTTP/1.0"
             returnCode="${http.protocol} 503"
      />
      <!-- again for good measure -->
      <gtest  request="GET /test/servlet/PermanentlyUnavailable HTTP/1.0"
             returnCode="${http.protocol} 503"
      />
      <!-- this one was loaded on startup - Can't find it ( costin )
      <gtest  request="GET /test/servlet/PermanentlyUnavailable2 HTTP/1.0"
             returnCode="${http.protocol} 503"
      />
       -->
   
      <!-- 2nd hit on the unavailable servlet should succeed -->
      <gtest  request="GET /test/servlet/Unavailable HTTP/1.0"
             returnCode="${http.protocol} 200"
             responseMatch="Hello"
      />
   </target>

   <!-- ============= restricted access tests ============= -->
   <target name="restricted" depends="init" >
      <gtest  request="GET /test/WEB-INF HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/WEB-INF/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/WEB-INF HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/WEB-INF/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/WEB-INF/classes HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <!-- For Windows systems, insure blocking is not case sensitive! -->
      <gtest  request="GET /test/web-inf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/web-inf/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/web-inf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/web-inf/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/WEB-INF/web.xml HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/WEB-INF/web.xml HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/WEB-INF/web.Xml HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/web-inf/web.xml HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/META-INF HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/META-INF/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/META-INF HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/META-INF/ HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/meta-inf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/META-INF/Manifest.mf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/../test/META-INF/Manifest.mf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest  request="GET /test/META-INF/Manifest.Mf HTTP/1.0"
             returnCode="${http.protocol} 4" />

      <gtest request="GET /test/meta-inf/Manifest.mf HTTP/1.0"
             returnCode="${http.protocol} 4" />
   </target>

   <target name="startup">
     <java classname="org.apache.tomcat.startup.Tomcat" args="" />
   </target>


   <target name="client" depends="file-tomcat,dispatch-tomcat,get-tomcat,requestMap,post,jsp-tomcat,wrong_request,unavailable,restricted">
   </target>

   <target name="client-apache" depends="file-apache,dispatch-apache,get-apache,post,jsp-apache,wrong_request,unavailable,restricted">
   </target>

   <target name="shutdown">
     <java classname="org.apache.tomcat.startup.Tomcat" args="-stop" />
   </target>


   <target name="main" depends="startup,client,shutdown" />

   <target name="apache" depends="startup,client-apache,shutdown" />

</project>

