<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <!-- $Id: tomcat-ug.html,v 1.12 2001/08/29 01:49:05 larryi Exp $ -->
    <!-- Copyright 1999-2001 Apache Software Foundation -->
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Tomcat User's Guide</title>
    <!-- Changed by: Costin Manolache, 20-Mar-2000 -->
    <!-- Changed by: Gal Shachor, 27-Mar-2000 -->
</head>

<body link="#0000ff" vlink="#800080">

<!-- Banner element, all hail the Project! -->

<table border="0" width="100%" cellspacing="0" cellpadding="0">
      <tr>
		<td width="50%"><a
			href="http://jakarta.apache.org/index.html"><img
			src="images/banner.gif" width="350" height="100"
			alt="The Jakarta Project" border="0"></a></td>
		<td width="50%" align="right"><img border="0" src="images/tomcat.gif" width="100" height="71" alt="The mighty Tomcat - Meow!"></td>
      </tr>
</table>
    

<H1>Tomcat 3.3 User's Guide</H1>

<p>This document is an introduction to the Tomcat 3.3 servlet
	container. It should be enough for anyone to install,
	configure, and deploy Tomcat 3.3, or later. As well, it answers many
	questions common to new users. If you have any comments or suggestions
	about this document don't hesitate to send them to the
	Tomcat <a	href="http://jakarta.apache.org/site/mail.html">mailing
	lists</a>.</p>

      <p>This document began life as <cite>Tomcat: A Minimalistic User's
      Guide</cite> by Gal Shachor, and has been revised by many others.
      It should be considered a <strong>work in progress</strong>.  Since the
      Tomcat source tree is constantly changing, the information
      herein may be out of date.  The only definitive reference at
      this point is the <a
      href="http://jakarta.apache.org/site/sourceindex.html">source
      code</a>.</p>

    <p>&quot;???&quot; means I'm not sure if this should go in, or
	where it should go or be referred to as, if it does indeed
	belong. Other editorial comments are surrounded in [square brackets].</p>
		
<p>Other important documents:</p>

<ul>
	<li><a href="http://jakarta.apache.org/site/faqs.html">Jakarta FAQ Page</a></li>
	<li><A HREF="appdev/contents.html">Application Development
		manual</A> - an alternative to the User's Guide,
		somewhat out-of-date</li>
	<li>Other <a href="index.html">Tomcat Documentation</a>
		including HOWTOs for various web servers</li>
</ul>


<h2>Table of Contents</h2>

<p>[This section needs to be revised to match current outline. Wouldn't
it be nice if we used XSL to generate this file from an XML source?]</p>

<ul>
	<li><a href="#about_tomcat">About Tomcat</a>
    <ul>
		<li><a href="#what_is_tomcat">What is Tomcat?</a></li>
		<li><a href="#where_download">Where can I download
			Tomcat?</a></li>
		<li><a href="#just_jserv">Isn't Tomcat just JServ?</a></li>
		<li><a href="#what_servlets_jsps">What are
			servlets? What are JSPs?</a></li>
		<li><a href="#contribute">How do/can I contribute?</a></li>
		<li><a href="#where_help">How come X, Y, or Z isn't
			working? Help!</a>
	</ul>
      </li>
	<li><a href="#installing_tomcat">Installing Tomcat</a>
	<ul>
		<li><a href="#file_placement">File placement and
			environment setup</a></li>
		<li><a href="#starting_and_stopping">Starting and
			stopping Tomcat</a></li>
		<li><a href="#starting_another_dir">Starting
			multiple instances w/individual server.xml files</a></li>
		<li><a href="#directory_structure">Tomcat directory
			structure</a></li>
		<li><a href="#tomcat_scripts">Tomcat scripts</a><br>
	</ul>
      </li>
  <li><a href="#container_types">Types of servlet
			containers</a></li>
	<li><a href="#configuring_tomcat">Configuring Tomcat</a>
	<ul>
    <li><a href="#configuring_classes">Configuring Classes</a></li>
    <li><a href="#configuring_server">Configuring the Server</a></li>
		<li>Web application/context security and authorization</li>
		<li>tomcat-users.xml</li>
		<li>JDBC realms</li>
	</ul>
      </li>
	<li><a href="#webapps">Deploying Web Applications</a></li>
		<li><a href="#webapp">What is a Web Application?</a></li>
		<li><a href="#what_is_war">What is a WAR file?</a></li>
		<li><a href="#deploying_war">Deploying WAR files in Tomcat</a><br>
<br>
      </li>
      <li><a href="#tutorials">Tomcat Tutorials</a> - ???</li>
		<li>Deploying application</li>
		<li>Creating your first web application ???</li>
		<li>Creating and configuring your first servlet ???<br>
<br>
      </li>
      <li><a href="#real_world_tips">Real World Configuration Tips</a></li>
      <li><a href="#common_errors">Common Installation and Configuration
		Problems</a>
	<ul>
		<li><a href="#error_bad_command">&quot;Bad command or
        filename&quot; when executing Tomcat scripts</a></li>
		<li><a href="#error_8007">http://webserver:8007/
        gives an HTTP 500</a></li>
		<li><a href="#error_ignore_directives">Apache &lt;Directory&gt;
        and &lt;Location&gt; directives ignored</a></li>
		<li><a href="#error_web_server">Web server won't
        start when Tomcat is running</a></li>
	</ul>
</li>
      <li><a href="#credits">Credits</a></li>
</ul>

<hr size="5">


<h2><a name="about_tomcat">About Tomcat: Q&amp;A</a></h2>

<p>See also the official <a
	href="http://jakarta.apache.org/site/faqs.html">Jakarta FAQ Page</a>.</p>

<dl>
	<dt><strong><a name="what_is_tomcat">What is Tomcat?</a></strong></dt>
	<dd>Tomcat is the official reference implementation of the <a
		href="http://java.sun.com/products/servlet/">Java
		Servlet 2.2</a> and <a
		href="http://java.sun.com/products/jsp/">JavaServer
		Pages 1.1</a> technologies. Developed under the Apache
		license in an open and participatory environment, it is
		intended to be a collaboration of the best-of-breed
		developers from around the world.</dd>

	<dt><strong><a name="where_download">Where can I download
		Tomcat?</a></strong></dt>
	<dd>At the <a
		href="http://jakarta.apache.org/site/binindex.html">Jakarta
		download page</a>!</dd>

	<dt><strong><a name="just_jserv">Isn't Tomcat just
		JServ?</a></strong></dt>
	<dd>This is a common misunderstanding. <a
		href="http://java.apache.org/jserv">JServ</a> is a
		Servlet API 2.0-compliant container that was created to
		be used with Apache. Tomcat is a complete re-write and
		is a Servlet API 2.2 and JSP 1.1-compliant container.
		Tomcat uses some of the code written for JServ,
		especially JServ's Apache server adapter, but this is
		where the similarities end.</dd>
	<dt><strong><a name="what_servlets_jsps">What are servlets? What
		are JSPs?</a></strong></dt>
	<dd>In a nutshell, servlets are memory-resident Java programs,
		running inside a servlet container (<em>e.g.,</em>
		Tomcat!). Because they're memory-resident, they can
		quickly respond to requests, as they do not incur the
		overhead of process creation and subsequent cleanup,
		unlike CGI-based scripting, e.g. perl, etc.
      
		<p>From <a href="http://java.sun.com/products/servlet/">Sun's
      servlet site</a>:</p>
    
		<blockquote>&quot;The <strong>Java<sup><font
			size="-2">TM</font></sup> Servlet API</strong>
			provides web developers with a simple,
			consistent mechanism for extending the
			functionality of a web server and for accessing
			existing business systems. A servlet can almost
			be thought of as an applet that runs on the
			server side -- without a face.&quot;</blockquote>

		<p>...and about JSPs (JavaServer Pages), again from <a
			href="http://java.sun.com/products/servlet/">Sun's
			servlet site</a>:</p>

		<blockquote>&quot;JSP technology is an extension of the
			servlet technology created to support authoring
			of HTML and XML pages. It makes it easier to
			combine fixed or static template data with
			dynamic content.&quot;</blockquote>

		<p>JSP is comparable to other technologies such as PHP
			and ASP, which combine programming/scripting
			with a markup language like HTML. The key
			difference being the programming language of
			choice. For example, PHP uses a C/C++/Java
			hybrid, ASP uses VBScript, and JSP utilizes the
			full power of the Java programming language.
			There have been many comparisons of these
			technologies, and each has its place in the
			astute developer's toolbox.</p>

		<p>All of the above information is available at <a
			href="http://java.sun.com/">Sun's Java
			website</a>, which is a starting place for all
			the ins and outs of JSPs, servlets, etc.
			<strong>Your time spent with these technologies
			will be much more rewarding if you first read
			through the <a
			href="http://java.sun.com/products/jsp/download.html">JavaServer
			Pages</a> and <a
			href="http://java.sun.com/products/servlet/download.html">servlet</a>
			specifications!</strong></p>
	</dd>
    
	<dt><strong><a name="contribute">How do/can I contribute?</a></strong></dt>
	<dd>Please do! See the Jakarta project contribution page, right
		<a
		href="http://jakarta.apache.org/site/getinvolved.html">here</a>.
		You'll probably want to <a
		href="mailto:tomcat-dev-subscribe@jakarta.apache.org">subscribe</a>
		to the <strong>tomcat-dev</strong> mailing list.</dd>

	<dt><strong><a name="where_help">How come X, Y, or Z isn't
		working? Help!</a></strong></dt>
	<dd>While we hope to cater to many common issues, we have
		undoubtedly missed some. For more help, try (in this
		order):

<ol>
	<li>Your log files, in the <a href="#logs_dir_defn">logs</a>
		subdirectory of your Tomcat installation. These are an
		untapped resource!</li>      
	<li>The <a href="#common_errors">Common problems</a> section of
		this document.</li>
	<li>Have a look through the <a
		href="http://jakarta.apache.org/site/faqs.html">
		Jakarta FAQ Page</a>. Most installation and configuration
		questions can be found here.</li>      
	<li>Search the Tomcat <a
		href="http://mikal.org/interests/java/tomcat/index.html">user</a>
		and <a
		href="http://www.metronet.com/~wjm/tomcat/">developer</a>
		list archives.</li>
	<li>Post a question to the <strong> tomcat-user</strong> <a
		href="http://jakarta.apache.org/site/mail.html">
		mailing list</a>, which you must first <a
		href="mailto:tomcat-user-subscribe@jakarta.apache.org">subscribe</a>
		to if you'd like to see any replies!</li>
</ol>

	</dd>
</dl>

<hr size="5">


<h2><a name="installing_tomcat">Installing Tomcat</a></h2>


<h4><a name="file_placement">File placement and environment setup</a></h4>

<blockquote>

    In the following steps, <i>&lt;version&gt;</i> will be &quot;3.3&quot; for the initial
    Tomcat 3.3 release, and &quot;3.3.<i>x</i>&quot; for subsequent maintenance releases.
    
    <ul>
      <li><a href="http://jakarta.apache.org/site/binindex.html">Download</a> the
        appropriate jakarta-tomcat-<i>&lt;version&gt;</i> binary file.</li><p>
    
      <li>Unzip the file into some directory (say /usr/local or C:\). This
          should create a new subdirectory named
          <code>&quot;jakarta-tomcat-<i>&lt;version&gt;</i>&quot;</code>.</li><p>
    
      <li>In a shell or DOS window, change to the
          <code>&quot;jakarta-tomcat-<i>&lt;version&gt;</i>&quot;</code> directory.</li><p>

      <li>Set the environment variable JAVA_HOME to point to the root
          directory of your JDK hierarchy.  You may optionally add the Java
          interpreter to your PATH environment variable. The exact directory
          may vary from system to system. Check your local file system to be sure
          where Java is installed.<p>
        	<ol>
          	<li>Win32:<br>
              	<tt><big>
              	set JAVA_HOME=c:/jdk1.3.1<br>
              	set PATH=%JAVA_HOME%\bin;%PATH%
              	</big></tt>
              	</li>
          	<li>Unix (bash/sh):<br>
              	<tt><big>
              	set JAVA_HOME=/user/local/java/jdk1.3.1; export JAVA_HOME<br>
              	set PATH=$JAVA_HOME/bin:$PATH; export PATH<br>
              	</big></tt>
              	</li>
          	<li>Unix (tcsh):<br>
              	<tt><big>
              	setenv JAVA_HOME=/user/local/java/jdk1.3.1<br>
              	setenv PATH=$JAVA_HOME/bin:$PATH<br>
              	</big></tt>
              	</li>
        	</ol></li><p>

      <li>You may optionally set the TOMCAT_HOME environment variable.  If
		  the supplied shell/batch scripts are executed from
          <tt>&quot;jakarta-tomcat-<i>&lt;version&gt;</i>&quot;</tt> or from
          its &quot;bin&quot; subdirectory, then they will successfully set
          TOMCAT_HOME for you if not already set.  If you wish to execute
          these shell/batch scripts from other directories, you must set
          TOMCAT_HOME explicitely.<p>
        <ol>
          <li>On Win32 systems you should type: <br>
              <tt><big>set TOMCAT_HOME=c:\jakarta-tomcat-<i>&lt;version&gt;</i>
              </big></tt></li>
          <li>On UNIX (using bash/sh) you should type: <br>
              <tt><big>TOMCAT_HOME=/usr/local/jakarta-tomcat-<i>&lt;version&gt;</i> ; export TOMCAT_HOME
              </big></tt></li>
          <li>On UNIX (using tcsh) you should type: <br>
              <tt><big>setenv TOMCAT_HOME=/usr/local/jakarta-tomcat-<i>&lt;version&gt;</i>
              </big></tt></li>
        </ol></li><p>
        
      <li>If you are using Win9x, you will need to deal with the potential
        &quot;Out of environment space&quot; problem, if you haven't already.
        There are several ways to deal with this.<p>
        <ol>
          <li>A global solution is to add a &quot;SHELL&quot; command to your
              <code>CONFIG.SYS</code> file.  Click Start -> Run and
              enter <code>sysedit</code>.  Then click OK.  In the
              <code>C:\CONFIG.SYS</code> window, add the line:
              <pre>SHELL=C:\COMMAND.COM /E:4096 /P</pre>
              and click File -> Save.  Then click File -> Exit and
              reboot your system. The default amount of environment space will
              now be 4096 bytes, more than enough for Tomcat.</li>
          <li>If you plan on always starting Tomcat 3.3 from the
              &quot;MS-DOS Prompt&quot;, open a &quot;MS-DOS Prompt&quot;.
              Right click on the icon in the upper left corner of the DOS
              window and select Properties.  In this dialog, select the Memory
              tab and change the &quot;Initial environment:&quot; setting
              to 4096.  Click OK and close the MS-DOS window. Now, when you
              open an &quot;MS-DOS Prompt&quot;, you should be able to start
              and stop Tomcat.</li>
          <li>If you like double-clicking files in Windows Explorer, you can
              execute <code>sysedit</code> as described in the first
              method and add the <code>&quot;set JAVA_HOME ...&quot;</code> line
              from above to the <code>AUTOEXEC.BAT</code> file.  Next in Windows
              Explorer, navigate to Tomcat's <code>bin</code> directory.  Right
              click on the <code>startup.bat</code> file and select Properties.
              Set the &quot;Inital environment:&quot; as described in the second
              method. Also select the Program tab and check the &quot;Close on
              exit&quot; option. Repeat this procedure for the <code>shutdown.bat</code>
              file. Reboot the system so the change to the <code>AUTOEXEC.BAT</code>
              file can take effect.  Now you should be able to double-click
              on the <code>startup.bat</code> and <code>shutdown.bat</code> files
              in Windows Explorer to start and stop Tomcat.</li>
        </ol></li>
    </ul>

<p>That's it! You can now <a href="#starting_and_stopping">
	execute Tomcat</a> and it will run as a <a
	href="#type_1"> stand-alone</a> servlet container.</p>

    <p>Once you're sure they work, you may wish to set these environment
      variables in a config file: C:/AUTOEXEC.BAT for Windows, ~/.bash_profile
      or ~/.cshrc, etc.</p>

</blockquote>

<h4><a name="starting_and_stopping">Starting and stopping Tomcat</a></h4>

    <blockquote>
      <p>You start and stop Tomcat using the scripts in
      the bin subdirectory of <a href="#tomcat_home_env">TOMCAT_HOME</a>.</p>
    <P>To start Tomcat, execute:</P>
    <blockquote style="margin-right: 0px">
      <p>On UNIX: bin/startup.sh</p>
      <p>On Win32: bin\startup</p>
    </blockquote>
    <p>To stop Tomcat, execute:</p>
    <blockquote style="margin-right: 0px">
      <p>On UNIX: bin/shutdown.sh</p>
      <p>On Win32: bin\shutdown</p>
    </blockquote>
    
    </blockquote>

<h4><a name="starting_another_dir">Starting multiple instances with
    	individual server.xml files</a></h4>

    <blockquote>
    
    <p>This might not make a whole lot of sense until you read the next section
    explaining Tomcat's <a href="#directory_structure">directory structure</a>,
    as well as <a href="#configuring_tomcat">Configuring Tomcat</a>. You
    may want to come back here afterwards.</p>
    
    <p>By default, Tomcat will use TOMCAT_HOME/conf/server.xml for
    configuration, which by default, uses TOMCAT_HOME as its base for the contexts.
    You can change this by using the &quot;-f /path/to/server.xml&quot; option, with a
       different server configuration file and setting the home attribute of
       the <a href="#context_manager_element">ContextManager</a> element. You need to set up the required files inside the
       home:</p>
        <ul>
          <li>webapps/ - all war files will
              be expanded and all subdirectories added as contexts.</li>
          <li>conf/ directory - you can store a special web.xml and other
              configuration files.</li>
          <li>logs/ - all logs will go to this directory instead of the main
              TOMCAT_HOME/logs/.</li>
          <li>work/ - work directories for the contexts.
          </li>
        </ul>

    <p>If the home attribute of the ContextManager element in server.xml is relative, it
       will be relative to the current working directory.</p>

    </blockquote>

<h4><a name="directory_structure">The Tomcat directory structure</a></h4>

    <blockquote>
      <p>Assuming you extracted the Tomcat binary distribution
       you should have the following directory structure under <a href="#tomcat_home_env">TOMCAT_HOME</a>:</p>

<table border=1 width="75%" valign="center">
      <tr>
        <th bgcolor="#c0c0c0" WIDTH="15%">Directory</th>
        <th bgcolor="#c0c0c0" WIDTH="85%">Contents</th>
      </tr>
      <tr>
        <td WIDTH="15%" align="center">bin</td>
        <td WIDTH="85%"> Startup/shutdown scripts and other useful files.</td>
      </tr>
      <tr>
        <td WIDTH="15%" align="center">conf</td>
        <td WIDTH="85%"> <a hrev="#configuring_server">Configuration files</a>,
          including  modules.xml, server.xml, and a number of apps-<i>&lt;name&gt;</i>.xml</a>.
        </td>
      </tr>
    <tr>
      <td width="15%" align="center">conf/auto</td>
      <td width="85%">Directory where auto-generated configuration files are
        written.</td>
	  </tr>
	  <tr>
      <td width="15%" align="center">conf/jk</td>
      <td width="85%">Directory containing mod_jk specific configuration files.</td>
	  </tr>
	  <tr>
      <td width="15%" align="center">conf/jserv</td>
      <td width="85%">Directory containing mod_jserv specific configuration files.</td>
	  </tr>
	  <tr>
      <td width="15%" align="center">conf/users</td>
      <td width="85%">Directory containing user name/password configuration files.
        These are used by the SimpleRealm module for authentication.</td>
	  </tr>
    <tr>
      <td WIDTH="15%" align="center">doc</td>
      <td WIDTH="85%">Miscellaneous documents regarding Tomcat.</td>
    </tr>
    <tr>
      <td WIDTH="15%" align="center">lib</td>
      <td WIDTH="85%">Jar files that are used for starting and stopping Tomcat.</td>
    </tr>
	  <tr>
      <td width="15%" align="center">lib/container</td>
      <td width="85%">Jar files that make up the Tomcat server classes.  Any
        Jar file in this directory is automatically included in Tomcat's
        <b>Server Classloader</b>.  See 
        <a href="#configuring_classes">Configuring Classes</a>.</td>
	  </tr>
	  <tr>
      <td width="15%" align="center">lib/common</td>
      <td width="85%">Jar files that contain classes shared between the Tomcat
        server and all web applications. Any Jar file in this directory is
        automatically included in Tomcat's <b>Common Classloader</b>.  See 
        <a href="#configuring_classes">Configuring Classes</a>.</td>
	  </tr>
      <td width="15%" align="center">lib/apps</td>
      <td width="85%">Jar files that contain classes shared between all web
        applications. Any Jar file in this directory is automatically included
        in Tomcat's <b>Apps Classloader</b>.  See 
        <a href="#configuring_classes">Configuring Classes</a>.</td>
    <tr>
      <td WIDTH="15%" align="center"><a name="logs_dir_defn">logs</a></td>
      <td WIDTH="85%"> This is where Tomcat places its log files by default.</td>
    </tr>
	  <tr>
	    <td width="15%" align="center">modules</td>
		  <td width="85%">Directory where &quot;plugin&quot; jars are placed.</td>
	  </tr>
	  <tr>
	    <td width="15%" align="center">native</td>
		  <td width="85%">Base directory for native souce code.</td>
	  </tr>
    <tr>
      <td WIDTH="15%" align="center">src</td>
      <td WIDTH="85%">Currently empty.  Tomcat's source code isn't currently
       part of the binary distribution.</td>
    </tr>
    <tr>
      <td WIDTH="15%" align="center">webapps</td>
      <td WIDTH="85%"> Sample web applications. Any .war files placed
        here will be automatically expanded.  See <a href="#deploying_war">Deploying WAR files</a>.</td>
    </tr>
</table>

    <p>Additionally you can, or Tomcat will, create the following
        directories:</p>
    <table border="1" width="75%" VALIGN="center">
      <tr>
        <td width="15%" align="center"> <a name="work_dir_defn"> work</a></td>
        <td width="85%"> Where Tomcat
             places intermediate files (such as compiled JSP files) during 
             its work. If you delete this directory while Tomcat is running 
             you will not be able to execute JSP pages.
        </td>
      </tr>
      <tr>
        <td width="15%" align="center">classes</td>
        <td width="85%"> Any class that you add to this directory will 
             find its place in Tomcat's classpath.
        </td>
      </tr>
</table>

</blockquote>

	<h4><a name="tomcat_scripts">Tomcat scripts</a></h4>
    <p>This section is not required reading, as the default functionality
    provided by the aforementioned startup and shutdown scripts is sufficient
    for most users to get started. If everything is working so far, skip ahead to <a href="#configuring_tomcat">Configuring
    Tomcat</a>. Come back to this section when you'd like more information
    on these scripts, which you undoubtedly will.</p>

    <p>Tomcat is a Java program, and therefore it is possible to execute
       it from the command line, after setting several environment 
       variables. However, setting each environment variable and following 
       the command line parameters used by Tomcat is error prone and 
       tedious. Instead, the Tomcat development team provides a few scripts 
       to ease starting and stopping Tomcat.</p>

<p><strong>Note: The scripts are only a convenient way to start/stop.
	You can modify them to customize the CLASSPATH, environment
        variables such as PATH and LD_LIBRARY_PATH, etc., so long as a
	correct command line is generated for Tomcat.</strong></p>

    <p>The following table presents the scripts that are
      most important for the common user:</p>

<table border=1 width="75%" valign="center">
      <tr>
        <th bgcolor="#c0c0c0" width="15%"> Script name </th>
        <th bgcolor="#c0c0c0" width="85%"> Description </th>
      </tr>
      <tr>
        <td width="15%" align="center"> tomcat </td>
        <td width="85%"> The main script. Sets the proper environment, including
          CLASSPATH, TOMCAT_HOME and JAVA_HOME, and starts Tomcat with
          the proper command line parameters.</td>
      </tr>
      <tr>
        <td width="15%" align="center"> startup </td>
        <td width="85%"> Starts tomcat in the background. Shortcut for &quot;tomcat start&quot; </td>
      </tr>
      <tr>
        <td width="15%" align="center"> shutdown </td>
        <td width="85%"> Stops tomcat (shutting it down). Shortcut for &quot;tomcat stop&quot; </td>
      </tr>
</table>

    <p>The script which has the most significance for users is tomcat
       (tomcat.sh/tomcat.bat). The other Tomcat related scripts serve as a
       simplified single-task oriented entry point to the tomcat script (set
       different command line parameters etc.).</p>

<h4><a name="tomcat_scripts_closer">Tomcat scripts: a closer look</a></h4>

    <p>A closer look at tomcat.sh/tomcat.bat yields that it performs the
      following actions:</p>

      <p>These behaviors, especially CLASSPATH setting, have changed
      with Tomcat 3.2.  It is best to look directly at the scripts for
      details on what variables are set and what class files are
      loaded. [??? - delete entire section pending reexamination?]</p>

<table border =1 width="75%" valign="center">
      <tr>
        <th bgcolor="#c0c0c0" width="15%"> Operating System </th>
        <th bgcolor="#c0c0c0" width="85%"> Actions </th>
      </tr>
      <tr>
    <td width="15%" align="center"> Unix </td>
    <td width="85%">
      <ul>
        <li>Guessing what is TOMCAT_HOME if it is not
          specified.</li>
          
        <li>Guessing what is JAVA_HOME if it is not
          specified.</li>
          
        <li>Setting up a CLASSPATH that contains -
          
          <ol>
            <li>The ${TOMCAT_HOME}/classes directory (if available).</li>
              
            <li>All the contents of ${TOMCAT_HOME}/lib. </li>
          
            <li>${JAVA_HOME}/lib/tools.jar (this jar file contains the tool
                javac, we need javac for jsp files).</li>
          </ol></li>
        <li>Executes java with command line parameters that set up a java
            system environment, called tomcat.home, with
            org.apache.tomcat.startup.Tomcat as the startup class. It also
            passes command line parameters to 
            org.apache.tomcat.startup.Tomcat, such as:
          
          <ol>
            <li>The operation to perform start/stop/run/etc.</li>
            <li>A path to the server.xml used by this Tomcat process.</li>
          </ol>

          <p>For example if server.xml is located in /etc/server_1.xml and
             the user wants to start apache in the background they should 
             provide the following command line:</p>

             <div>bin/tomcat.sh start -f /etc/server_1.xml</div>
           </li>
       </ul>
        </td>
      </tr>
      <tr>
    <td width="15%" align="center"> Win32 </td>
    <td width="85%">
      <ul>
        <li>Setting up a CLASSPATH that contains -
          
          <ol>
            <li> servlet.jar, webserver.jar, jasper.jar, xml.jar from the
                %TOMCAT_HOME%\lib directory, </li>
            <li> %TOMCAT_HOME%\classes (even if does not exist), </li>
            <li> %JAVA_HOME%\lib\tools.jar (this jar file contains the tool
                 javac, we need javac for jsp files).</li>
         </ol></li>
        <li>Executes java, assuming that it is in the PATH, with command line
        parameters that set up a java system environment, called tomcat.home,
        with org.apache.tomcat.startup.Tomcat as the startup class. It also
        passes command line parameters to org.apache.tomcat.startup.Tomcat,
        such as:
          
        <ol>
            <li>The operation to perform start/stop/run/etc.</li>

            <li>A path to the server.xml used by this Tomcat process. </li>
        </ol>
        <p>For example if server.xml is located in conf\server_1.xml and
           the user wants to start apache in the background they should 
           provide the following command line: 
           <div>bin\tomcat.bat start -f conf\server_1.xml</div>

        </li></ul>
        </td>
      </tr>
</table>

    <p>As you can see, the Win32 version of tomcat.bat pales in comparison to the Unix
      one. Especially it does not guess the values of TOMCAT_HOME and
      JAVA_HOME and it also doesn't take add all of the .jar files into the classpath.</p>

<hr size="5">


<h3><a name="container_types">Servlet Container Types</a></h3>

<p>Tomcat, like any servlet container, is meant to run behind a web
    server.  The web server takes care of receiving HTTP requests from
    client browsers; the servlet container takes care of serving
    Servlets and JSPs for those URLs that request them.</p>
<p>In Tomcat's case, there are three different modes of execution
    Tomcat supports.</p>

<dl>
	<dt><strong><a name="type_1">Stand-alone servlet containers</a></strong></dt>
	<dd>These are an integral part of the web server. This is the
		case when using a Java-based web server, for example the
		servlet container that is part of the JavaWebServer.
		Stand-alone is the default mode used by Tomcat. Most web
		servers, however, are not Java-based, which leads us to
		the next two container types.</dd>
        
	<dt><strong>In-process servlet containers</strong></dt>
	<dd>The servlet container is a combination of a web server
		plugin and a Java container implementation. The web
		server plugin opens a JVM inside the web server's
		address space and lets the servlet container run in it.
		If a certain request should execute a servlet, the
		plugin takes control over the request and passes it
		(using <a
		href="http://java.sun.com/products/jdk/1.2/docs/guide/jni/index.html">JNI</a>)
		to the servlet container. An in-process container is
		suitable for multi-threaded single-process servers and
		provides good performance but is limited in
		scalability.</dd>
            
	<dt><strong>Out-of-process servlet containers</strong></dt>
	<dd>The servlet container is a combination of a web server
		plugin and a Java container implementation that runs in
		a JVM outside the web server. The web server plugin and
		the Java container JVM communicate using some IPC
		mechanism (usually TCP/IP sockets). If a certain request
		should execute a servlet the plugin takes control over
		the request and passes it (using IPC) to the servlet
		container. The response time of an out-of-process engine
		is not as good as in the in-process one but the
		out-of-process engine performs better in many measurable
		ways (scalability, stability, etc.).</dd>   
</dl>

    <p>Tomcat can be used as either a stand-alone container
      (mainly for development and debugging) or as an add-on to an
      existing web server (currently Apache, IIS and Netscape servers are 
      supported). This means that whenever you are deploying Tomcat you will 
      have to decide how to use it and, if you select options 2 or 3, you
      will also need to install a web server adapter.</p>

      <p>If this is your first time configuring Tomcat and you plan on integrating
      it with a web server, you're better off initially running it
      stand-alone. You'll be better able to isolate errors during
      integration with your web server when you do so in the future - &quot;Is
      Tomcat or my web server at fault for the error I'm seeing?&quot;</p>

<hr size="5">


<h2><a name="configuring_tomcat">Configuring Tomcat</a></h2>

<p>There are two parts to Tomcat configuration:</p>
<ul>
  <li>Configuring classes</li>
  <li>Configuring the server</li>
</ul>

<h3><a name="configuring_classes">Configuring Classes</a></h3>

<p>Configuring classes refers to configuring what classes are available and the
scope of their availability when Tomcat 3.3 is running.  You may wish to add
additional classes and jars.  Also, a web application may need some modification
based on what Tomcat 3.3 makes available by default.</p>

<p>The available classes is determined by the classloader hierarchy that
Tomcat 3.3 creates when it starts up.  The classloader hierarchy built by
Tomcat 3.3 looks like this:</p>

<table align="center" class="cltable" border="0" cellspacing="0">
  <tr><td>
    <table align="center">
      <tr><td class="clt_loader">Server Classloader</td></tr>
      <tr><td class="clt_label">directory:</td></tr>
      <tr><td class="clt_data">lib/container</td></tr>
      <tr><td class="clt_label">default contents:</td></tr>
      <tr>
        <td class="clt_data">crimson.jar<br>facade22.jar<br>
          jasper.jar<br>jaxp.jar<br>tomcat_modules.jar<br>tomcat_util.jar<br>
          tomcat-startup.jar<br>xalan.jar</td></tr>
    </table></td>
	<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>
    <table align="center">
      <tr><td class="clt_loader">Webapp Classloader(s)</td></tr>
      <tr><td class="clt_label">directory:</td></tr>
      <tr><td class="clt_data">WEB-INF/classes<br>WEB-INF/lib</td></tr>
	  <tr><td align="center">|</td></tr>
      <tr><td class="clt_loader">Apps Classloader</td></tr>
      <tr><td class="clt_label">directory:</td></tr>
      <tr><td class="clt_data">lib/apps</td></tr>
      <tr><td class="clt_label">default contents:</td></tr>
      <tr><td class="clt_data"><i>empty</i></td></tr>
	  </table>
	</td></tr>
  <tr><td>&nbsp;</td><td align="center">\</td><td>&nbsp;</td><td align="center">/</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>
    <table align="center">
      <tr><td class="clt_loader">Common Classloader</td></tr>
      <tr><td class="clt_label">directory:</td></tr>
      <tr><td class="clt_data">lib/common</td></tr>
      <tr><td class="clt_label">default contents:</td></tr>
      <tr>
        <td class="clt_data">connector_util.jar<br>core_util.jar<br>jasper-runtime.jar<br>
          servlet.jar<br>tomcat_core.jar</td></tr>
	  </table>
	</td>
	<td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td align="center">|</td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>
    <table align="center">
      <tr><td class="clt_loader">Application Classloader</td></tr>
      <tr><td class="clt_data">the CLASSPATH classloader</td></tr>
      <tr><td class="clt_label">default contents:</td></tr>
      <tr><td class="clt_data">tomcat.jar</td></tr>
	</table>
    </td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td align="center">|</td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>
    <table align="center">
      <tr><td class="clt_loader">JDK Extensions Classloader</td></tr>
      <tr><td class="clt_label">directory:</td></tr>
      <tr><td class="clt_data"><i>jdk</i>/jre/lib/ext</td></tr>
	  </table></td>
	<td>&nbsp;</td><td>&nbsp;</td></tr>
</table>

<p>In this classloader hierarchy, classloaders can access classes in
classloaders beneath them. They can not access classes in classloaders to the
side or above! With this in mind, a brief inspection should reveal that in
Tomcat 3.3, web applications do not have access to an XML parser by default.
The <code>jaxp.jar</code> and <code>crimson.jar</code> are tucked away in the
<b>Server Classloader</b> where they are accessible only within that classloader.</p>

<p>Also note that if you have a jar containing classes which depends on
<code>servlet.jar</code>, putting it on the CLASSPATH wouldn't work.
<code>servlet.jar</code> isn't accessible to the <b>Application Classloader</b>.
This is why in Tomcat 3.3, your CLASSPATH envronment variable is ignored.  You
must put such a jar in the <b>Common Classloader</b> or above.</p>

<p>For classes to are used solely by a web application, they should be placed
in the web application's <code>WEB-INF/classes</code> or in a jar in the
<code>WEB-INF/lib</code> as defined by the Servlet 2.2 specifications.  If you
want to give the classes wider scope, place the classes in a jar if they aren't
already.  Then place the jar in the directory that corresponds to the
classloader with the scope you desired.  In the <b>Apps Classloader</b>, the
classes are shared among all the web applications.  In the <b>Common Classloader</b>,
the classes are shared among all the web applications and the web server classes.</p>

<p>A second method is available for adding classes to the <b>Common Classloader</b>
and <b>Apps Classloader</b>.  Entries found in an <code>org.apache.tomcat.common.classpath</code>
system property are added to the <b>Common Classloader</b> and entries found in
an <code>org.apache.tomcat.apps.classpath</code> are added to the <b>Apps CLassloader</b>.</p>

<h3><a name="configuring_server">Configuring the Server</a></h3>

<h4>Overview</h4>

<p>By default, Tomcat's configuration is determined by the contents of the
<code>server.xml</code> file found in Tomcat's <code>conf</code> directory.
This file specifies the sequence of <strong>modules</strong> (a.k.a. interceptors)
that should participate in the operation of this instance of Tomcat.  This file
also includes the operating parameters for those modules.</p>

<p>Prior to reading the <code>server.xml</code> file, Tomcat reads the
<code>modules.xml</code> file which is also found in the <code>conf</code>
directory.  This file specifies mappings between module names and the class
that implements the module.  This simplifies the syntax in <code>servers.xml</code>
and allows you to update a module's class by updating just <code>modules.xml</code>.
The <code>server.xml</code>, and possibly other files, do not have to change.</p>

<p>To allow for customization of Tomcat's configuration without requiring
modification of <code>modules.xml</code> and <code>server.xml</code>, Tomcat
will read additional files during startup.  In addition to <code>modules.xml</code>,
Tomcat will read any file in the <code>conf</code> directory that matches the
pattern <code>modules-*.xml</code>.  Likewise for <code>server.xml</code>,
by default Tomcat will read additional files which match the pattern
<code>server-*.xml</code>.</p>

<p>If you specify the configuration file (i.e. the file to use in place of
<code>server.xml</code>) as a command line argument, the additional files read
will be derived from the base name of the file you specify.  For example, if
the configuration file specified was <code>myserver.xml</code>, then the file
pattern would be <code>myserver-*.xml</code>.  Because of this, you should avoid
using '-' in your configuration file names except when taking advantage of this
feature.</p>

<p>When using additional configuration files in conjunction with
<code>server.xml</code> it is important to note that these configuration files
apply to a single Tomcat 3.3 server instance.  In other words, all
&lt;ContextManager&gt; elements in these files refer to the same ContextManager
instance. ContextManager is the controlling class for the Tomcat 3.3 server.</p>

<p>Other files may be read as well for configuration. These, however, are determined
by the <strong>modules</strong> that are included by <code>server.xml</code>
and associated files.  The primary example of this is <code>ContextXmlReader</code>.
It is responsible for reading files containing Context declarations in the form:
<pre>&lt;Context path=&quot;myapp&quot; docBase=&quot;somepath&quot; ... /></pre> or 
<pre>&lt;Context path=&quot;myapp&quot; docBase=&quot;somepath&quot; ...&gt;
    <i>context local modules</i>
&lt;/Context&gt;</pre></p>

<p>By separating the reading of &quot;context&quot; configurations from the
server configuration, you can manually add additional contexts without
modifying the <code>server.xml</code> file.</p>

<p>The <code>ContextXmlReader</code> module supports a <code>config</code>
parameter which specifies the file to read.  Like <code>server.xml</code>,
additional files are read based on the pattern <code><i>base</i>-*.xml</code>.
Thus, specifying <code>config=&quot;conf/myapps.xml&quot;</code> would read
<code>conf/myapps.xml</code>, if it exists, plus all files in the
<code>conf</code> directory matching the pattern <code>myapps-*.xml</code>.</p>

<p>Tomcat 3.3's default <code>server.xml</code> includes two instances of the
<code>ContextXmlReader</code> module.  One reads <code>conf/apps.xml</code>,
which reads all the &quot;apps&quot; files found in the <code>conf</code>
directory by default.  For backward compatibility with having &quot;context&quot;
declarations in <code>server.xml</code>, the second instance of
<code>ContextXmlReader</code> reads <code>conf/server.xml</code>, processing
only the <code>&lt;Context&gt;</code> entries.</p>

<h4>Default Tomcat Configuration</h4>

<p><i>This section will describe the default configuration supplied with Tomcat 3.3</i></p>

<h4>Tomcat Server Customization</h4>

<p><i>This section will describe the most common customizations</i></p>


<p><b><i>The rest of this section is obsolete. Please ignore.  It remains for the
moment in case it contains some useful text.</i></b></p>
    <p> Tomcat's configuration is based on two files:</p>
    <ol>
      <li> <a href="#server_xml"> server.xml</a> - Tomcat's global configuration file. </li>
      <li> <a href="#web_xml"> web.xml</a> - Default deployment descriptor. </li>
    </ol>

<h4><a name="server_xml">server.xml - Tomcat's main configuration
    file</a></h4>

<blockquote>
    <p>
    The elements in server.xml (found in the conf subdirectory of
      TOMCAT_HOME) are described below. Following along with the
      default server.xml in another window is helpful. The default
      server.xml file has many comments which may supersede the
      comments below.  This is more of a reference section than a
      how-to.</p>
      <table border="0" width="90%">
        <tr>
          <td width="10%" valign="top"><strong>&lt;Server&gt;</strong></td>
          <td width="90%" valign="top">The topmost element. &lt;Server&gt;
            defines a single Tomcat server. Generally you should not bother with
            it.<br>
            </td>
        </tr>
        <tr>
          <td width="10%" valign="top"></td>
          <td width="90%" valign="top">
            <table border="0" width="100%">
              <tr>
                <td width="15%" valign="top"><strong>&lt;xmlmapper:debug&gt;
              </strong></td>
                <td width="85%">You'll most likely never have to touch this, unless you're
              worried about how Tomcat is registering the contents of this server.xml file. Even if you are concerned, the startup output
              found in Tomcat's main log
              file will usually be sufficient for this purpose.
                  <p>Attributes:</p>
                  <ul>
                    <li> <strong>level</strong>. A value of &quot;0&quot;
              means &quot;no output&quot;. &quot;9&quot; meaning
              &quot;most everything&quot;.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td width="15%" valign="top"><strong>&lt;Logger&gt;</strong></td>
                <td width="85%">
 This element defines a Logger object, equivalent to a log file. Currently there are loggers for the servlets (where the
              ServletContext.log() goes),
      JSP files and the  tomcat runtime.
                  <p>Attributes:</p>
                  <ul>
                    <li><strong>name. </strong> Identifies
              the logger. One of &quot;tc_log&quot;, &quot;servlet_log&quot;,
              or &quot;JASPER_LOG&quot;.</li>
                    <li><strong>path. </strong>Output file, relative to
              TOMCAT_HOME. If you omit a &quot;path&quot; value, then stderr &amp;
                      stdout are used.</li>
                    <li><strong>verbosityLevel.</strong> In order of increasing verbosity; one of &quot;FATAL&quot;, &quot;ERROR&quot;,
              &quot;WARNING&quot;, &quot;INFORMATION&quot;, or &quot;DEBUG&quot;.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td width="15%" valign="top"><strong><a name="context_manager_element">&lt;ContextManager&gt;</a></strong></td>
                <td width="85%">
 A ContextManager specifies the configuration and structure for a set of
              ContextInterceptors, RequestInterceptors, Contexts and their Connectors.
                  <p>
              Attributes:</p>
                  <ul>
                    <li><strong>debug.</strong> A value of &quot;0&quot;
              means &quot;no output&quot;. &quot;9&quot; meaning
              &quot;most everything&quot;.</li>
                    <li><strong>home.</strong> The base location for the
              webapps, conf, and logs directories, as well as all defined contexts.
                 It is used to start Tomcat from a directory other than
              TOMCAT_HOME. The default value for this attribute is
              TOMCAT_HOME.</li>
                    <li><strong>workDir.</strong> The name of the <a href="#work_dir_defn"> working
              directory</a>, relative to the above home attribute.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td width="15%" valign="top"></td>
                <td width="85%">
                  <table border="0" width="100%">
                    <tr>
                      <td width="15%" valign="top"><strong>&lt;ContextInterceptor&gt;<br>
                        &lt;RequestInterceptor&gt;</strong></td>
                      <td width="85%"> These interceptors listen for certain events that happen in
         the ContextManager. For example, the ContextInterceptor listens for
         startup and shutdown events of Tomcat, and the RequestInterceptor
         watches the various phases that user requests need to pass during its service.
                        Tomcat's administrator doesn't need to know much about the 
		 interceptors; a developer on the other hand should know that this 
		 is how &quot;global&quot; type of operations can be implemented in Tomcat 
		 (for example, security and per request logging).<br>
                        </td>
                    </tr>
                    <tr>
                      <td width="15%" valign="top"><strong>&lt;Connector&gt;
                  </strong></td>
                      <td width="85%">The Connector represents a connection to the user, either
            through a web server or directly to the user's browser (in a <a href="#type_1">
            stand-alone</a> configuration).
            The Connector object is the one responsible for the management of
            the Tomcat worker threads and for read/write requests/responses
            from the sockets connecting to the various clients.
                        <p>Attributes:</p>
                        <ul>
                          <li><strong>className.</strong> Which Connector to use.</li>
                        </ul>
          We will describe how to use this Connector configuration later in the document.<br>
                        </td>
                    </tr>
                    <tr>
                      <td width="15%" valign="top"></td>
                      <td width="85%">
                        <table border="0" width="100%">
                          <tr>
                            <td width="15%" valign="top"><strong>&lt;Parameter&gt;</strong></td>
                            <td width="85%">Connector initialization
                              parameters. You may have as many of these
                              elements as required under each Connector.
                              <p>Attributes:</p>
                              <ul>
                                <li><strong>name.</strong> So far, one of
                                  &quot;handler&quot;, &quot;port&quot;, &quot;socketFactory&quot;.</li>
                                <li><strong>value.</strong> The appropriate value.</li>
                              </ul>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                    <tr>
                      <td width="15%" valign="top"><strong>&lt;Context&gt;
                  </strong> </td>
                      <td width="85%"> Each Context represents a path in the Tomcat hierarchy where you
         place a web application.
                        <p>
                  Attributes:</p>
                        <ul>
                          <li><strong>path.</strong>The <em>context path</em> for a
                            particular web application, which
        is the prefix of a request URI that tells Tomcat which Context
        should be used to process this request. This attribute is
                            required,
        and must start with a slash ('/') character.</li>
                          <li><strong>docBase.</strong> The root of your web
                  application. This can be a full path or relative to the <a href="#context_manager_element">
                  ContextManager's</a> home. This is Tomcat's version of
                            Apache's &quot;DocumentRoot&quot; directive.</li>
                          <li><strong>reloadable.</strong> When developing a servlet it is very 
		     convenient to have Tomcat automatically reload it, allowing you to fix bugs and have Tomcat test the new code without the need to
                            restart the container. To turn on servlet reloading set the 
			 reloadable flag to true. Detecting changes however is time 
			 consuming; moreover, since the new servlets are getting loaded 
			 in a new class-loader object there are cases where this 
			 class-reloading trigger casts errors. To avoid these problems 
			 you can set the reloadable flag to false; this will disable the 
			 autoreload feature.</li>
                          <li><strong>trusted.</strong> Trusted allows you to access tomcat internal objects              with FacadeManager.</li>
                          <li><strong>debug.</strong> A value of &quot;0&quot;
              means &quot;no output&quot;. &quot;9&quot; meaning
              &quot;most everything&quot;.</li>
                        </ul>
                      </td>
                    </tr>
                    <tr>
                      <td width="15%" valign="top"><strong>&lt;Host&gt;
                  </strong></td>
                      <td width="85%">Contains &lt;Context&gt; elements. The &lt;Host&gt;
                  element is used to configure per-virtual host Contexts.
                        <p>
                  Attributes:</p>
                        <ul>
                          <li><strong>name</strong>: The fully-qualified hostname
                  or IP address of the virtual host.</li>
                        </ul>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td width="15%" valign="top"><strong>&lt;/ContextManager&gt;</strong></td>
                <td width="85%"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td width="10%" valign="top"><strong>&lt;/Server&gt;</strong></td>
          <td width="90%" valign="top"></td>
        </tr>
      </table>
    </blockquote>


<h4><a name="web_xml">web.xml - Default deployment descriptor</a></h4>

    <blockquote>
    <p>
      A detailed description of web.xml and the web application structure
      (including directory structure and configuration) is available in
      chapters 9, 10 and 13 of the <a href="http://java.sun.com/products/servlet/download.html">Servlet API Spec</a>
      and we are not going to write about it. <a href="../appdev/index.html">Developing Applications with Tomcat</a>
      covers web application and deployment with Tomcat. <strong>It is required reading if you're not going to
      take the time to read through the <a href="http://java.sun.com/products/servlet/download.html">Servlet API Spec</a>!</strong> </p>
    <p>
      There is a small Tomcat &quot;feature&quot; that is related
      to web.xml. Tomcat lets the user define default web.xml values for all
      contexts by putting a default web.xml file in the conf subdirectory of
      TOMCAT_HOME. When
      constructing a new Context, Tomcat uses the default web.xml file as the
      base configuration, and then applies the application specific web.xml (the
      application's WEB-INF/web.xml file) settings.</p>

<p>This means that in Tomcat, you can get away with an empty
web.xml file, containing only the element

<tt><big>&lt;web-app/&gt;</big></tt>, or (more realistically)
containing only the elements (e.g. mappings and mime-types) you need.  However, this will limit your
webapp's portability, so it is recommended to use a full web.xml
file.  You may instead want to copy TOMCAT_HOME/conf/web.xml and modify it.</p>

    <p>We cover certain aspects of web.xml in subsequent sections, where it
      pertains to application deployment and interaction with Tomcat.</p>

    </blockquote>

<hr size="5">


<h3><a name="webapps">Deploying Web Applications</a></h3>

<h4>What is a Web Application?</h4>

<p>[??? - move this section up above the Configuring Tomcat section? It's
not clear whether we should teach about webapps before or after we
introduce server.xml et al.]</p>

<p>A Web Application (or &quot;webapp&quot;) is a concept that was introduced in
the <a href="http://java.sun.com/products/servlet/2.2/">Servlet
Specification</a> version 2.2. [2.1?] You should definitely read the
spec for the full story. From the spec (chapter 9):</p>

<!--[[blockquote]] not sure what the range of this quite is supposed to be-->
<p>A web application is a collection of servlets, html pages, classes, and other resources that can be
bundled and run on multiple containers from multiple vendors. A web application is rooted at a
specific path within a web server. For example, a catalog application could be located at http://
www.mycorp.com/catalog. All requests that start with this prefix will be routed to the
ServletContext which represents the catalog application.</p>

<p>A servlet container can also establish rules for automatic generation of web applications. For
example a ~user/ mapping could be used to map to a web application based at /home/user/
public_html/.</p>

<p>[...]</p>

<p>A web application exists as a structured hierarchy of directories. The
root of this hierarchy serves as a document root for serving files
that are part of this context. For example, for a web application
located at /catalog in a web server, the index.html file located at
the base of the web application hierarchy can be served to satisfy a
request to /catalog/index.html.</p>

<p>A special directory exists within the application hierarchy named &quot;WEB-INF&quot;. This directory
contains all things related to the application that aren't in the document root of the application. It is
important to note that the WEB-INF node is not part of the public document tree of the application.
No file contained in the WEB-INF directory may be served directly to a client.</p>

<p>The contents of the WEB-INF directory are:</p>

<ul>
<li> /WEB-INF/web.xml deployment descriptor </li>
<li> /WEB-INF/classes/* directory for servlet and utility classes. The classes in this directory
are used by the application class loader to load classes from. </li>
<li> /WEB-INF/lib/*.jar area for Java ARchive files which contain servlets, beans, and other
utility classes useful to the web application. All such archive files are used by the web
application class loader to load classes from. </li>
</ul>

<h3>Sample Web Application Directory Structure</h3>

<p>Illustrated here is a listing of all the files in a sample web application:</p>

<blockquote>
<pre>/index.html
/howto.jsp
/feedback.jsp
/images/banner.gif
/images/jumping.gif
/WEB-INF/web.xml
/WEB-INF/lib/jspbean.jar
/WEB-INF/classes/com/mycorp/servlets/MyServlet.class
/WEB-INF/classes/com/mycorp/util/MyUtils.class
</pre>
</blockquote>

<p>You can deploy a WAR file that is present on the local filesystem by
adding a &lt;Context&gt; tag to TOMCAT_HOME/conf/server.xml. For
example:</p>

<blockquote>
<pre>&lt;Context path=&quot;/mywebapp&quot;
  docBase=&quot;/home/alex/webapps/mywebapp&quot;
  reloadable=&quot;true&quot; &gt;
&lt;/Context&gt;
</pre>
</blockquote>


<h4><a name="what_is_war">What is a WAR file?</a></h4>

<p><em>&quot;WAR. Huh! What is it good for?&quot; - Edwin Starr</em></p>

<p>A WAR (or &quot;web archive&quot;) file is simply a packaged webapp directory.
It is created using the standard Java <tt><big>jar</big></tt> tool.
For example:</p>

<blockquote><pre>cd /home/alex/webapps/mywebapp 
jar cf mywebapp.war *</pre></blockquote>

<h4><a name="deploying_war">Deploying WAR files in Tomcat</a></h4>

<blockquote>
<p>Currently (as of version 3.2) the procedure for deploying a new WAR file is:</p>

<ol>
	<li><strong>Stop Tomcat.</strong></li>
	<li><p><strong>Delete existing deployment.</strong> If you have
		previously deployed &quot;foo.war&quot; in
		TOMCAT_HOME/webapps, then it has been unpacked into
		webapps/foo/...  You must delete this directory and all
		its contents. On Unix, this can be done with:</p>

		<pre>rm -r $TOMCAT_HOME/webapps/foo</pre>
	</li>
	<li><strong>Copy WAR file to TOMCAT_HOME/webapps/.</strong></li>
	<li><strong>Start Tomcat.</strong></li>
</ol>

<p>This process may become easier in the future. A &quot;deploy tool&quot; is on the Tomcat &quot;to-do&quot; list.</p>

<p>Note that if you deploy a WAR file in this manner, you do not need to
make any changes to <tt><big>server.xml</big></tt> -- it will 
automatically be recognized and activated when the server starts.
However, if you wish to specify non-default options for this webapp,
you may do so by adding an element like <tt><big>&lt;Context
docBase=&quot;webapps/foo&quot; ...</big></tt> to server.xml.</p>

<p>See also <a href="http://www.jguru.com/jguru/faq/view.jsp?EID=123229">How
do I deploy a WAR file in Tomcat?</a> in the jGuru FAQ.</p>

</blockquote>

<hr size="5">

<h3><a name="tutorials">Tomcat Tutorials</a></h3>

<p>These tutorials will be run with the assumption that Tomcat
	is operating as a stand-alone container. Like we said
	before, it can be helpful to understand Tomcat's
	functionality, irrespective of the particular web server
	you're using. Trying to get more than one thing working
	at once usually leads to more problems than its worth.
	Integration will be covered later in subsequent
	sections.</p>

[Note: add some tutorials here :-) ]


<h2>Real World Configuration Tips</h2>

<p>By default the Tomcat distribution comes with a naive
	configuration whose main goal is to promote first time
	user experience and an &quot;out of the box&quot; operation...
	This configuration however is not the best way to deploy
	Tomcat on real sites. For example, real sites may
	require some performance tuning and site-specific
	settings (additional path elements for example). This
	section will try to get you started by directing you to
	the first steps that should be taken before publishing a
	Tomcat based site.</p>

<h3>Modify and Customize the Batch Files</h3>
<p>As stated in the previous sections, the startup scripts are
	here for your convenience.  Yet, sometimes the scripts
	that are needed for deployment should be modified:</p>

<ul>
            <li> To set resource limits such as maximum number of
                 descriptors. </li>
            <li> To add new CLASSPATH entries (for example, JDBC drivers). </li>
            <li> To add new PATH/LD_LIBRARY_PATH entries (for example, JDBC
                 drivers DLLs). </li>
            <li> To modify the JVM command line settings. </li>
            <li> Make sure that you are using a specific JVM (out of the two
                 or three JVMs installed on your machine). </li>
            <li> To switch user from root to some other user using the &quot;su&quot;
                 UNIX command. </li>
            <li> Your pet reason. </li>
</ul>

<p>Some of these changes can be done without explicit changes to
	the basic scripts; for example, the tomcat script can
	use an environment variable named <tt>TOMCAT_OPTS</tt>
	to set extra command line parameters to the JVM (such as
	memory setting etc.). On <em>UNIX</em> you can also
	create a file named <tt>&quot;.tomcatrc&quot;</tt> in your home
	directory and Tomcat will take environment information
	such as PATH, JAVA_HOME, TOMCAT_HOME and CLASSPATH from
	this file. On NT however (and also on UNIX when the
	modifications are for something such as the JVM command
	line) you are forced to rewrite some of the startup
	script...</p>

<div><strong>Do not hesitate, just do it.</strong></div>

<h3>Modify the Default JVM Settings</h3>

<p>The default JVM settings in the tomcat script are very
	na&iuml;ve; everything is left for defaults. There are a
	few things that you should consider to improve your
	Tomcat performance:</p>

        <ol>
            <li> Modify your JVM memory configuration. Normally the JVM
           allocates an initial size for the Java heap and that's it, if
           you need more then this amount of memory you will not get it.<br>
           Nevertheless, in loaded sites, giving more memory to the JVM
           improves Tomcat's performance. You should use command line
           parameters such as -Xms/-Xmx/-ms/-mx to set the minimum/maximum
           size of the Java heap (and check to see if the performance was
           improved). </li>

            <li> Modify your JVM threading configuration. The SUN JDK1.2.2 for
           Linux comes with support for both, green and native threads. In
           general native threads are known to provide improved performance
           for I/O bound applications, green threads on the other hand put
           less stress on the machine. You should experiment with these two
           threading models and see which model is better for your site (in
           general, native threads are better).</li>

            <li> Select the best JVM for the task. There are several JVM vendors,
           for example on Linux there are today (21/03/2000) two product level
           JVMs: the SUN JDK1.2.2 and the IBM JDK1.1.8. If your application
           does not require a specific JDK functionality, you should
           benchmark the two JVMs and select the better one. In my (Gal
           Shachor) internal tests I found the IBM JVM significantly faster
           than the one created by SUN, you should check that for yourself
           and make a calculated decision.
           </li>
        </ol>


<h3>Modify your Connectors</h3>

    <p>
        The Connectors, as configured in Tomcat's default server.xml
        contains two Connectors configured as in the next server.xml
        fragment:</p>

<table border="1" cellspacing="0" cellpadding="0" valign="center">
	<caption><em>The two default Connectors in server.xml</em></caption>
          <tr>
            <td bgcolor="#c0c0c0">
<pre>
        &lt;!-- (1) HTTP Connector for stand-alone operation --&gt;
        &lt;Http10Connector port=&quot;8080&quot;
                         address=&quot;127.0.0.1&quot;
        /&gt;

        &lt;!-- (2) AJPV12 Connector for out-of-process operation --&gt;
        &lt;Ajp12Connector port=&quot;8007&quot;
                        address=&quot;127.0.0.1&quot;
        /&gt;
</pre>
            </td>
          </tr>
</table>

<ol>
            <li> Is a Connector that listens on port 8080 for incoming HTTP
                 requests. This connector is needed for stand-alone
                 operation.</li>
            <li> Is a Connector that listens on port 8007 for incoming AJPV12
                 requests. This connector is needed for web-server
                 integration (out-of-process servlet integration).</li>
        </ol>

<p>It is clear that a sane Tomcat deployment will use either an
        out-of-process servlet integration or a stand-alone operation,
        removing the unnecessary Connector is important.</p>


<h3>Use a Thread Pool in your Connectors</h3>

    <p>
        Tomcat is a multi-threaded servlet container this means that each
        request needs to be executed by some thread. By default when a
        request arrives Tomcat creates a new thread, starts it and has it
        serve the request. This behavior is problematic for loaded sites
        because:</p>

<ul>
            <li>Starting and stopping a thread  for every request puts a
                needless burden on the operating system and the JVM.</li>
            <li>It is hard to limit the resource consumption. If 300
                requests arrive concurrently Tomcat will open 300
                threads to serve them and allocate all the resources needed
                to serve all the 300 requests at the same time.  This causes
                Tomcat to allocate much more resources (CPU, Memory,
                Descriptors...) than it should and it can lead to low
                performance and even crashes if resources are exhausted.</li>
</ul>

<p>The solution for these problems is to use a <strong>thread pool</strong>.
        Servlet containers that are using a thread pool relieve themselves
        from directly managing their threads. Instead of allocating new
        threads; whenever they need a thread they ask for it from the pool,
        and when they are done, the thread is returned to the pool. The
        thread pool can now be used to implement sophisticated thread
        management techniques, such as:</p>

<ol>
	<li>Keeping threads &quot;open&quot; and reusing them over and over
                 again. This saves the trouble associated with creating and 
				 destroying threads continuously.
	<ul>
		<li>Usually the administrator can instruct the pool not to keep too many idle threads, freeing them if needed.</li>
	</ul>
            </li>

	<li>Setting an upper bound on the number of threads used
                 concurrently. This prevents the resources allocation
                 problem associated with unlimited thread allocation.
	<ul>
		<li>If the container maxed out to the threads upper limit, and a new
                 request arrives, the new request will have to wait for
                 some other (previous) request to finish and free the thread
                 used to service it.</li>
	</ul>
            </li>
</ol>

<p>You can refine the techniques described above in various ways, but
        these are only refinements. The main contribution of thread pools is
        thread-reuse and having a concurrency upper bound that limits
        resource usage.</p>

    <p>
        Using a thread pool in Tomcat is a simple move; all you need to do
        is to use a <tt>PoolTcpConnector</tt> in your &lt;Connector&gt;
        configuration. For example the following server.xml fragment defines
        ajpv12, pooled Connector:</p>

<table border="1" cellspacing="0" cellpadding="0" valign="middle">
	<caption><em>Pooled ajpv12 Connector</em></caption>
          <tr>
            <td bgcolor="#c0c0c0">

<pre>
        &lt;!-- A pooled AJPV12 Connector for out-of-process operation --&gt;
        &lt;Ajp12Connector port=&quot;8007&quot;
                        address=&quot;127.0.0.1&quot;
        /&gt;
</pre>
            </td>
          </tr>
</table>

<p>This fragment is very simple and the (default) pool behaviour
        instructed by it is:</p>

        <ul>
            <li> Upper bound for concurrency of 50 threads. </li>
            <li> When the pool has more then 25 threads standing idle it
                 will start to kill them. </li>
            <li> The pool will start 10 threads on creation, and it will try
                 to keep 10 vacant threads (as long as the upper bound is
                 kept). </li>
        </ul>
<p>The default configuration is suitable for medium load sites with an
   average of 10-40 concurrent requests. If your site differs you
   should modify this configuration (for example reduce the upper
   limit). Configuring the pool can be done through the &lt;Connector&gt;
   element in server.xml as demonstrated in the next fragment:
</p>

<table border="1" cellspacing="0" cellpadding="0" valign="middle">
	<caption><em>Configuring the Thread Pool</em></caption>
          <tr>
            <td bgcolor="#c0c0c0">
<pre>
        &lt;!-- A pooled AJPV12 Connector for out-of-process operation --&gt;
        &lt;Ajp12Connector tomcatAuthentication=&quot;false&quot;
                        port=&quot;8007&quot;
                        address=&quot;127.0.0.1&quot;
                        maxThreads=&quot;30&quot;
                        maxSpareThreads=&quot;20&quot;
                        minSpareThreads=&quot;5&quot;
        /&gt;
</pre>
            </td>
          </tr>
</table>

<p>As can be seen the pool has 3 configuration parameters:</p>

<ul>
            <li> maxThreads - defines the upper bound to the for the 
			     concurrency, the pool will not create more then this number 
				 of threads. </li>
            <li> maxSpareThreads - defines the maximum number of threads
                 that the pool will keep idle. If the number of idle threads
                 passes the value of max_spare_threads the pool will kill
                 these threads. </li>
            <li> minSpareThreads - the pool will try to make sure that at
                 any time there is at least this number of idle threads
                 waiting for new requests to arrive. min_spare_threads must
                 be bigger then 0.</li>
        </ul>

        You should use the above parameters to adjust the pool behavior to
        your needs.


<h3>Disable Servlet Auto-Reloading</h3>

    <p>
        Servlet auto-reloading is really useful for development time.
        However it is very expensive (in performance degradation terms) and
        may put your application in strange conflicts when classes that were
        loaded by a certain classloader cannot co-operate with classes
        loaded by the current classloader.
    </p>
    <p>
        So, unless you have a real need for class reloading during your
        deployment you should turn off the reloadable flag in your contexts.
    </p>

<h3>Start Tomcat from /etc/inittab</h3>

    <p>
        Unfortunately the adapters developed for Apache (or for any of the
        other servers) cannot start Tomcat yet. On UNIX however, you can
        use the init table to start Tomcat automatically upon machine
        startup. FIXME:
    </p>


<h2><a name="credits">Credits</a></h2>

<p>Tomcat was originally written by Sun Microsystems, and has been improved
(we hope) by a <a href="http://jakarta.apache.org/site/whoweare.html">cast of thousands</a>.</p>

<p>This document was created by:</p>

<ul>
	<li><a href="mailto:shachor@il.ibm.com">Gal Shachor</a>
</ul>

<p>With help from (in alphabetical order):</p>

<ul>
	<li>Jonathan Bnayahu</li>
	<li>Alex Chaffee</li>
	<li>Fiona Czuczman</li>
	<li>Costin Manolache</li>
	<li>Rob Slifka</li>
</ul>

<table width="100%" border="0" cellpadding="10" cellspacing="0">
      <tr>
        <td>
          <p class="fineprint">
            Copyright &copy;1999-2001 The Apache Software Foundation<br>
            <a href="http://jakarta.apache.org/legal.html">Legal Stuff They Make Us Say</a><br>
            <a href="http://jakarta.apache.org/contact.html">Contact Information</a>
          </p>
        </td>
      </tr>
</table>

</body>
</html>
