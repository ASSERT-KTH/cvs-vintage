<project name="source-snapshots" default="src.snap" basedir=".">
   <!-- ******************** Initialization ******************** -->
  <target name="init">
    <mkdir dir="${ws.dir}" />
    <tstamp />
    <property name="ws.dir" value="${user.home}/ws" />
    <property name="nightly.dir" value="/www/jakarta.apache.org/builds/tomcat/nightly" />
    <property name="nightly.url" value="http://jakarta.apache.org/builds/tomcat/nightly" />
    <property name="tomcat.home" value="/opt/tomcat" />
    <property name="dist.dir" value="/opt" />
    <property name="package.dir" value="/home/ftp/pub" />
    <!-- Allow user to override any of the hardcoded directories -->
    <property file="${user.home}/.ant.properties" />
   </target>

  <target name="clean.src" depends="init">
     <deltree dir="${ws.dir}/jakarta-tomcat" />
     <deltree dir="${ws.dir}/jakarta-watchdog" />
     <deltree dir="${ws.dir}/jakarta-tools" />
     <deltree dir="${ws.dir}/jakarta-tomcat.src.zip" />
     <deltree dir="${ws.dir}/jakarta-tools.src.zip" />
     <deltree dir="${ws.dir}/jakarta-watchdog.src.zip" />
  </target>

   <!-- ******************** Creating source snapshots  ******************** -->
  <target name="ant.src.snap" depends="init">
    <cvs cvsRoot=":pserver:anoncvs@jakarta.apache.org:/home/cvspublic" 
         package="jakarta-tools"   dest="${ws.dir}"  />
    <zip zipfile="${nightly.dir}/src/jakarta-tools.src.zip" 
         basedir="${ws.dir}" items="jakarta-tools"/>
    <copyfile src="${nightly.dir}/src/jakarta-tools.src.zip"
              dest="${nightly.dir}/src/jakarta-tools-${DSTAMP}.src.zip" />
    <copyfile src="${ws.dir}/jakarta-tools/buildscripts/main.xml"
              dest="${user.home}/scripts/main.xml" />
    <copyfile src="${ws.dir}/jakarta-tools/buildscripts/jakarta-apache.xml"
              dest="${user.home}/scripts/jakarta-apache.xml" />
  </target>

  <target name="tomcat.src.snap" depends="init">
    <cvs cvsRoot=":pserver:anoncvs@jakarta.apache.org:/home/cvspublic"
         package="jakarta-tomcat"   dest="${ws.dir}"  />
    <zip zipfile="${nightly.dir}/src/jakarta-tomcat.src.zip" 
         basedir="${ws.dir}"  items="jakarta-tomcat"/>
    <copyfile src="${nightly.dir}/src/jakarta-tomcat.src.zip" 
         dest="${nightly.dir}/src/jakarta-tomcat-${DSTAMP}.src.zip" />
  </target> 

  <target name="watchdog.src.snap" depends="init">
    <cvs cvsRoot=":pserver:anoncvs@jakarta.apache.org:/home/cvspublic"
         package="jakarta-watchdog"  dest="${ws.dir}"  />
    <zip zipfile="${nightly.dir}/src/jakarta-watchdog.src.zip" 
         basedir="${ws.dir}" items="jakarta-watchdog"/>
    <copyfile src="${nightly.dir}/src/jakarta-watchdog.src.zip" 
              dest="${nightly.dir}/src/jakarta-watchdog-${DSTAMP}.src.zip" />
  </target> 
 
   <!-- ******************** Getting binaries from build machines  ******************** -->
   <target name="binaries.get"  depends="init">
    <get src="ftp://tokyo.javasoft.com/pub/tomcat/tomcat.zip" 
         dest="${nightly.dir}/tomcat.zip" />
    <get src="ftp://tokyo.javasoft.com/pub/ant/ant.zip" 
         dest="${nightly.dir}/ant.zip" />
    <get src="ftp://tokyo.javasoft.com/pub/tomcat/ASFtomcat.pkg.tar.Z" 
         dest="${nightly.dir}/ASFtomcat.pkg.tar.Z" />
    <get src="ftp://tokyo.javasoft.com/pub/ant/ASFant.pkg.tar.Z" 
         dest="${nightly.dir}/ASFant.pkg.tar.Z" />

    <get src="ftp://tokyo.javasoft.com/pub/tomcat/tomcat-test.log" 
         dest="${nightly.dir}/log/tomcat-test-SunOS-${DSTAMP}.log" />
    <get src="ftp://tokyo.javasoft.com/pub/tomcat/watchdog-test.log" 
         dest="${nightly.dir}/log/watchdog-test-SunOS-${DSTAMP}.log" />

    <get src="ftp://osaka.javasoft.com/pub/ant/ant-1.0-0.noarch.rpm" 
         dest="${nightly.dir}/ant-1.0-0.noarch.rpm  " />
    <get src="ftp://osaka.javasoft.com/pub/ant/ant-1.0-0.src.rpm" 
         dest="${nightly.dir}/ant-1.0-0.src.rpm  " />
    <get src="ftp://osaka.javasoft.com/pub/tomcat/tomcat-3.0-0.noarch.rpm" 
         dest="${nightly.dir}/tomcat-3.0-0.noarch.rpm  " />
    <get src="ftp://osaka.javasoft.com/pub/tomcat/tomcat-3.0-0.src.rpm" 
         dest="${nightly.dir}/tomcat-3.0-0.src.rpm  " />

    <get src="ftp://osaka.javasoft.com/pub/tomcat/watchdog-test.log" 
         dest="${nightly.dir}/log/watchdog-test-Linux-i386-${DSTAMP}.log" />
    <get src="ftp://osaka.javasoft.com/pub/tomcat/tomcat-test.log" 
         dest="${nightly.dir}/log/tomcat-test-Linux-i386-${DSTAMP}.log" />

    <copyfile src="${nightly.dir}/tomcat.zip" dest="${nightly.dir}/tomcat-${DSTAMP}.zip" />
    <copyfile src="${nightly.dir}/ant.zip" dest="${nightly.dir}/ant-${DSTAMP}.zip" />
   </target>



   <target name="tomcat.zip2tar"  depends="init">
     <deltree dir="${ws.dir}/tmp" />
     <mkdir dir="${ws.dir}/tmp" />
     <expand src="${nightly.dir}/tomcat.zip" dest="${ws.dir}/tmp" />
     <exec dir="${ws.dir}/tmp"  command="tar cf tomcat.tar tomcat" />
     <exec dir="${ws.dir}/tmp"  command="compress tomcat.tar "/>
     <exec dir="${ws.dir}/tmp"  command="tar cf tomcat.tar tomcat" />
     <exec dir="${ws.dir}/tmp"  command="bzip2 tomcat.tar "/>
     <copyfile src="${ws.dir}/tmp/tomcat.tar.Z" dest="${nightly.dir}/tomcat.tar.Z" />
     <copyfile src="${ws.dir}/tmp/tomcat.tar.bz2" dest="${nightly.dir}/tomcat.tar.bz2" />
   </target>

   <target name="ant.zip2tar"  depends="init">
     <deltree dir="${ws.dir}/tmp" />
     <mkdir dir="${ws.dir}/tmp" />
     <expand src="${nightly.dir}/ant.zip" dest="${ws.dir}/tmp" />
     <exec dir="${ws.dir}/tmp"  command="tar cf ant.tar ant" />
     <exec dir="${ws.dir}/tmp"  command="compress ant.tar "/>
     <exec dir="${ws.dir}/tmp"  command="tar cf ant.tar ant" />
     <exec dir="${ws.dir}/tmp"  command="bzip2 ant.tar "/>
     <copyfile src="${ws.dir}/tmp/ant.tar.Z" dest="${nightly.dir}/ant.tar.Z" />
     <copyfile src="${ws.dir}/tmp/ant.tar.bz2" dest="${nightly.dir}/ant.tar.bz2" />
   </target>

   <target name="remove-old"  depends="init">
      <exec dir="${nightly.dir}" command="find . -atime +3 -name tomcat-\*.zip -print -exec rm {} \;" />
      <exec dir="${nightly.dir}/logs" command="find . -atime +3  -print -exec rm {} \;" />
   </target>
   <!-- ******************** Agregate targets  ******************** -->

  <target name="src.snap" depends="init,clean.src,ant.src.snap,tomcat.src.snap,watchdog.src.snap" >
  </target>

  <target name="bin.snap" depends="init,binaries.get,tomcat.zip2tar,ant.zip2tar" >
  </target>
  
</project>

