#macro ( attrValueLeafSelect $attrValue $optionFieldName $size )
    #set ( $attrInput = $intake.AttributeValue.mapTo($attrValue) ) 
    #set ( $attr = $attrValue.Attribute )
    #set ( $module = $attrValue.Issue.Module )

        <select name="$attrInput.get($optionFieldName).Key" 
                #if($size.length())size="$size"#end>
            #if ($size.length() == 0)
            <option value="">Choose...</option>
            #end
            #foreach ($option in $module.getLeafRModuleOptions($attr))
              #set ( $selected = "" )
              #if ( $attrInput.get($optionFieldName).Value && $option.OptionId == $attrInput.get($optionFieldName).Value )
                #set ( $selected = " selected" )
              #end
              <option$selected value="$option.OptionId">
                  $option.DisplayValue</option>
            #end
        </select>
#end


#macro ( attrValueHierarchySelect $attrValue $optionFieldName $size )
    #set ( $attrInput = $intake.AttributeValue.mapTo($attrValue) ) 
    #set ( $attr = $attrValue.Attribute )
    #set ( $module = $attrValue.Issue.Module )

        <select name="$attrInput.get($optionFieldName).Key" 
                #if($size.length() != 1)size="$size"#end>
            #if ($size.length() == 0)
            <option value="">Choose...</option>
            #end
            #foreach ($option in $module.getOptionTree($attr))
              #set ( $selected = "" )
              #if ($attrInput.get($optionFieldName).Value && $option.OptionId == $attrInput.get($optionFieldName).Value)
                #set ( $selected = " selected" )
              #end

              <option$selected value="$option.OptionId">
#foreach ($i in [0..$option.Level])#if($i != 0)&nbsp;&nbsp;&nbsp;&nbsp;#end#end
                  $option.DisplayValue</option>
            #end
        </select>
#end

#macro ( attrValueErrorMsg $attrValue $fieldName )
    #set ( $attrInput = $intake.AttributeValue.mapTo($attrValue) ) 
    #if ( !$attrInput.get($fieldName).isValid() )
        <font color="red">$attrInput.get($fieldName).Message</font>
    #end
#end

#macro ( fieldErrorMsg $field $br)
    #if ( !$field.isValid() )
        <font color="red">$field.Message</font>$br
    #end
#end

#macro ( actionErrorMsg )
    #if ($data.Message)
        <font color="red">$data.Message</font>
    #end
#end

#macro ( stdIntakeMsg )
    #if ( !$intake.isAllValid() )
        <font color="red">
            Please check your form fields for errors and resubmit.
        </font>
    #end
#end

#macro ( numericSelect $name $first $last $selected $size )

    <select name="$name" size="$size">
    #foreach ( $i in [$first..$last] )
        <option value="$i" #if ($i==$selected)selected #end>$i</option>
    #end          
    </select>

#end      


#macro ( booleanCheckbox $booleanField )
   <input type="checkbox" name="$booleanField.Key" value="true"
        #if ($booleanField.Value) checked #end>
   <input type="hidden" name="$booleanField.ValueIfAbsent"
        value="false">
#end

#macro ( textField $field $size )
    #if ( $field.Validator.MaxLength && $field.Validator.MaxLength > 0 )
        #set ( $maxLength = $field.Validator.MaxLength )
    #end

    <input type="text" name="$field.Key" value="$!field.Value"#if($maxLength) maxlength="$maxLength"#end#if($size.length()) size="$size"#end>
#end


#macro (userSelectBox $attrValue $size)
    #set ( $attrInput = $intake.AttributeValue.mapTo($attrValue) ) 
    #set ( $attr = $attrValue.Attribute )
    #set ( $module = $attrValue.Issue.Module )

        <select name="$attrInput.UserId.Key" 
                #if($size.length())size="$size"#end>
            #if ($size.length() == 0)
            <option value="">Choose...</option>
            #end
$security
$attr.Permission
$module
            #foreach ($user in $security.getUsers($attr.Permission, $module))
              #set ( $selected = "" )
              #if ($attrInput.UserId.Value && $user.PrimaryKey == $attrInput.UserId.Value)
                #set ( $selected = " selected" )
              #end
              <option$selected value="$user.PrimaryKey">
                  $user.UserName $velocityCount</option>
            #end
        </select>
#end
