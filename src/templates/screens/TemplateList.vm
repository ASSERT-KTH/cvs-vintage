#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)

#macro (TemplateListBar $val)
<div class="functnbar$val">
  #if ($noTemplates.equals("false"))
  <input type="submit" value="Done" name="eventSubmit_doGonext" />&#160;
  #end
  <input type="submit" value="Cancel" name="eventSubmit_doCancel" />
</div>
#end

<div class="app" id="templateList">

<h2>$page.Title</h2>

<form method="post" action="$link.setPage("TemplateList.vm").setAction("TemplateList")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="TemplateList.vm" />
<input type="hidden" name="$scarabG.Constant.OTHER_TEMPLATE" value="SaveTemplate.vm" />

#TemplateListBar("")

## SORTING
#set ($sortColumn = $data.Parameters.getString("sortColumn",""))
#set ($sortPolarity = $data.Parameters.getString("sortPolarity",""))
#if (!$sortColumn || $sortColumn.length() == 0)
   #set ($sortColumn = "name")
#end
#if (!$sortPolarity || $sortPolarity.length() == 0)
   #set ($sortPolarity = "asc")
#end
#set ($allTemplates = $scarabR.IssueTemplates)


## PAGINATION
## if results exceed limit, get subset list
#set ($resultsPerPage = $data.Parameters.getInt("resultsPerPage",0))
#set ($pageNum = $data.Parameters.getInt("pageNum",0))
#if ($resultsPerPage == 0)
  #set ($resultsPerPage = 25)
#end
#if ($pageNum == 0)
  #set ($pageNum = 1)
#end
#if ($allTemplates.size() > $resultsPerPage)
 #set ($paginated = "true")
 #set ($pagList = $scarabR.getPaginatedList($allTemplates, $pageNum.toString(),       $resultsPerPage.toString()))
 #if ($pagList)
   #set ($allTemplates = $pagList)
 #end
#end

#if ($paginated)
  #paginate ($resultsPerPage $pageNum $sortColumn $sortPolarity)
#end

<h3>Templates</h3>

#if ($allTemplates.size() < 1)
    <p><strong class="alert">
    There are no stored templates, click the Create new button to create
    a new template.
    </strong></p>
#else
  
<table width="100%" border="1" cellspacing="2" cellpadding="3">
  <tr>
  <th nowrap="nowrap"></th>
  <th>#sort ("name" "Template name")
  <th>#sort ("desc" "Template description")</th>
  <th>#sort ("avail" "Availability")</th>
  <th>#sort ("user" "Author")</th>
  </tr>

#foreach ($template in $allTemplates)
#indexedRows($velocityCount)
#if ( ($scarabR.hasPermission($scarabG.Permission.ITEM__DELETE, $module))
   ||   ($template.CreatedBy.UserId.equals($user.UserId)))
  #set ($hasDelete = "true")
  <td><input type="checkbox" name="delete_$template.IssueId" /></td>
#else
  <td>&#160;</td>
#end
  <td>
    #if (($scarabR.hasPermission($scarabG.Permission.ITEM__DELETE, $module))
         || ($template.CreatedBy.UserId.equals($user.UserId)))
      #set ($editLink = $link.setPathInfo("templateId", $template.IssueId.toString()).setPage("SaveTemplate.vm").toString())
      <a href="$editLink">$template.TemplateInfo.Name</a>
    #else
      $template.TemplateInfo.Name
    #end
  </td>
  <td>
    #if($template.TemplateInfo.Description)
      $template.TemplateInfo.Description 
    #else
      &#160; 
    #end
  </td>
  <td>$template.templateInfo.Scope.Name
     #if (!$template.TemplateInfo.Approved)
       (until approved)
     #end
  </td>
   <td>
   #set ($createdUser = $template.CreatedBy)
   #if ($createdUser)
     <a href="mailTo:$createdUser.Email">$!createdUser.FirstName $!createdUser.LastName</a>
   #else
     &#160;
   #end
   </td>
  </tr>
#end

  </table>

#end

<div class="functnbar3">
  <input type="submit" value="Create new" name="eventSubmit_doGotoothertemplate" />
  #if ($hasDelete)
    &#160;<input type="submit" value="Delete selected" name="eventSubmit_doDeletetemplates" />
  #end
</div>

#TemplateListBar("2")

</form>
</div>
