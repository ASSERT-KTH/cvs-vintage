#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)
#if (($module.getPrivateTemplates($user, $issueType).isEmpty()) && ($module.getGlobalTemplates($issueType).isEmpty()))
   #set ($noTemplates = "true")
#else
   #set ($noTemplates = "false")
#end

#macro (TemplateListBar $val)
<div class="functnbar$val">
  #if ($noTemplates.equals("false"))
  <input type="submit" value="Done" name="eventSubmit_doGonext" />&#160;
  #end
  <input type="submit" value="Cancel" name="eventSubmit_doCancel" />
</div>
#end

<div class="app" id="templateList">

<h2>$page.Title</h2>

<form method="post" action="$link.setPage("TemplateList.vm").setAction("TemplateList")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="TemplateList.vm" />
<input type="hidden" name="$scarabG.Constant.OTHER_TEMPLATE" value="SaveTemplate.vm" />

#TemplateListBar("")

<h3>Templates</h3>

#if ($noTemplates.equals("true"))
    <p><strong class="alert">
    There are no stored templates, click the Create new button to create
    a new template.
    </strong></p>
#else
  
<table width="100%" border="1" cellspacing="2" cellpadding="3">
  <tr>
  <th nowrap="nowrap">
  </th>
  <th>
  <img src="$staticLink.setPath("/images/icon_downarrow.gif")" width="13" height="8" alt="sort descending" title="sort descending" border="0" />
   Template name</th>
  <th>Template description</th>
  <th>Project</th>
  <th>Author</th>
  </tr>

#foreach ($template in $module.getPrivateTemplates($user, $issueType))
   #indexedRows($velocityCount)
   #set ($hasDelete = "true")
  <td><input type="checkbox" name="delete_$template.IssueId" /></td>
  #set ($editLink = $link.setPathInfo("templateId", $template.IssueId.toString()).setPage("SaveTemplate.vm").toString())
  <td><a href="$editLink">$template.TemplateInfo.Name</a></td>
  <td>
    #if($template.TemplateInfo.Description)
      $template.TemplateInfo.Description
    #else
      &#160;
    #end
  </td>
  <td>$template.templateInfo.Scope.Name
     #if (!$template.TemplateInfo.Approved)
       (until approved)
     #end
  </td>
   <td>
   #set ($createdUser = $template.CreatedBy)
   #if ($createdUser)
   <a href="mailTo:$createdUser.Email">$!createdUser.FirstName $!createdUser.LastName</a>
   #else
   &#160;
   #end
   </td>
  </tr>
#end

#foreach ($template in $module.getGlobalTemplates($issueType))
#indexedRows($velocityCount)
#if ($scarabR.hasPermission($scarabG.Permission.ITEM__DELETE, $module))
  #set ($hasDelete = "true")
  <td><input type="checkbox" name="delete_$template.IssueId" /></td>
#else
  <td>&#160;</td>
#end
  <td>
    #if ($scarabR.hasPermission($scarabG.Permission.ITEM__DELETE, $module))
      #set ($editLink = $link.setPathInfo("templateId", $template.IssueId.toString()).setPage("SaveTemplate.vm").toString())
      <a href="$editLink">$template.TemplateInfo.Name</a>
    #else
      $template.TemplateInfo.Name
    #end
  </td>
  <td>
    #if($template.TemplateInfo.Description)
      $template.TemplateInfo.Description 
    #else
      &#160; 
    #end
  </td>
  <td>$template.IssueType.Name
     #if (!$template.TemplateInfo.Approved)
       (until approved)
     #end
  </td>
   <td>
   #set ($createdUser = $template.CreatedBy)
   #if ($createdUser)
     <a href="mailTo:$createdUser.Email">$!createdUser.FirstName $!createdUser.LastName</a>
   #else
     &#160;
   #end
   </td>
  </tr>
#end

  </table>

#end

<div class="functnbar3">
  <input type="submit" value="Create new" name="eventSubmit_doGotoothertemplate" />&#160;
  #if ($hasDelete)
    <input type="submit" value="Delete selected" name="eventSubmit_doDeletetemplates" />
  #end
</div>

#TemplateListBar("2")

</form>
</div>
