$page.setTitle("Stored query list")

<div class="app" id="querylist">

<h2>$page.Title</h2>
#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)

<div class="tabs">
<table cellpadding="3" cellspacing="0" border="0">
<tr>
	<td><a href="$link.setPage("AdvancedQuery.vm")" title="view advanced query">Avanced query</a></td>
	<td><a href="$link.setPage("Search.vm")" title="view custom search">Custom</a></td>
	<th>Saved queries</th>
</tr>
</table>
</div>

#if ($module.getAllUserQueries($user, $issueType).isEmpty())
<h3>Saved queries</h3>
 <p><strong class="alert">There are no stored queries.
 Please go to <a href="$link.setPage("AdvancedQuery.vm")">Advanced query</a>
 to create a new stored query.</strong></p>

#else


#set ($action = $link.setPage("QueryList.vm").setAction("QueryList").addPathInfo("$scarabG.Constant.NEXT_TEMPLATE", "QueryList.vm").toString())
<form method="post" action="$action">


##   <p>&#171; previous | 1 of 1 | next &#187; </p>

<p><b>Click query name to edit. Click on location to execute.</b></p>

<h3>Saved Queries</h3>
 
<table width="100%" border="1" cellspacing="2" cellpadding="3">
 <tr>
  <th nowrap="nowrap"></th>
  <th>Query name</th>
  <th>Query description</th>
  <th>Location</th>
  <th>Initiated by</th>
  <th>Default</th>
  <th>Subscr</th>
  <th>Subscr frequency</th>
 </tr>
 #foreach ( $query in $module.getAllUserQueries($user, $issueType) )
  #set ($rqu = $query.getRQueryUser($user))
  #set ($rquGroup = $intake.RQueryUser.mapTo($rqu))
  #indexedRows($velocityCount)
  <td><input type="checkbox" name="action_$query.QueryId" /></td>
  <td><a href="$query.getEditLink($link.setPage("EditQuery.vm").toString())">$query.Name</a></td>
  <td>#if($query.Description)  $query.Description #else &#160; #end</td>
  <td><a href="$query.getExecuteLink($link.setPage("IssueList.vm").toString())">$query.Scope.Name</a>
  #if (!$query.Approved)
   (until approved)
  #end
  </td>
  #set ($createdUser = $scarabR.getUser($query.UserId.toString()) )
  <td><a href="mailTo:$createdUser.Email">$createdUser.FirstName $createdUser.LastName</a></td>
  <td><input type="radio" name="default" value="$query.QueryId" 
          #if ($rqu.Isdefault) checked="checked" #end /></td>
  <td>#booleanCheckbox($rquGroup.Subscribed) </td>
  <td>#fieldErrorMsg ($rquGroup.Frequency "<br>")
    <select name="$rquGroup.Frequency.Key">
        #frequencySelectBox ($rqu.SubscriptionFrequency)
    </select>
  </td>
  </tr>
 #end
</table>

<div class="functnbar3">		
<input type="submit" value="save" name="eventSubmit_doSave" />
<input type="submit" value="copy" name="eventSubmit_doCopyquery" />
  #if ($scarabR.hasPermission($scarabG.Permission.ITEM__DELETE) || !$module.getPrivateQueries($user).isEmpty())
   &nbsp;<input type="submit" value="delete selected" name="eventSubmit_doDeletequeries" />&#160;
  #end
   &nbsp;<input type="submit" value="create new query" name="eventSubmit_doNewquery" />&#160;
</div>


##    <p>&#171; previous | 1 of 1 | next &#187; </p>

#end
<div class="functnbar2">		
<input type="submit" value="Done"  name="eventSubmit_doSave" />&nbsp;<input type="submit" value="Cancel"  name="eventSubmit_doCancel" />&nbsp;
</div>

$intake.declareGroups()
</form>
</div>
