#set ($action = $link.setPage("QueryList.vm").setAction("QueryList").addPathInfo("nextTemplate", "QueryList.vm"))

#set ($module = $scarabR.CurrentModule)
#set ($user = $data.User)


<form method="post" action="$action" >
  <h2>Saved query list</h2>

#if (!$user.UserId)
    If you wish to see your personal queries, <a href="$link.setPage("Login.vm")">log in.</a>
  #if ( $module.GlobalQueries.isEmpty() )
    #set ($noQueries = "true")
  #end
#elseif ( ($module.getPrivateQueries($user).isEmpty())
     && ($module.GlobalQueries.isEmpty())) 
    #set ($noQueries = "true")
#end

#if ($noQueries.equals("true"))
    <div class="alert">There are no stored queries.</div>
#else

 ##      <p>&#171; previous | 1 of 1 | next &#187; </p>

       <p>Click on location to execute</p>

       <table width="100%" border="1" cellspacing="2" cellpadding="3">
        <tr>
         <th nowrap="nowrap">
         <img src="/scarab/images/icon_uparrow.gif" width="13" height="8" alt="sort" border="0" />
         <img src="/scarab/images/icon_downarrow.gif" width="13" height="8" alt="sort" border="0" />
         </th>

         <th>Query name:</th>

         <th>Query descr:</th>

         <th>Availability:</th>

         <th>Location: (click to execute)</th>
         
         <th>author:</th>

        </tr>


#foreach ( $query in $module.getPrivateQueries($user) )

         #if( $velocityCount % 2 > 0 )
            <tr class="a">
         #else 
            <tr class="b">
         #end
         <td><input type="checkbox" name="delete_$query.QueryId"/></td>

         <td><a href="$query.getEditLink($link.toString())">$query.Name</a></td>

         <td>#if($query.Description)  $query.Description #else &nbsp; #end</td>

         <td>$query.QueryType.Name 
           #if (!$query.Approved)
             (until approved)
           #end
         </td>

         <td><a href="$query.getExecuteLink($link.toString())">project '$scarabR.getModule($query.ModuleId.toString()).Name'</a></td>

        #set ($createdUser = $scarabR.getUser($query.UserId.toString()) )
         <td><a href="mailTo:$createdUser.Email">$createdUser.UserName</a></td>
        </tr>

#foreach ( $query in $module.GlobalQueries )

         #if( $velocityCount % 2 > 0 )
            <tr class="a">
         #else 
            <tr class="b">
         #end
         <td>
      #if ($security.hasPermission("Item | Delete"))
            <input type="checkbox" name="delete_$query.QueryId"/>
      #else
            &nbsp;
      #end
         </td>

         <td>
          #if ($security.hasPermission("Item | Delete"))
            <a href="$query.getEditLink($link.toString())">$query.Name</a>
          #else
            $query.Name
          #end
         </td>

         <td>#if($query.Description)  $query.Description #else &nbsp; #end</td>

         <td>$query.QueryType.Name 
           #if (!$query.Approved)
             (until approved)
           #end
         </td>

         <td><a href="$query.getExecuteLink($link.toString())">project '$scarabR.getModule($query.ModuleId.toString()).Name'</a></td>

        #set ($createdUser = $scarabR.getUser($query.UserId.toString()) )
         <td><a href="mailTo:$createdUser.Email">$createdUser.UserName</a></td>
        </tr>
#end

      </table>

##       <p>&#171; previous | 1 of 1 | next &#187; </p>

<p class="functnbar">
      #if ($security.hasPermission("Item | Delete") || !$module.getPrivateQueries($user).isEmpty())
<input type="submit" value="delete selected" name="eventSubmit_doDeletequeries" />&#160;
      #end
<input type="submit" value="cancel" name="eventSubmit_doCancel" />
</p>

      </div>
     </td>
    </tr>
   </table>
#end
#end
  </form>
