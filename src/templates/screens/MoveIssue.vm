<div class="app" id="moveissue">

#set ($user = $data.User)
#set ($issueId = $data.Parameters.getString("id"))
#set ($issue = $scarabR.getIssue($issueId))
#set ($copyToModules = $user.getCopyToModules($scarabR.CurrentModule))
#if (!$issueId || $issueId.length() == 0 || !$issue)

  <p><strong class="alert">$l10n.CouldNotFindIssue</strong></p>

#elseif ($copyToModules.isEmpty())
  <p><strong class="alert">$l10n.NoDestinationModuleAvailable</strong></p>

#else

#set ($moveIssueGroup = $intake.MoveIssue.Default)
##set ($attrValues = $issue.AllAttributeValuesMap)
##set ($attrInput = $intake.AttributeValue.mapTo($attVal))
<form method="post" action="$link.setPage("MoveIssue.vm").setAction("MoveIssue")">
<input type="hidden" name="$moveIssueGroup.IssueId.key" value="$issue.UniqueId" />
## need to also pass id so that if we re-display this page, the right value is kept around
<input type="hidden" name="id" value="$issueId" />
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="MoveIssue2.vm" />
<input type="hidden" name="$scarabG.Constant.CANCEL_TEMPLATE" value="ViewIssue.vm" />


<h3>$l10n.CopyOptions</h3>
<div class="axial"> <table border="1" cellspacing="2" cellpadding="3">
<tr>
<th>$l10n.DestinationModule</th>
<td>
<select name="mod_issuetype">
<option>$l10n.SelectModuleIssueType</option>
 #foreach ($module in $copyToModules)
    <option>module $module.Name</option>
    #foreach ($issueType in $module.IssueTypes)
      #if (!($module.ModuleId.equals($scarabR.CurrentModule.ModuleId) && $issueType.IssueTypeId.equals($scarabR.CurrentIssueType.IssueTypeId)))
          <option value="${module.ModuleId}_${issueType.IssueTypeId}">--artifact type $issueType.Name</option>
      #end
    #end
 #end
</td>
</tr>
<tr>
<th>Action</th>
<td> <select name="$moveIssueGroup.Action.Key" >
<option value="copy"
     #if ($moveIssueGroup.Action.Value.equals("copy")) selected="selected" #end >Copy</option>
#if ($user.hasPermission($scarabG.Permission.MODULE__EDIT, $scarabR.CurrentModule))
<option value="move" 
     #if ($moveIssueGroup.Action.Value.equals("move")) selected="selected" #end >Move</option>
#end
</select>
</td>
</tr>
</table>
</div>
<div class="functnbar2">
  <input type="submit" value="$l10n.MapIssueAttributes" name="eventSubmit_doValidate" />
  <input type="submit" value="$l10n.Cancel" name="eventSubmit_doCancel" />
</div>

$intake.declareGroups()
</form>

#end
