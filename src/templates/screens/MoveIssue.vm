$page.setTitle("Copy/move issue")

<div class="app" id="moveissue">

<h2>$page.Title</h2>

#set ($user = $data.User)
#set ($currentModule = $scarabR.CurrentModule)
#set ($moduleId = $data.Parameters.getString("module_id"))
#set ($issueId = $data.Parameters.getString("id", $data.Parameters.getString("issue_id","")))
#set ($issue = $scarabR.getIssue($issueId))

#if (!$issueId || $issueId.length() == 0 || !$issue)

<p><strong class="alert">Sorry, the requested issue could not be found.</strong></p>

#else

#set ($moveIssueGroup = $intake.MoveIssue.Default)
#set ($attrValues = $issue.AllAttributeValuesMap)
#set ($attVal = $attrValues.get("SUMMARY"))
#set ($attrInput = $intake.AttributeValue.mapTo($attVal))

<form method="post" action="$link.setPage("MoveIssue.vm").setAction("MoveIssue")">
<input type="hidden" name="$moveIssueGroup.IssueId.key" value="$issueId" />
## need to also pass id so that if we re-display this page, the right value is kept around
<input type="hidden" name="id" value="$issueId" />
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="MoveIssue2.vm" />

<h3>Issue to be copied/moved</h3>
<table width="100%" border="1" cellspacing="2" cellpadding="3">
 <tr>
#if ($attVal)
  <th>Summary</th>
#end
  <th>Date committed</th>
  <th>Committed by</th>
 </tr>
 <tr class="a">
#if ($attVal)
  <td>
   $attVal.Value
  </td>
#end
  <td>$format.getDate($scarabG.DateFormat, $issue.CreatedDate)</td>
  <td>
   #set ($createdUser = $issue.CreatedBy)
   <a href="mailTo:$createdUser.Email">$createdUser.FirstName $createdUser.LastName</a>
  </td>
 </tr>
</table>

<h3>Source module</h3>
<p>
$issue.ScarabModule.Name
</p>

<h3>Destination module</h3>
<p>
<select name="$moveIssueGroup.ModuleId.Key">
 <option>Select Module...</option>
 #foreach ($module in $security.getModules($user, "Issue | Enter"))
  #if ($module.ModuleId.equals($moduleId))
    <option selected="selected" value="$module.ModuleId" />$module.Name
  #else
    <option value="$module.ModuleId" />$module.Name
  #end
 #end
</select>
#fieldErrorMsg($moveIssueGroup.ModuleId "")
</p>

<h3>Action</h3>

#set ($userAction = $moveIssueGroup.Action)
#if (!$userAction || $userAction.toString().length() == 0)
   #set ($userAction = 'copy')
#end
<p>
<input type="radio" name="$moveIssueGroup.Action.Key" value="copy" 
#checked($userAction 'copy') /> Copy
<input type="radio" name="$moveIssueGroup.Action.Key" value="move" 
#checked($userAction 'move') /> Move
</p>

<div class="functnbar2">
 <table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild">
  <input type="submit" value="Next" name="eventSubmit_doValidate" />
  </td>
 </tr>
</table>
</div>

$intake.declareGroups()
</form>

#end

</div>
