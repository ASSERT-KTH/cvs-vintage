$page.setTitle("Custom Search")

#set ($module = $scarabR.CurrentModule)
<div class="app" id="search">

<h2>$page.Title</h2>

<form action="$link.setPage("Search.vm")" method="get">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="IssueList.vm" />
<input type="hidden" name="action" value="Search" />
<input type="hidden" name="searchType" value="custom" />

<div class="tabs">
<table cellpadding="3" cellspacing="0" border="0">
<tr>
	<td><a href="$link.setPage("AdvancedQuery.vm")" title="view advanced query information">Avanced query</a></td>
	<th>Custom</th>
	<td><a href="$link.setPage("QueryList.vm")" title="view saved queries">Saved queries</a></td>
</tr>
</table>
</div>
		
<p class="functnbar"><input type="submit" value="Search" name="eventSubmit_doSearch" />&#160;<input type="submit" value="Cancel" name="eventSubmit_doCancel" /></p>
		

#set ($search = $scarabR.Search)
#set ($searchGroup = $intake.SearchIssue.mapTo($search))
#set ($issueType = $scarabR.CurrentIssueType)
#set ($searchTextAttributes = $search.QuickSearchTextAttributeValues)
#set ($searchValues = $search.QuickSearchOptionAttributeValues)
#if ($searchTextAttributes.size() != 0)
<h3>Text search</h3>

<div class="axial">
  <table border="0" cellspacing="2" cellpadding="3">
  <tr>
   <th width="120">select text attributes</th>
   <td>
    ## default to first attribute if none was selected previously
    #if ($searchGroup.TextScope.isSet())
      #set ($selectedIds = $searchGroup.TextScope.Value)
      #set ($selected = "")
    #else
      #set ($selected = 'selected="selected"')
    #end
    <select name="$searchGroup.TextScope.Key" size="5" multiple>
    #if ($searchTextAttributes.size() > 4)
      <option value="$search.ALL_TEXT" $selected>Search all</option>
      #set ($selected = "")
    #end

#foreach ($att in $searchTextAttributes)
  #if ($selectedIds)
    #foreach ($id in $selectedIds)
      #if ($id == $att.PrimaryKey)
        #set ($selected = 'selected="selected"')
      #end
    #end
  #end
  <option value="$att.QueryKey" $selected>$att.Name</option>
  #set ($selected = "")
#end
   </select>
   </td>
  </tr>

  <tr>
   <th width="120">enter search string</th>
   <td>
      <textarea name="$searchGroup.SearchWords.Key"
          rows="2" cols="30">$!searchGroup.SearchWords</textarea>
   </td>
  </tr>
 </table>
</div>
#end

<h3>Multiple/single choice search</h3>
 <div class="axial">
 <table border="0" cellspacing="2" cellpadding="3">
#foreach ($attVal in $searchValues)
  ##set ($attrInput = $intake.AttributeValue.mapTo($attVal))
  #if ($attVal.Attribute.AttributeType.ValidationKey)
    #set ($field = $attVal.Attribute.AttributeType.ValidationKey)
  #elseif ($attVal.Attribute.AttributeType.Name == "combo-box")
    #set ($field = "OptionId")
  #end
  <tr>
   <th width="120">$attVal.RModuleAttribute.DisplayValue</th>
   <td>
     #attrValueErrorMsg ($attVal $field)
     #attrValueHierarchySelect ($attVal $field "")
   </td>
  </tr>
#end
 </table>
 </div>

<h3>Results display options</h3>
		
<div class="axial">
<table  cellpadding="3" cellspacing="2" border="1">
#* 
 FIXME - implement sort
	<tr>
	<th width="120">sort by</th>
	<td><select>
	<option>
	attriute X
	</option>
	</select>&nbsp;<select>
	<option>
	ascending
	</option>
	<option>
	descending
	</option>
	</select></td>
	</tr>
*#
     <tr>
       <th>Max items per page</th>
<input type="hidden" name="pageNum" value="1" />
       <td><input type="radio" name="resultsPerPage" checked="checked" /> 25 <input type="radio" name="resultsPerPage" /> 50 <input type="radio" name="resultsPerPage" /> 75 <input type="radio" name="resultsPerPage" /></td>
     </tr>
      </table>
</div>


<p><a href="#">edit custom search - not implemented</a></p>

<p class="functnbar2"><input type="submit" value="Search" name="eventSubmit_doSearch" />&#160;<input type="submit" value="Cancel" name="eventSubmit_doCancel" /></p>

		
 $intake.declareGroups()
</form>
</div>
