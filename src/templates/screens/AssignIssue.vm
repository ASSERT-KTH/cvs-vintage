#if ( !$actionLink )
    #set ( $actionLink = $link.setPage("AssignIssue.vm").setAction("AssignIssue").addPathInfo("nextTemplate", "Index.vm") )
#end
#set ($user = $scarabR.User)
#set ($module = $user.CurrentModule)
#set ($issue = $scarabR.Issue)
#set ($attrValues = $issue.ModuleAttributeValuesMap)
#if ( !$data.Parameters.getString("action") || $data.Parameters.getString("action") != "AssignIssue" )
   #set ( $reentry = true )
#end
  <div id="AssignIssue.vm">

   <h1>Assign Issue (2.1.3)</h1>

#if ($reentry)
    <p class="message">
        Add a comment that will be sent to affected users and
        click Submit to save your changes.
    </p>
#end

   <form action="$actionLink" method="get">
#set ( $issueGroup = $intake.Issue.Default )
    <input type="hidden" name="$issueGroup.Id.Key" value="$issueGroup.Id" />

    <table border="0" cellpadding="3" cellspacing="2">
     <tr>
      <th>Select</th>

      <th>Selected</th>
     </tr>

     <tr>
      <td>

#if ($reentry)
    #foreach ( $user in $issue.EligibleAssignees )
       <input type="hidden" name="removedusers" value="$user.UserName" />
    #end
#end
       <select name="newaddusers" size="8" multiple="multiple">
#if ($reentry)
    #foreach ( $user in $issue.EligibleAssignees )
       <option value="$user.UserName">$user.UserName</option>
    #end
#else
    #foreach ( $username in $data.Parameters.getStrings("removedusers") )
       <option value="$username">$username</option>
    #end
#end
      </select>


      </td>
      <td>

#if ($reentry)
    #foreach ( $assignee in $issue.AssigneeAttributeValues )
       <input type="hidden" name="addedusers" value="$assignee.Value" />
    #end
#end
      <select name="newremoveusers" size="8" multiple="multiple">

#if ($reentry)
    #foreach ( $assignee in $issue.AssigneeAttributeValues )
       <option value="$assignee.Value">$assignee.Value</option>
    #end
#else
    #foreach ( $username in $data.Parameters.getStrings("addedusers") )
       <option value="$username">$username</option>
    #end
#end
      </select>


      </td>
     </tr>

     <tr>
      <td><input type="submit" name="eventSubmit_doAdd" 
                 value="Add" /></td>

      <td><input type="submit" name="eventSubmit_doRemove" 
                 value="Remove" /></td>
     </tr>
    </table>

#set ( $atch = $scarabR.Attachment )
#set( $intakeAttachment = $intake.Attachment.mapTo($atch) )

    <dl>
     <dt>Note #fieldErrorMsg($intakeAttachment.DataAsString "")</dt>
     <dd>
       <textarea name="$intakeAttachment.DataAsString.Key" rows="4" 
            cols="40" class="text">$!intakeAttachment.DataAsString</textarea>
     </dd>
    </dl>

    <p>
        <input type="submit" name="eventSubmit_doSubmit" 
                 value="submit" />
        <input type="submit" name="eventSubmit_doCancel" 
                 value="cancel" />
        <input type="reset" value="reset" />
    </p>

   $intake.declareGroups()
   </form>
  </div>
