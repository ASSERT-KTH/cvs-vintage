#set ( $report = $scarabR.Report )
#set ($action = $link.setPage("reports,Step2b.vm").setAction("GenerateReport"))
<div class="app" id="div2-4-1-step3">
<h2>Define report (2.4.1)</h2>
  <div class="tabs">
   <table cellpadding="3" cellspacing="0" border="0">
   <tr>
   <td>1: <a href="#" title="summary info">Summary info</a></td>
   <th>2: Primary filter attribute (PFA)</th>
   <td>3: Select row/column heading(s)</td>
   </tr>
   </table>
  </div>
<div class="functnbar">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild"><a href="#" title="select pfa(s)">2a: Select PFA(s)</a> | <strong>
    2b: PFA display options</strong></td>
 </tr>
</table>
</div>
<h3>Define PFA Groups</h3>
<h4>Grouping PFA options</h4>
<p>In cases where primary filter attribute options represent similar traits
(e.g. for X attribute "state" the options "open unassigned", "open assigned",
and "reopened unassigned" are all "open") it may be useful to calculate and
display these options as an average. Thus, all options listed below and being
the same "group" are averaged together, which is reflected in the report's
output.</p>
<p>If there are no groups, each PFA/option will appear as a separate
column.</p>
<form method="get" action="$action">
<div class="functnbar">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild"><input type="submit" name="eventSubmit_doStep2baddgroup" value="Add group" />
    &nbsp;
    <input type="submit" name="eventSubmit_doStep2bdeletegroup"
        value="Delete group" />
</td>
   </tr>
   </table>
  </div>
<table width="100%" border="1" cellspacing="2" cellpadding="3">
 <tr>
  <th nowrap="nowrap">&nbsp;</th>
  <th>Group number</th>
  <th>Group name</th>
 </tr>
#set ($finalCount = 1)
#foreach ( $optionGroup in $report.OptionGroups )
    #set ($intakeOptionGroup = $intake.OptionGroup.mapTo($optionGroup))
 #rows()
  <td><input type="checkbox"
                name="$intakeOptionGroup.Selected.Key" /></td>
  <td>Group $velocityCount</td>
  <td><input type="text" value="$intakeOptionGroup.DisplayValue"
                name="$intakeOptionGroup.DisplayValue.Key" /></td>
 </tr>
    #set ($finalCount = $velocityCount + 1)
#end
#set ( $optionGroup = $report.NewOptionGroup )
    #set ($intakeOptionGroup = $intake.OptionGroup.mapTo($optionGroup))
 ##indexedRows($finalCount)
<tr>
  <td>&nbsp;</td>
  <td>Group $finalCount (new)</td>
    #if ($intakeOptionGroup.DisplayValue.isValid())
        ## don't show the last entered value
        #set ($value = "")
    #else
        #set ($value = $intakeOptionGroup.DisplayValue)
    #end
  <td><input type="text" value="$value"
                name="$intakeOptionGroup.DisplayValue.Key" /></td>
 </tr>
</table>

<div class="functnbar">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild"><input type="submit" name="eventSubmit_doStep2baddgroup" value="Add group" />
    &nbsp;
    <input type="submit" name="eventSubmit_doStep2bdeletegroup"
        value="Delete group" />
</td>
 </tr>
</table>
</div>
#if ($report.OptionGroups && $report.OptionGroups.size() > 0)
<h3>Grouping PFA/Options</h3>
<table width="100%" border="1" cellspacing="2" cellpadding="3">
 <tr>
  <th>Group name</th>
  <th>Attribute</th>
  <th>Option</th>
 </tr>
    #foreach ( $attOption in $report.SelectedOptionsForGrouping )
        #set ($intakeOptionForGrouping = $intake.OptionForGrouping.mapTo($attOption))
   #rows()
  <td>
            <select name="ofg$attOption.QueryKey">
        #foreach ( $optionGroup in $report.OptionGroups )
            #set ( $optionValue = $velocityCount - 1 )
          <option value="$optionValue">$optionGroup.DisplayValue</option>
        #end
      </select>
        </td>
  <td>$attOption.RModuleAttribute.DisplayValue</td>
  <td>$attOption.DisplayValue</td>
 </tr>
    #end
</table>
#end
<div class="functnbar2">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild"><input type="submit" value="Continue"  name="eventSubmit_doStep2b" />
    &nbsp;
    <input type="submit" value="Cancel"  name="eventSubmit_doCancel" />
</td>
 </tr>
</table>
</div>
#addReportHiddenInputs($report "reports,Step2b.vm")
$intake.declareGroups()
</form>
</div>
