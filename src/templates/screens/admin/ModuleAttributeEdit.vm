
#set ($module = $scarabR.CurrentModule)
#set ($attribute = $scarabR.Attribute)
#set ($attType = $attribute.AttributeType)
#set ($cancelTemplate = $data.Parameters.getString("$scarabG.Constant.CANCEL_TEMPLATE", "admin,AttributeGroupEdit.vm"))
#set ($attTypeName = $attType.AttributeClass.Name)

#macro (ModuleAttributeEditBar $val)
<div class="functnbar$val">
#if ($attTypeName.equals("select-one"))
<input type="submit" value="Done"  name="eventSubmit_doDone" />
#end
<input type="submit" value="Cancel"  name="eventSubmit_doCancel" />
</div>
#end

<div class="app" id="div3-0-2-0">

#if (!$attType)
<p class="alert">Attribute not found. Please click 
$link.setPage("admin,ManageArtifactTypes.vm").setLabel("here") to proceed.</p>
#else

<form action="$link.setPage("admin,ModuleAttributeEdit.vm")" method="post">
<input type="hidden" name="action" value="admin.ModuleAttributeEdit" />
<input type="hidden" name="$scarabG.Constant.OTHER_TEMPLATE" value="admin,AttributeOptionSelect.vm" />
<input type="hidden" name="$scarabG.Constant.CANCEL_TEMPLATE" value="$cancelTemplate" />
<input type="hidden" name="att_0id" value="$attribute.AttributeId" />
<input type="hidden" name="attributeid" value="$attribute.AttributeId" />
<input type="hidden" name="groupId" value="$data.Parameters.getString("groupId","").trim()" /> 
<input type="hidden" name="issueTypeId" value="$data.Parameters.getString("issueTypeId","").trim()" /> 

#ModuleAttributeEditBar("")

<h3>Attribute Information</h3>

<div class="axial">
<table cellpadding="3" cellspacing="2" border="0">
 <tr>
  <th>Input type</th>
  <td>$attType.Name</td>
 <tr>
  <th>Name</th>
  <td>$attribute.Name</td>
 </tr>
 <tr>
  <th>Description</th>
  <td>$attribute.Description</td>
 </tr>
  #if ($attribute.CreatedDate)
 <tr>
  <th>Created by</th>
  <td>
  #attributeCreatedBy($attribute)
  </td>
 </tr>
 <tr>
  <th>Creation date</th>
  <td>
    $format.getDate($scarabR.DateFormat, $attribute.CreatedDate)
  </td>
 </tr>
  #end
</tr>
</table>
</div>

#set ($editIssueType = $scarabR.IssueType)
#set ($rmos = $scarabR.CurrentModule.getRModuleOptions($attribute, $editIssueType, false))
#if ($attTypeName.equals("select-one"))
#set ($maxNum = $rmos.size())
#datatitle ("Attribute Options")
#if (!$rmos || $rmos.isEmpty())
  There are no attribute options.
  <div class="functnbar3">
  <input type="submit" value="add new" name="eventSubmit_doGotoothertemplate" />&#160;
  </div>
#else

<table width="100%" border="1" cellspacing="2" cellpadding="2">
<tr>
 <th>Select</th>
 <th>Parent attribute option(s)</th>
 <th>Display Name</th>
 <th>Active</th>
 <th>Preferred order</th>
 <th>Weight</th>
</tr>
#foreach ($rmo in $rmos)
    #set ($rmoGroup = $intake.RModuleOption.mapTo($rmo))
    #indexedRows($velocityCount)
     <td><input type="checkbox" name="delete_$rmo.OptionId"></td>
     <td>
       #set ($comma = "")
       #set ($parents = $rmo.AttributeOption.Parents)
       #foreach ($parent in $parents)
         #if ($parents.size() > 1)
           #if ($velocityCount < $parents.size())
               #set ($comma = ", ")
           #else
               #set ($comma = "")
           #end
         #end
         $parent.Name$comma
       #end
     </td>
     <td><input type="text" size="25" name="$rmoGroup.DisplayValue.Key" value="$rmoGroup.DisplayValue.Value" /></td>
     <td>
        #booleanCheckbox($rmoGroup.Active)
     </td>
     <td>
        #numericSelect($rmoGroup.Order.Key 1 $maxNum $rmoGroup.Order.Value 1)
     </td>
     <td>
        #numericSelect($rmoGroup.Weight.Key 1 $maxNum $rmoGroup.Weight.Value 1)
     </td>
    </tr>
#end
</table>

<div class="functnbar3">
<input type="submit" value="Save" name="eventSubmit_doSave" />&#160;
<input type="submit" value="Add new" name="eventSubmit_doGotoothertemplate" />&#160;
## commenting out till we decide how to do <input type="submit" value="Copy" />&#160;
<input type="submit" value="Delete selected" name="eventSubmit_doDeleteattributeoptions" />&#160;
<input type="submit" value="Resort" name="eventSubmit_doSave" />
</div>
#end

#end

#ModuleAttributeEditBar("2")

$intake.declareGroups()
</form>
</div>
#end
