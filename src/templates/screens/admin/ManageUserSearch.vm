#**
@author <a href="mailto:dr@bitonic.com">Douglas B. Robertson</a>
@author <a href="mailto:jon@collab.net">Jon Stevens</a>
@version $Id: ManageUserSearch.vm,v 1.13 2002/02/28 17:33:07 jon Exp $
*#

$page.setTitle("User search")

#set ($user = $data.User)
#set ($searchCommand = $data.Parameters.getString("searchCommand"))
#set ($resultsPerPage = $data.Parameters.getInt("resultsPerPage"))
#set ($pageNum = $data.Parameters.getInt("pageNum"))
#set ($searchField = $data.Parameters.getString("searchField"))
#set ($searchCriteria = "")
#set ($searchCriteria = $data.Parameters.getString("searchCriteria"))
#set ($orderByField = $data.Parameters.getString("orderbyField"))
#set ($ascOrDesc = $data.Parameters.getString("ascOrDesc"))

#if ($resultsPerPage == 0)
  #set ($resultsPerPage = 25)
#end

#if ($pageNum == 0)
  #set ($pageNum = 1)
#end

<div id="ManageUserSearch" class="app">

<h2>$page.Title</h2>

<h3>Search</h3>

<p>Enter search criteria:</p>

<form action="$link.setPage("admin,ManageUserSearch.vm")" method="post">
  <input type="hidden" name="action" value="admin.ManageUser" />
  <input type="hidden" name="searchCommand" value="search" />

<table cellspacing="0" cellpadding="2">
<tr>
<td>
<select name="searchField">
 <option value="FIRST_NAME" #if ($searchField.equals("FIRST_NAME")) selected="selected" #end>First name</option>
 <option value="LAST_NAME" #if ($searchField.equals("LAST_NAME")) selected="selected" #end>Last name</option>
 <option value="EMAIL" #if ($searchField.equals("EMAIL")) selected="selected" #end>E-mail address</option>
 <option value="LOGIN_NAME" #if ($searchField.equals("LOGIN_NAME")) selected="selected" #end>Login name</option>
</select>
<input type="text" name="searchCriteria" value="$searchCriteria" />
</td>
<td>
Order by: <select name="orderbyField">
 <option value="FIRST_NAME" #if ($orderByField.equals("FIRST_NAME")) selected="selected" #end>First name</option>
 <option value="LAST_NAME" #if ($orderByField.equals("LAST_NAME")) selected="selected" #end>Last name</option>
 <option value="EMAIL" #if ($orderByField.equals("EMAIL")) selected="selected" #end>E-mail address</option>
 <option value="LOGIN_NAME" #if ($orderByField.equals("LOGIN_NAME")) selected="selected" #end>Login name</option>
</select>
<select name="ascOrDesc">
  <option value="ASC" #if ($ascOrDesc.equals("ASC")) selected="selected" #end>Ascending</option>
  <option value="DESC" #if ($ascOrDesc.equals("DESC")) selected="selected" #end>Descending</option>
</select>  
</td>
</tr>
</table>

<p>
Results per page: 
<input type="radio" name="resultsPerPage" value="25" #if ($resultsPerPage == 25) checked #end /> 25 &nbsp;
<input type="radio" name="resultsPerPage" value="50" #if ($resultsPerPage == 50) checked #end /> 50 &nbsp;
<input type="radio" name="resultsPerPage" value="75" #if ($resultsPerPage == 75) checked #end /> 75 &nbsp;
<input type="radio" name="resultsPerPage" value="100" #if ($resultsPerPage == 100) checked #end /> 100
</p>

<div class="functnbar2">
   <input type="submit" name="eventSubmit_doSearch" value="Search" />&#160;
   <input type="submit" name="eventSubmit_doGotoadduser" value="Add User" />
</div>

</form>


#if ($searchCommand.equals("search"))

<h3>Search results</h3>

 #set ($userList = $scarabG.getSearchUsers($searchField,$searchCriteria,$orderByField,$ascOrDesc))
 #if ($userList.size() == 0)
<p class="warn">There are no users matching the specified criteria.</p>
 #else

<form name="ManageUserSearchForm" action="$link.setPage("admin,ManageUserSearch.vm")" method="post">
 <input type="hidden" name="action" value="admin.ManageUser" />
 <input type="hidden" name="state" value="" />

<table cellspacing="0" cellpadding="2" width="100%">
 <tr>
   <th>Select</th>
   <th>Login name</th>
   <th>Name</th>
 </tr>

## this is the results list stuff
#if ($userList.size() > $resultsPerPage)
 #set ($paginated = "true")
 #set ($userList = $scarabR.getPaginatedList($userList, $pageNum.toString(), $resultsPerPage.toString()))
 #set ($totalPages = $scarabR.NbrPages)
#end

## PAGINATION
#if ($paginated)
 <p class="paginate">
 #if($scarabR.PrevPage != 0)
  #set ($prevLink = $link.setPathInfo("searchCommand", "search").setPathInfo("searchField", "$searchField").setPathInfo("searchCriteria", "$searchCriteria").setPathInfo("orderbyField", "$orderbyField").setPathInfo("ascOrDesc", "$ascOrDesc").setPathInfo("resultsperpage", "$resultsPerPage.toString()").setPathInfo("pageNum", "$scarabR.PrevPage").setPage("admin,ManageUserSearch.vm").toString())
  <a href="$prevLink">&laquo;</a> previous |
 #end

 $pageNum of $totalPages

 #if ($scarabR.NextPage != 0)
  #set ($nextLink = $link.setPathInfo("searchCommand", "search").setPathInfo("searchField", "$searchField").setPathInfo("searchCriteria", "$searchCriteria").setPathInfo("orderbyField", "$orderbyField").setPathInfo("ascOrDesc", "$ascOrDesc").setPathInfo("resultsperpage", "$resultsPerPage.toString()").setPathInfo("pageNum", "$scarabR.NextPage").setPage("admin,ManageUserSearch.vm").toString())
  | next <a href="$nextLink">&raquo;</a>
 #end
 </p>
#end

#foreach ($user in $userList)
  #indexedRows ($velocityCount)
   <td width="10">
   <center><input type="radio" name="username" value="$!user.UserName" /></center>
   </td>
   <td>$!user.UserName</td>
   <td><a href=mailto:$!user.Email>$!user.FirstName $!user.LastName</a></td>
 </tr>
#end

</table>

#if ($paginated)
 <p class="paginate">
 #if($scarabR.PrevPage != 0)
  #set ($prevLink = $link.setPathInfo("searchCommand", "search").setPathInfo("searchField", "$searchField").setPathInfo("searchCriteria", "$searchCriteria").setPathInfo("orderbyField", "$orderbyField").setPathInfo("ascOrDesc", "$ascOrDesc").setPathInfo("resultsperpage", "$resultsPerPage.toString()").setPathInfo("pageNum", "$scarabR.PrevPage").setPage("admin,ManageUserSearch.vm").toString())
  <a href="$prevLink">&laquo;</a> previous |
 #end

 $pageNum of $totalPages

 #if ($scarabR.NextPage != 0)
  #set ($nextLink = $link.setPathInfo("searchCommand", "search").setPathInfo("searchField", "$searchField").setPathInfo("searchCriteria", "$searchCriteria").setPathInfo("orderbyField", "$orderbyField").setPathInfo("ascOrDesc", "$ascOrDesc").setPathInfo("resultsperpage", "$resultsPerPage.toString()").setPathInfo("pageNum", "$scarabR.NextPage").setPage("admin,ManageUserSearch.vm").toString())
  | next <a href="$nextLink">&raquo;</a>
 #end
 </p>
#end

#if ($userList.size() > 0)
<div class="functnbar2">
 <input type="submit" name="eventSubmit_doGotoedituser" value="Edit User" />&#160;
 <input type="submit" name="eventSubmit_doGotoeditroles" value="Edit Roles" />&#160;
 <input type="submit" name="eventSubmit_doGotodeleteuser" value="Delete" />
</div>
#end

#end

#end
</div>
