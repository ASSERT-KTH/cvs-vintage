$page.setTitle("Attribute/options editor")

#set ($module = $scarabR.CurrentModule)
#set ($attribute = $scarabR.Attribute)
#set ($attType = $attribute.AttributeType)
#set ($attgroup = $intake.Attribute.Default )
#set ($atttgroup = $intake.AttributeType.Default )

<div class="app" id="div3-0-2-0">
<h2>$page.Title</h2>

<p>
On this screen, one can modify system wide Attribute information.
</p>

<p>
Back to <a href="$link.setPage("admin,GlobalAttributeShow.vm")">Attribute Select</a>
</p>

<form action="$link.setPage("admin,GlobalAttributeEdit.vm")" method="get">
<input type="hidden" name="action" value="admin.GlobalAttributes" />
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="admin,GlobalAttributeEdit.vm" />
<input type="hidden" name="$attgroup.Id.Key" value="$!attgroup.Id" />

<h3>Attribute Info</h3>

<div class="axial">
<table cellpadding="3" cellspacing="2" border="0">
 <tr>
  <th>Input type</th>
  <td>
    <select name="$atttgroup.AttributeTypeId.Key" size="1">
    #foreach ( $atype in $attribute.AllAttributeTypes )
      <option value="$atype.AttributeTypeId" #if($attType.AttributeTypeId == $atype.AttributeTypeId)selected#end>$atype.Name</option>
    #end
    </select>
  </td>
 <tr>
  <th>Attribute name</th>
  <td>
    <input type="text" name="$attgroup.Name.Key" value="$!attribute.Name" />
    #fieldErrorMsg($attgroup.Name "")
  </td>
 </tr>
 <tr>
  <th>Attribute description</th>
  <td>
    <#textAreaMedium() name="$attgroup.Description.Key">$!attribute.Description</textarea>
    #fieldErrorMsg($attgroup.Description "")
  </td>
 </tr>
  #if ($attribute.CreatedDate)
 <tr>
  <th>Created by</th>
  <td>
  #set ($createdUser = $scarabR.getUser($attribute.CreatedBy) )
  <a href="mailto:$createdUser.Email">$createdUser.FirstName $createdUser.LastName</a>
  </td>
 </tr>
  #end
  #if ($attribute.CreatedDate)
 <tr>
  <th>Creation date</th>
  <td>
    $attribute.CreatedDate
  </td>
 </tr>
  #end
</tr>
</table>
</div>

<div class="functnbar3">
<input type="submit" value="save"  name="eventSubmit_doModifyattributedata" />
</div>

$intake.declareGroups()
</form>

#if ($attType.AttributeClass.Name.equals("select-one"))
<form action="$link.setPage("admin,GlobalAttributeEdit.vm")" method="get">
<input type="hidden" name="action" value="admin.GlobalAttributes" />
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="admin,GlobalAttributeEdit.vm" />
<input type="hidden" name="$attgroup.Id.Key" value="$!attgroup.Id" />
#datatitle ("Attribute Options")
#set ($pcaos = $attribute.ParentChildAttributeOptions)
#set ($maxNum = $pcaos.size())

<table width="70%" border="0" cellspacing="2" cellpadding="2">
<tr>
#if ($maxNum > 0)
 <th>Deleted</th>
#else
 <th>&#160;</th>
#end
 <th>Parent attribute option</th>
 <th>Attribute option</th>
 <th>Preferred order</th>
 <th>Weight</th>
</tr>
#foreach ($pcao in $pcaos)
    #set ($pcaoGroup = $intake.ParentChildAttributeOption.mapTo($pcao))
    #indexedRows($velocityCount)
     <td>#booleanCheckbox ($pcaoGroup.Deleted)</td>
     <td>
     <select name="$pcaoGroup.ParentId.Key">
     #if ($pcao.ParentId.toString().equals("0"))
        <option selected="selected" value="0">Root</option>
     #else
        <option value="0">Root</option>
     #end
     #foreach ($parentAttrOption in $attribute.ParentChildAttributeOptions)
       #if (! $parentAttrOption.Name.equals($pcao.Name) )
         #set ($pcaoGroupTemp = $intake.ParentChildAttributeOption.mapTo($parentAttrOption))
         #if($pcao.ParentId.toString().equals($parentAttrOption.OptionId.toString()))
            <option selected="selected" value="$pcaoGroupTemp.OptionId">$pcaoGroupTemp.Name</option>
         #else
            <option value="$pcaoGroupTemp.OptionId">$pcaoGroupTemp.Name</option>
         #end
       #end
     #end
     </select>
     </td>
     <td><input type="text" size="25" name="$pcaoGroup.Name.Key" value="$pcaoGroup.Name" /></td>
     <td>
        #numericSelect($pcaoGroup.PreferredOrder.Key 1 $maxNum $pcaoGroup.PreferredOrder.Value 1)
     </td>
     <td>
        #numericSelect($pcaoGroup.Weight.Key 1 $maxNum $pcaoGroup.Weight.Value 1)
     </td>
    </tr>
#end
#set ($newPCAO = $scarabR.ParentChildAttributeOption)
#set ($newPCAOGroup = $intake.ParentChildAttributeOption.mapTo($newPCAO))
    #set ($number = $maxNum + 1)
    #indexedRows($number)
     <td>New</td>
     <td>
     <select name="$newPCAOGroup.ParentId.Key">
     <option value="0" $select>Root</option>
     #foreach ($parentAttrOption in $attribute.ParentChildAttributeOptions)
         #set ($pcaoGroupTemp = $intake.ParentChildAttributeOption.mapTo($parentAttrOption))
         <option value="$pcaoGroupTemp.OptionId">$pcaoGroupTemp.Name</option>
     #end
     </select>
     </td>
     <td><input type="text" size="25" name="$newPCAOGroup.NewName.Key" value="$newPCAOGroup.NewName" /></td>
     <td>
#set ($maxNum = $maxNum + 1)
#if ($newPCAOGroup.PreferredOrder.Value != 0)
    #set ($selected = $newPCAOGroup.PreferredOrder.Value)
#else
    #set ($selected = $maxNum)
#end
#numericSelect($newPCAOGroup.PreferredOrder.Key 1 $maxNum $selected 1)
     </td>
     <td>
#if ($newPCAOGroup.Weight.Value != 0)
    #set ($selected = $newPCAOGroup.Weight.Value)
#else
    #set ($selected = $maxNum)
#end
#numericSelect($newPCAOGroup.Weight.Key 1 $maxNum $selected 1)
     </td>
</tr>
</table>

<p><strong>Please note: Once created, Attribute Options cannot be deleted
from the database. They can only be marked as deleted and will always
show up in the list above (but will not show up in the application
itself). Therefore, please use caution when creating new Attribute
Options because you can quickly end up with a mess.</strong></p>

<div class="functnbar3">
<input type="submit" value="save"  name="eventSubmit_doAddormodifyattributeoptions" />
</div>
<div class="functnbar2">

#end #* if select-one *#
$intake.declareGroups()
</form>
</div>
