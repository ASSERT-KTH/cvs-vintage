$page.setTitle("Add/remove attributes from view")

<div class="app" id="configureissuelist">

<h2>$page.Title</h2>

#set ($action = $link.setPage("ConfigureIssueList.vm").setAction("ConfigureIssueList").addPathInfo("$scarabG.Constant.NEXT_TEMPLATE", "ConfigureIssueList.vm").toString())
#set ($user = $data.User)
#set ($module = $scarabR.CurrentModule)
## !FIXME! jdm add $scarabR.CurrentIssueType to args or get it some other way?
#set ($moduleAttributes = $module.getRModuleAttributes(true))
#set ($maxNum = $moduleAttributes.size())
#set ($usedefaults = $moduleAttributes.size())
#set ($usedefaults = $data.Parameters.getString("usedefaults"))

<form action="$action" method="post">
<input type="hidden" name="user_id" value="$user.UserId" />
<input type="hidden" name="module_id" value="$module.ModuleId" />

<div class="functnbar">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild">
  <input type="submit" value="Save" name="eventSubmit_doSelectattributes" />&#160; 
  <input type="submit" value="Cancel" name="eventSubmit_doCancel" />&#160; 
  <input type="submit" value="Reset to default"  name="eventSubmit_doCancel" />&#160;
  <input type="submit" value="Go to issue list"  name="eventSubmit_doGoissuelist" />
  </td>
 </tr>
</table>
</div>

<h3>Attributes</h3>
<table width="100%" border="1" cellspacing="2" cellpadding="3">
 <tr>
  <th>Select</th>
  <th>Attribute name</th>
  <th>Columnar sequence</th>
 </tr>

 #foreach ($moduleAttribute in $moduleAttributes)
  #set ($checked = "")
  #set ($attribute = $moduleAttribute.Attribute)
  #set ($userAttribute = $user.getModuleUserAttribute($module.ModuleId, $attribute.AttributeId))
  #set ($intakeUserAttr = $intake.RModuleUserAttribute.mapTo($userAttribute))

## Get the attributes user has selected. If they have not select any,
## Use defaults in database.

  #set ($rmuas = $user.getRModuleUserAttributes($module))
  #if ($rmuas.isEmpty() || $usedefaults.equals("true"))
   #set ($rmuas = $module.DefaultRModuleUserAttributes)
  #end
  
  #set ($order = 1)
  #foreach ($moduleUserAttribute in $rmuas)
   #if ($attribute.Name.equals($moduleUserAttribute.Attribute.Name))
    #set ($checked = 'checked="checked"')
    #set ($order = $moduleUserAttribute.Order)
   #end
  #end

  <tr class="a">
   <td><input type="checkbox" name="selected_$attribute.AttributeId" $checked /></td>
   <td>$attribute.Name</td>
   <td>
    #numericSelect ($intakeUserAttr.Order.Key 1 $maxNum $order 1)
   </td>
  </tr>
 #end
</table>

<div class="functnbar2">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild">
  <input type="submit" value="Save" name="eventSubmit_doSelectattributes" />&#160; 
  <input type="submit" value="Cancel" name="eventSubmit_doCancel" />&#160; 
  <input type="submit" value="Reset to default"  name="eventSubmit_doCancel" />&#160; 
  <input type="submit" value="Go to issue list"  name="eventSubmit_doGoissuelist" />
  </td>
 </tr>
</table>
</div>

$intake.declareGroups()
</form>
</div>
