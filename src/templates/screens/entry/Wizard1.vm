$page.setTitle("Enter New: $scarabR.CurrentIssueType.Name")

<div id="wizard1" class="app">

#set ($issue = $scarabR.ReportingIssue)
#set ($attrValues = $issue.ModuleAttributeValuesMap)
#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)
#if ($data.Parameters.getString("templateId"))
    #set ($templateId = $data.Parameters.getString("templateId"))
#end
#if ($templateId && $templateId.trim().length() > 0)
   #set ($templ = $scarabR.IssueTemplate)
#end

<h2>$page.Title</h2>

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="entry,Wizard3.vm" />

<p class="functnbar">
<input type="submit" name="eventSubmit_doCheckforduplicates" value="Next" />&#160;
<input type="reset" value="Reset" />
</p>

#set ($privateTemplateList = $module.getPrivateTemplates($user,$issueType))
#set ($globalTemplateList = $module.getGlobalTemplates($issueType))
#if ($privateTemplateList.size() > 0 || $globalTemplateList.size() > 0)
<h3>Apply issue entry template</h3>
<div class="axial">
 <table cellpadding="3" cellspacing="2" border="0">
 <tr>
 <th>Templates</th>
 <td>
<select name="templateId">
#foreach ($template in $privateTemplateList)
 <option value="$template.IssueId">$template.TemplateInfo.Name</option>
#end
#foreach ($template in $globalTemplateList)
 <option value="$template.IssueId">$template.TemplateInfo.Name</option>
#end
</select>
      &#160;<input type="submit" value="Select" name="eventSubmit_doUsetemplates" /> 
      &#160;$link.setPage("TemplateList.vm").setLabel("View all patch templates")
 </td>
 </tr>
 </table>
 </div>
#end
</form>

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="entry,Wizard3.vm" />
<input type="hidden" name="templateId" value="$!templateId" />

<div class="axial">
#foreach ($group in $issueType.getAttributeGroups($module))
    #if ($group.Dedupe && !$group.Attributes.isEmpty())
    <h3>$group.Name</h3>
    <table cellpadding="3" cellspacing="2" border="0">
  #foreach ($att in $group.Attributes)
    #set ($rma = $module.getRModuleAttribute($att, $issueType))
      #if ($rma.Active)
        #set ($attVal = $scarabR.getNewAttributeValue($att, $issue))
        #set ($templAttVal = $templ.getAttributeValue($att))
        #set ($templAttrInput = $intake.AttributeValue.mapTo($templAttVal))
        #if ($attVal.Attribute.AttributeType.ValidationKey)
           #set ($field = $attVal.Attribute.AttributeType.ValidationKey)
        #elseif ($attVal.Attribute.AttributeType.Name == "combo-box")
           #set ($field = "OptionId")
        #else
          #set ($field = "Value")
        #end
        #if (!$attVal.Attribute.isUserAttribute())
          <tr>
            <th> #if ($attVal.isRequired())*#end 
                 $attVal.RModuleAttribute.DisplayValue: 
            </th>
            <td>
              #if ($attVal.Attribute.isUserAttribute())
                 #userSelectBox ($attVal "3" "true") 
              #elseif ($attVal.Attribute.isOptionAttribute())
                 #if ($templ)
                   #templateAttrValueLeafSelect ($attVal $templAttVal $field "")
                 #else
                   #attrValueLeafSelect ($attVal $field "")
                 #end
              #else
               #if ($templ)
                 #templateAttrValueText ( $attVal "50" $templAttrInput.Value)
               #else
                 #attrValueText ( $attVal "50" )
               #end
              #end
              #attrValueErrorMsg ($attVal $field)
            </td>
          </tr>
        #end
      #end
    #end
</table>
  #end
 #end
</div>

<p class="functnbar2">
<input type="submit" name="eventSubmit_doCheckforduplicates" value="Next" />&#160;
<input type="reset" value="Reset" />
</p>

$intake.declareGroups()

</form>
</div>
