$page.setTitle("Enter issue")

<div id="wizard1" class="app">

#set ($issue = $scarabR.ReportingIssue)
#set ($attrValues = $issue.ModuleAttributeValuesMap)
#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)
#set ($templateId = $data.Parameters.getString("templateId"))
#if ($templateId)
   #set ($templ = $scarabR.IssueTemplate)
#end

<h2>$page.Title</h2>

<div class="tabs">
<table cellpadding="3" cellspacing="0" border="0">
<tr>
<th>1: Summary info</th>
<td>2: Duplicate check</td>
<td>3: Verbose info</td>
</tr>
</table>
</div>

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="entry,Wizard3.vm" />

#set ($privateTemplateList = $module.getPrivateTemplates($user,$issueType))
#set ($globalTemplateList = $module.getGlobalTemplates($issueType))
#if ($privateTemplateList.size() > 0 || $globalTemplateList.size() > 0)
<h3>Apply issue entry template</h3>
<div class="axial">
 <table cellpadding="3" cellspacing="2" border="0">
 <tr>
 <th>Templates</th>
 <td>
<select name="templateId">
#foreach ($template in $privateTemplateList)
 <option value="$template.IssueId">$template.TemplateInfo.Name</option>
#end
#foreach ($template in $globalTemplateList)
 <option value="$template.IssueId">$template.TemplateInfo.Name</option>
#end
</select>
      &#160;<input type="submit" value="Select" name="eventSubmit_doUsetemplates" /> 
      &#160;<a href="$link.setPage("TemplateList.vm")">template list</a>
 </td>
 </tr>
 </table>
 </div>
#end
</form>

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="entry,Wizard3.vm" />
<h3>Input your issue</h3>

<div class="axial">
<table cellpadding="3" cellspacing="2" border="0">
#foreach ( $attKey in $attrValues.sequence() )
  #set ( $attVal = $attrValues.get($attKey) )
  #set ($templAttVal = "")
  #set ($templAttrInput = "")
  #set ($templAttVal = $templ.getAttributeValue($attVal.Attribute))
  #if ($templAttVal)
     #set ($templAttrInput = $intake.AttributeValue.mapTo($templAttVal))
  #end
  #if ($attVal.isDedupeAttribute())
  <tr>
   <th>
     #if ( $attVal.Attribute.AttributeType.ValidationKey )
        #set ( $field = $attVal.Attribute.AttributeType.ValidationKey )
     #elseif ($attVal.Attribute.AttributeType.Name == "combo-box" )
        #set ( $field = "OptionId" )
     #elseif ($attVal.Attribute.AttributeType.Name == "string" )
        #set ( $field = "Value" )
     #end
     #if ( $attVal.isRequired() )
        *
     #end
     $attVal.RModuleAttribute.DisplayValue
   </th>
   <td>
    #if ($attVal.Attribute.isOptionAttribute())
        #if ($templateId)
          #templateAttrValueLeafSelect ($attVal $templAttVal $field "")
        #else
          #attrValueLeafSelect ($attVal $field "")
        #end
    #elseif ($attVal.Attribute.isUserAttribute())
        #if ($templateId)
          #templateUserSelectBox ($attVal $templAttVal "5" "multiple")
        #else
          #userSelectBox ($attVal "5" "multiple")
        #end
    #else
        #if ($templateId)
          #templateAttrValueText ( $attVal "50" $templAttrInput.Value)
        #else
          #attrValueText ( $attVal "50" )
        #end
    #end
     #attrValueErrorMsg ( $attVal $field )
   </td>
   </tr>
  #end
#end
</table>
</div>

<div class="functnbar2">
<table cellpadding="4" cellspacing="0" border="1">
 <tr>
  <td class="firstchild">
  <input type="submit" name="eventSubmit_doCheckforduplicates" value="Check for duplicates" />&#160;
  <input type="reset" value="Reset" />
  </td>
 </tr>
</table>
</div>

$intake.declareGroups()
</form>
</div>
