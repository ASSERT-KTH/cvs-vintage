<div id="wizard1" class="app">

#set ($issue = $scarabR.ReportingIssue)
#set ($attrValues = $issue.ModuleAttributeValuesMap)
#set ($module = $scarabR.CurrentModule)
#set ($issueType = $scarabR.CurrentIssueType)
#set ($user = $data.User)
#if ($data.Parameters.getString("templateId"))
    #set ($templateId = $data.Parameters.getString("templateId"))
#end
#if ($templateId && $templateId.trim().length() > 0)
   #set ($templ = $scarabR.IssueTemplate)
#end

#macro(functionBar $id)
<div class="functnbar$id">
<input type="submit" name="eventSubmit_doCheckforduplicates" value="$l10n.Next" />&#160;
<input type="reset" value="$l10n.Reset" />
</div>
#end

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
<input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="entry,Wizard3.vm" />
<input type="hidden" name="$scarabG.Constant.CURRENT_ISSUE_TYPE" 
    value="$issueType.QueryKey" />

#set ($moduleAttributeGroups = $module.getDedupeGroupsWithAttributes($issueType))
#set ($magSize = $moduleAttributeGroups.size())

#* FIXME :Commenting out for now until can figure out how to make this work
#if ($magSize > 0)
#functionBar("")
#end
*#

#if ($magSize == 0)
<h3>$title</h3>
<p class="alert">$l10n.NoAttributesDefinedForIssueType</p>
#end

#set ($allTemplates = $scarabR.IssueTemplates)
#if ($allTemplates.size() > 0 && $magSize > 0)
<h3>$l10n.format("ApplyTemplate", $scarabR.CurrentRModuleIssueType.DisplayName.toLowerCase())</h3>
<div class="axial">
 <table cellpadding="3" cellspacing="2" border="0">
 <tr>
 <th>$l10n.Templates</th>
 <td>
<select name="templateId">
#foreach ($template in $allTemplates)
#if ($template.IssueId.toString().equals($data.Parameters.getString("templateId")))
 <option value="$template.IssueId" selected="selected">$template.TemplateInfo.Name</option>
#else
 <option value="$template.IssueId">$template.TemplateInfo.Name</option>
#end
#end
</select>
&#160;
<input type="submit" value="$l10n.Select" name="eventSubmit_doUsetemplates" />
&#160;
$link.setPage("TemplateList.vm").setLabel($l10n.format("ViewAllTempaltes", $scarabR.CurrentIssueType.Name.toLowerCase()))
 </td>
 </tr>
 </table>
 </div>
#end
</form>

#if ($magSize > 0)
#asterisk()
#end

<form method="post" action="$link.setPage("entry,Wizard1.vm").setAction("ReportIssue")">
#if ($templateId)
 <input type="hidden" name="templateId" value="$templateId"/>
#end
<div class="axial">
#foreach ($group in $moduleAttributeGroups)
    <h3>$group.Name</h3>
    <table cellpadding="3" cellspacing="2" border="0">
  #foreach ($att in $group.Attributes)
    #set ($rma = $module.getRModuleAttribute($att, $issueType))
      #if ($rma.Active)
        #set ($attVal = $scarabR.getNewAttributeValue($att, $issue))
        ## If templAttVal is null, set to ""
        #if ( $templ.getAttributeValue($att))   
            #set ($templAttVal = $templ.getAttributeValue($att))
        #else
            #set ($templAttVal = "")
        #end
        #set ($templAttrInput = $intake.AttributeValue.mapTo($templAttVal))
        #if ($attVal.Attribute.AttributeType.ValidationKey)
           #set ($field = $attVal.Attribute.AttributeType.ValidationKey)
        #elseif ($attVal.Attribute.AttributeType.Name == $scarabG.Constant.DROPDOWN_LIST)
           #set ($field = "OptionId")
        #else
          #set ($field = "Value")
        #end
        #if (!$attVal.Attribute.isUserAttribute())
          <tr>
            <th> #if ($attVal.isRequired())*#end 
                 $attVal.RModuleAttribute.DisplayValue
            </th>
            <td>
              #if ($attVal.Attribute.isUserAttribute())
                 #userSelectBox ($attVal "3" "true") 
              #elseif ($attVal.Attribute.isOptionAttribute())
                 #if ($templ)
                   #templateAttrValueLeafSelect ($attVal $templAttVal $field "" false)
                 #else
                   #attrValueLeafSelect ($attVal $field "" false)
                 #end
              #else
               #if ($templAttVal.Value)
                 #templateAttrValueText ( $attVal $templAttVal "50")
               #else
                 #attrValueText ( $attVal "50" )
               #end
              #end
              #attrValueErrorMsg ($attVal $field)
            </td>
          </tr>
        #end
      #end
    #end
</table>
  #end
</div>

#if ($magSize > 0)
#functionBar("2")
#end

$intake.declareGroups()

</form>
</div>
