<div class="app" id="issuelist">

<h2>$page.Title</h2>

#set ($user = $data.User)
#set ($module = $scarabR.CurrentModule)
#set ($search = $scarabR.Search)
#set ($searchType = $data.Parameters.getString("searchType",""))

#if (!$issueList)
   #set ($issueList = $scarabR.CurrentSearchResults)
#end

#if ($issueList.size() == 0)
  <h3>$page.Title</h3>
  <p class="alert">There are no matching issues.</p>
#else

## if results exceed limit, get subset list
#set ($resultsPerPage = $data.Parameters.getInt("resultsPerPage",0))
#set ($pageNum = $data.Parameters.getInt("pageNum",0))
#if ($resultsPerPage == 0)
  #set ($resultsPerPage = 25)
#end
#if ($pageNum == 0)
  #set ($pageNum = 1)
#end
#if ($issueList.size() > $resultsPerPage)
 #set ($paginated = "true")
 #set ($pagList = $scarabR.getPaginatedList($issueList, $pageNum.toString(), $resultsPerPage.toString()))
 #if ($pagList)
   #set ($issueList = $pagList)
 #end
#end

<form action="$link.setPage("IssueList.vm").setAction("Search")" method="post">
<input type="hidden" name="pageNum" value="$pageNum" />

#set ($queryString = $data.Parameters.getString("queryString",""))
#if (!$queryString.equals(""))
  <input type="hidden" name="queryString" value="$queryString" />
#end

<div class="functnbar">
<input type="submit" value="Done" name="eventSubmit_doCancel" />&#160;
#if ($searchType.equals("advanced") && !$queryString.equals(""))
<input type="submit" value="Save query" name="eventSubmit_doRedirecttosavequery" />&#160;
<input type="submit" value="Refine query" name="eventSubmit_doRefinequery" />&#160;
#end
<input type="submit" value="Cancel" name="eventSubmit_doCancel" />
</div>

<h3>$page.Title</h3>

<div class="colbar">
<small>
$link.setPage("ConfigureIssueList.vm").setLabel("Add/remove attributes from view")
</small>
</div>
		
## PAGINATION
#if( $paginated)
  #paginate ($resultsPerPage $pageNum $sortColumn $sortPolarity)
#end

#set ($sortColumn = $data.Parameters.getString("sortColumn",""))
#set ($sortPolarity = $data.Parameters.getString("sortPolarity",""))
#if (!$sortPolarity || $sortPolarity.length() == 0)
    #set ($sortPolarity = "asc")
#end

 <table width="100%" border="1" cellspacing="2" cellpadding="3">
  <tr>
  <th nowrap="nowrap"></th>

  <th>
     #if (!$sortColumn || $sortColumn.length() == 0)
        #if ($sortPolarity.equals("desc"))
           #set ($arrowLink = $link.setPage("IssueList.vm").setPathInfo("sortPolarity", "asc").addPathInfo("sortColumn", ""))
           <a href="$arrowLink"><img src="$staticLink.setPath("/images/icon_downarrow_on.gif")" width="13" height="8" alt="sort descending" title="sort descending" border="0" /></a>&#160;
        #else
           #set ($arrowLink = $link.setPage("IssueList.vm").setPathInfo("sortPolarity", "desc").addPathInfo("sortColumn", ""))
           <a href="$arrowLink"><img src="$staticLink.setPath("/images/icon_uparrow_on.gif")" width="13" height="8" alt="sort ascending" title="sort ascending" border="0" /></a>&#160;
        #end
     Issue Id
     #else
        #set ($sortLink = $link.setPage("IssueList.vm").setPathInfo("sortColumn","").setPathInfo("sortPolarity", $sortPolarity))
        <a href="$sortLink">Issue ID</a>
     #end
  </th>
#set ($rmuas = $user.getRModuleUserAttributes($module, $scarabR.CurrentIssueType))
#if ($rmuas.isEmpty())
 #set ($rmuas = $module.getDefaultRModuleUserAttributes($scarabR.CurrentIssueType))
#end

## ISSUE ATTRIBUTE VALUES
#foreach ($rmua in $rmuas)
 #set ($userAttribute = $rmua.Attribute)
 <th>
     #if ($sortColumn.equals($userAttribute.AttributeId.toString()))
        #if ($sortPolarity.equals("desc"))
           #set ($arrowLink = $link.setPage("IssueList.vm").setPathInfo("sortPolarity", "asc").setPathInfo("sortColumn", "$userAttribute.AttributeId"))
           <a href="$arrowLink"><img src="$staticLink.setPath("/images/icon_downarrow_on.gif")" width="13" height="8" alt="sort descending" title="sort descending" border="0" /></a>&#160;
        #else
           #set ($arrowLink = $link.setPage("IssueList.vm").setPathInfo("sortPolarity", "desc").setPathInfo("sortColumn", "$userAttribute.AttributeId"))
           <a href="$arrowLink"><img src="$staticLink.setPath("/images/icon_uparrow_on.gif")" width="13" height="8" alt="sort descending" title="sort descending" border="0" /></a>&#160;
        #end
        $userAttribute.Name
     #else
        #set ($sortLink = $link.setPage("IssueList.vm").setPathInfo("sortColumn", "$userAttribute.AttributeId").setPathInfo("sortPolarity", "$sortPolarity"))
        <a href="$sortLink">$userAttribute.Name</a>
     #end
  </th>
#end
  </tr>

#foreach ($issueId in $issueList)
 #set ($issue = $scarabR.getIssueByPk($issueId.toString()))
 #set ($issueLink = $link.setPage("ViewIssue.vm").setPathInfo("id", $issue.UniqueId.toString()))
<input type="hidden" name="all_issue_ids" value="$issue.IssueId" />
 #indexedRows($velocityCount)
  <td><input type="checkbox" name="selected_$issue.IssueId" /></td>
  <td><a href="$issueLink">$issue.UniqueId</a></td>
#foreach ($rmua in $rmuas)
 #set ($userAttribute = $rmua.Attribute)
  <td>
  ## Setting value to "" first so it doesn't use value from last attribute
  #set ($value = "")
#if ($userAttribute.isUserAttribute())
  #set ($values = $issue.getAttributeValues($userAttribute))
  #set ($comma = "")
  #foreach ($av in $values)
    #set($value = "$value$comma$av.Value")
  #set ($comma = ", ")
  #end
#else
  #set ($value = $issue.getAttributeValue($userAttribute).Value)
#end
  #if (!$value.equals(""))
   $value
  #else
    -------
  #end
  </td>
#end
  </tr>
#end
  </table>

<div class="functnbar3">
#if ($scarabR.hasPermission($scarabG.Permission.ISSUE__ASSIGN, $module))
   <input type="submit" value="Assign" name="eventSubmit_doReassignselected" />&#160;
#end
<input type="submit" value="View verbose"  name="eventSubmit_doViewselected" />&#160;
<small>selected</small>&#160;&#160;<img src="$staticLink.setPath("/images/seperator.gif")" width="2" height="15" alt="" border="0" align="middle" />&#160;&#160;
#if ($scarabR.hasPermission($scarabG.Permission.ISSUE__ASSIGN, $module))
  <input type="submit" value="Assign" name="eventSubmit_doReassignall" />&#160;
#end
<input type="submit" value="View verbose" name="eventSubmit_doViewall" />&#160;
<small>all</small>&#160;
</div>
        
#if ($paginated)
  #paginate ($resultsPerPage $pageNum $sortColumn $sortPolarity)
#end


<div class="axial">
  <table cellpadding="3" cellspacing="2" border="0">
    <tr>
       <th>Max items per page</td>
 <td>
 <input type="radio" value="25" name="resultsPerPage" #if ($resultsPerPage.toString().equals("25")) checked="checked" #end /> 25
 <input type="radio" name="resultsPerPage" value="50" #if ($resultsPerPage.toString().equals("50")) checked="checked" #end /> 50
 <input type="radio" name="resultsPerPage" value="75" #if ($resultsPerPage.toString().equals("75")) checked="checked" #end /> 75
 <input type="radio" name="resultsPerPage" value="100" #if ($resultsPerPage.toString().equals("100")) checked="checked" #end /> 100
 <input type="submit" name="eventSubmit_doSearch" value="Refresh" />
 </td>
   </tr>
  </table>
</div>
#end

<div class="functnbar2">
<input type="submit" value="Done" name="eventSubmit_doCancel" />&#160;
#if ($searchType.equals("advanced") &&  $queryString)
<input type="submit" value="Save query" name="eventSubmit_doRedirecttosavequery" />&#160;
<input type="submit" value="Refine query" name="eventSubmit_doRefinequery" />&#160;
#end
<input type="submit" value="Cancel" name="eventSubmit_doCancel" />
</div>

</form>
</div>
