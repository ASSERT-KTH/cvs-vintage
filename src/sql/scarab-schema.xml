<?xml version="1.0" encoding="ISO-8859-1" standalone="no" ?>
<!DOCTYPE database SYSTEM
          "http://jakarta.apache.org/turbine/dtd/database.dtd">

<!-- $Id: scarab-schema.xml,v 1.129 2003/04/09 00:42:06 jon Exp $ -->

<database name="@DATABASE_PROP_NAME@" defaultJavaType="object">
<!--
    History of changes made to the attributes of an issue.
-->
<table name="SCARAB_ACTIVITY" idMethod="idbroker" javaName="Activity">
    <!--
        PK.
    -->
    <column name="ACTIVITY_ID" primaryKey="true" required="true" 
        type="BIGINT"/>
    <!--
        Issue attribute of which has been modified.
    -->
    <column name="ISSUE_ID" required="true" type="BIGINT"></column>
    <!--
        Attribute that has been modified.
    -->
    <column name="ATTRIBUTE_ID" required="true" type="INTEGER"/>
    <!--
        ActivitySet to which the attribute modification belongs.
    -->
    <column name="TRANSACTION_ID" required="true" type="BIGINT"/>
    <!--
        Value of integer attribute before modification.
    -->
    <column name="OLD_NUMERIC_VALUE" required="false" type="INTEGER" />
    <!--
        Value of integer attribute after modification.
    -->
    <column name="NEW_NUMERIC_VALUE" required="false" type="INTEGER" />
    <!--
        Value of user attribute before modification.
    -->
    <column name="OLD_USER_ID" required="false" type="INTEGER" />
    <!--
        Value of user attribute after modification.
    -->
    <column name="NEW_USER_ID" required="false" type="INTEGER" />
    <!--
        Value of option attribute before modification.
    -->
    <column name="OLD_OPTION_ID" required="false" type="INTEGER" />
    <!--
        Value of option attribute after modification.
    -->
    <column name="NEW_OPTION_ID" required="false" type="INTEGER" />
    <!--
        Value of attribute before modification.
    -->
    <column name="OLD_VALUE" required="false" type="LONGVARCHAR"></column>
    <!--
        Value of attribute after modification.
    -->
    <column name="NEW_VALUE" required="false" type="LONGVARCHAR"></column>
    <!--
        Value of the dependency change.
    -->
    <column name="DEPEND_ID" required="false" type="INTEGER"></column>
    <!--
        System-generated description of modification.
    -->
    <column name="DESCRIPTION" required="false" type="VARCHAR" size="255"></column>
    <!--
        Date this Activity is no longer the current value of the Attribute.
    -->
    <column name="END_DATE" required="false" type="DATE"/>

    <!--
        If an attachment is associated to the activity, store it
        here. Note: there is also attachments associated to the 
        activitySet which 'contains' the activity. These are generally
        the result of multiple activity records being created via
        the modification of several attributes at one time.
    -->
    <column name="ATTACHMENT_ID" required="false" type="BIGINT"/>

    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="ISSUE_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_TRANSACTION">
        <reference local="TRANSACTION_ID" foreign="TRANSACTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="OLD_USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="NEW_USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OLD_OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="NEW_OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTACHMENT">
        <reference local="ATTACHMENT_ID" foreign="ATTACHMENT_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_DEPEND">
        <reference local="DEPEND_ID" foreign="DEPEND_ID"/>
    </foreign-key>

    <index name="IX_ATTRIBUTE_ISSUE_ENDDATE">
        <index-column name="ATTRIBUTE_ID"/>
        <index-column name="ISSUE_ID"/>
        <index-column name="END_DATE"/>
    </index>
    <index name="IX_ISSUE_TRANSACTION">
        <index-column name="ISSUE_ID"/>
        <index-column name="TRANSACTION_ID"/>
    </index>
    <index name="IX_TRANSACTION">
        <index-column name="TRANSACTION_ID"/>
    </index>
    <!-- 
         This index is useful in reports.  My first guess was that including 
         END_DATE in the index would be useful, but it appears to slow things 
         down about 50% 
    -->
    <index name="IX_NEW_OPTION_ISSUE">
        <index-column name="NEW_OPTION_ID"/>
        <index-column name="ISSUE_ID"/>
    </index>
    <index name="IX_NEW_USER_ISSUE">
        <index-column name="NEW_USER_ID"/>
        <index-column name="ISSUE_ID"/>
    </index>
     <!-- with only the above indices a search criteria containing several
          attributes with multiple options per attribute was not able to 
          make use of the common issue_id join condition which led to a
          cross join of sorts.  We could replace the index above with those
          below, but the optimum speed is obtained with both. -->
    <index name="IX_ISSUE_NEW_OPTION">
        <index-column name="ISSUE_ID"/>
        <index-column name="NEW_OPTION_ID"/>
    </index>
    <index name="IX_ISSUE_NEW_USER">
        <index-column name="ISSUE_ID"/>
        <index-column name="NEW_USER_ID"/>
    </index>
</table>


<!--
    Attachment is a piece of information associated with an issue.
-->
<table name="SCARAB_ATTACHMENT" idMethod="idbroker" javaName="Attachment">
    <!--
        Unique identifier.
    -->
    <column name="ATTACHMENT_ID" primaryKey="true" required="true" type="BIGINT"></column>
    <!--
        Issue that attachment is associated with.
    -->
    <column name="ISSUE_ID" required="false" type="BIGINT"></column>
    <!--
        Type.
    -->
    <column name="ATTACHMENT_TYPE_ID" javaName="TypeId" required="true" type="INTEGER"></column>
    <!--
        Name that is displayed in the UI.
    -->
    <column name="ATTACHMENT_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <!--
        Actual information constituting the attachment.
    -->
    <column name="ATTACHMENT_DATA" javaName="Data" required="false" type="LONGVARCHAR"></column>
    <!--
        Server side location of the file that contains attachment.
        Location is relative to the central file storage location
        specified in the application properties.
    -->
    <column name="ATTACHMENT_FILE_PATH" javaName="FileName" required="false" type="VARCHAR" size="255"></column>
    <!--
        MIME type of the attachment.
        Describes type of information constituting an attachment.
    -->
    <column name="ATTACHMENT_MIME_TYPE" javaName="MimeType" required="true" type="VARCHAR" size="255"/>
    <!--
        Person that made last modification to the attachment.
    -->
    <column name="MODIFIED_BY" required="false" type="INTEGER"></column>
    <!--
        Person that associated the attachment with an issue initially.
    -->
    <column name="CREATED_BY" required="false" type="INTEGER"></column>
    <!--
        Date of the last modification of the attachment.
    -->
    <column name="MODIFIED_DATE" required="false" type="TIMESTAMP"></column>
    <!--
        Date of the initial association of attachment with an issue.
    -->
    <column name="CREATED_DATE" required="false" type="TIMESTAMP"></column>
    <!--
        Flag, which marks that attachment has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
            default="0" size="1" javaType="primitive"></column>
    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="ISSUE_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTACHMENT_TYPE">
        <reference local="ATTACHMENT_TYPE_ID" foreign="ATTACHMENT_TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="CREATED_BY" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="MODIFIED_BY" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    Possible types of attachements.
    Example: Comment
    Example: File
-->
<table name="SCARAB_ATTACHMENT_TYPE" idMethod="idbroker" 
    javaName="AttachmentType">
    <!--
        Unique identifier.
    -->
    <column name="ATTACHMENT_TYPE_ID" primaryKey="true" required="true" 
        type="INTEGER" />
    <!--
        Name.
    -->
    <column name="ATTACHMENT_TYPE_NAME" javaName="Name" required="true" 
        type="VARCHAR" size="255" />
    <!--
        Flag marking text/searchable attachments
    -->
    <column name="SEARCHABLE" default="0" type="BOOLEANINT" 
        size="1" javaType="primitive"/>
</table>



<!--
    Possible attributes of an issue.
    Example: Operating System
    Example: Severity
-->
<table name="SCARAB_ATTRIBUTE" idMethod="idbroker" javaName="Attribute">
    <!--
        Unique identifier.
    -->
    <column name="ATTRIBUTE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="ATTRIBUTE_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <!--
        Type.
    -->
    <column name="ATTRIBUTE_TYPE_ID" javaName="TypeId" required="true" type="INTEGER"></column>
    <!--
        A permission related to this attribute.
    -->
    <column name="PERMISSION" required="false" type="VARCHAR" size="255"/>
    <!--
        A required option for this attribute to be active.
    -->
    <column name="REQUIRED_OPTION_ID" required="false" type="INTEGER"></column>
    <!--
        Description.
    -->
    <column name="DESCRIPTION" javaName="Description" required="true" type="VARCHAR" size="255"></column>
    <!--
        For user attributes, whether the user will be emailed, cc'd, or neither.
    -->
    <column name="ACTION" required="false" type="VARCHAR" size="255"/>
    <!--
        Person that set value to the column of the table initially.
    -->
    <column name="CREATED_BY" javaName="CreatedBy" required="false" type="INTEGER"></column>
    <!--
        Date of the initial set of the column of the table.
    -->
    <column name="CREATED_DATE" javaName="CreatedDate" required="false" type="TIMESTAMP"></column>
    <!--
        Flag, which marks that attribute has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_TYPE">
        <reference local="ATTRIBUTE_TYPE_ID" foreign="ATTRIBUTE_TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="REQUIRED_OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="CREATED_BY" foreign="USER_ID"/>
    </foreign-key>
</table>


<!--
    Groupings in which attributes appear on the page.
-->
<table name="SCARAB_ATTRIBUTE_GROUP" idMethod="idbroker" javaName="AttributeGroup">
    <!--
        Unique identifier.
    -->
    <column name="ATTRIBUTE_GROUP_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <column name="NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <column name="DESCRIPTION" javaName="Description" required="false" type="VARCHAR" size="255"></column>
    <!--
        Module.
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"></column>
    <!--
        Issue type.
    -->
    <column name="ISSUE_TYPE_ID" required="true" type="INTEGER"></column>
    <column name="ACTIVE" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="DEDUPE" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="PREFERRED_ORDER" javaName="Order" required="false" 
            default="-1" type="INTEGER" javaType="primitive"></column>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
    <index name="IX_ISSUE_MODULE_PREF_ORDER">
        <index-column name="ISSUE_TYPE_ID"/>
        <index-column name="MODULE_ID"/>
        <index-column name="PREFERRED_ORDER"/>
    </index>
</table>

<!--
    Mapping from attributes to groups.
-->
<table name="SCARAB_R_ATTRIBUTE_ATTRGROUP" idMethod="none" javaName="RAttributeAttributeGroup">
    <!--
        Group.
    -->
    <column name="GROUP_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Attribute.
    -->
    <column name="ATTRIBUTE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <column name="PREFERRED_ORDER" javaName="Order" required="false" 
            default="-1" type="INTEGER" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_GROUP">
        <reference local="GROUP_ID" foreign="ATTRIBUTE_GROUP_ID"/>
    </foreign-key>
</table>


<!--
    Attribute class is group of attributes types that have the same properties.
    Example: Free form input
    Example: Select one from the list
-->
<table name="SCARAB_ATTRIBUTE_CLASS" idMethod="idbroker" 
         javaName="AttributeClass">
    <!--
        Unique identifier.
    -->
    <column name="ATTRIBUTE_CLASS_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="ATTRIBUTE_CLASS_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <!--
        Description.
    -->
    <column name="ATTRIBUTE_CLASS_DESC" javaName="Desc" required="true" type="VARCHAR" size="255"></column>
    <!--
        Fully qualified name of the java class that represents attribute,
        belonging to the attribute class, in the application.
    -->
    <column name="JAVA_CLASS_NAME" required="false" type="VARCHAR" size="255"></column>
</table>


<!--
    Attribute option is possible value of an attribute of an issue.
    Example: DOS 3.1 (for attribute Operating System)
-->
<table name="SCARAB_ATTRIBUTE_OPTION" idMethod="idbroker" 
        javaName="AttributeOption">
    <!--
        Unique identifier.
    -->
    <column name="OPTION_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Attribute that can take the options as its value.
    -->
    <column name="ATTRIBUTE_ID" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="OPTION_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <!--
        Flag, which marks that option has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <index name="IX_ATTRIBUTE">
        <index-column name="ATTRIBUTE_ID"/>
    </index>
</table>

<!--
    Possible types of dependency between options.
    Example: Parent-Child
    Example: Requires
-->
<table name="SCARAB_OPTION_RELATIONSHIP" idMethod="idbroker" 
       javaName="OptionRelationship">
    <!--
        Unique identifier.
    -->
    <column name="RELATIONSHIP_ID" primaryKey="true" required="true" 
            type="INTEGER"/>
    <!--
        Name.
    -->
    <column name="RELATIONSHIP_NAME" javaName="Name" required="true" 
            type="VARCHAR" size="100"/>
</table>

<!--
    Attribute type is group of attributes that have the same representation
    in the application data structure.
    Attribute type fully defines attribute behavior.
    Example: Integer
    Example: String
-->
<table name="SCARAB_ATTRIBUTE_TYPE" idMethod="idbroker" 
        javaName="AttributeType">
    <!--
        Unique identifier.
    -->
    <column name="ATTRIBUTE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Attribute class.
    -->
    <column name="ATTRIBUTE_CLASS_ID" javaName="ClassId" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="ATTRIBUTE_TYPE_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
    <!--
        Fully qualified name of the java class that represents attribute,
        belonging to the attribute type, in the application.
    -->
    <column name="JAVA_CLASS_NAME" required="false" type="VARCHAR" size="255"/>
    <!--
        A key which ties into a validation service (intake).
    -->
    <column name="VALIDATION_KEY" required="false" type="VARCHAR" size="20"/>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_CLASS">
        <reference local="ATTRIBUTE_CLASS_ID" foreign="ATTRIBUTE_CLASS_ID"/>
    </foreign-key>
</table>


<!--
    Dependency between issues.
    Example: Issue is a duplicate of another issue.
    Example: Issue is blocking another issue.
-->
<table name="SCARAB_DEPEND" idMethod="idbroker" javaName="Depend">
    <!--
        Unique identifier.
    -->
    <column name="DEPEND_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Issue that other issue depends upon.
        Example: Issue that blocks.
        Example: Issue that has duplicates.
    -->
    <column name="OBSERVED_ID" primaryKey="false" required="true" type="BIGINT"></column>
    <!--
        Issue that depends on other issue.
        Example: Issue that is being blocked.
        Example: Issue that is duplicate.
    -->
    <column name="OBSERVER_ID" primaryKey="false" required="true" type="BIGINT"></column>
    <!--
        Type.
    -->
    <column name="DEPEND_TYPE_ID" javaName="TypeId" required="true" type="INTEGER"></column>
    <!--
        Flag, which marks that dependency has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT"
        default="0" size="1" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="OBSERVED_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="OBSERVER_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_DEPEND_TYPE">
        <reference local="DEPEND_TYPE_ID" foreign="DEPEND_TYPE_ID"/>
    </foreign-key>

    <index name="IX_DEPEND_OBSERVED">
        <index-column name="OBSERVED_ID"/>
        <index-column name="DEPEND_TYPE_ID"/>
    </index>
    <index name="IX_DEPEND_OBSERVER">
        <index-column name="OBSERVER_ID"/>
        <index-column name="DEPEND_TYPE_ID"/>
    </index>
</table>

<!--
    Possible types of dependency between issues.
    Example: Duplicate
    Example: Block
-->
<table name="SCARAB_DEPEND_TYPE" idMethod="idbroker" javaName="DependType">
    <!--
        Unique identifier.
    -->
    <column name="DEPEND_TYPE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="DEPEND_TYPE_NAME" javaName="Name" required="true" type="VARCHAR" size="100"></column>

    <!--
        This column needs to be unique
    -->
    <unique>
        <unique-column name="DEPEND_TYPE_NAME"/>
    </unique>
</table>

<!--
    Information about artifact under processing in tracking system.
    Example: Particular defect
    Example: Particular inquiry
-->
<table name="SCARAB_ISSUE" idMethod="idbroker" javaName="Issue">
    <!--
        Unique identifier used for primary key.
    -->
    <column name="ISSUE_ID" primaryKey="true" required="true" type="BIGINT"></column>
    <!--
        Part of Id related to module.
    -->
    <column name="ID_PREFIX" required="true" type="VARCHAR" size="4"/>
    <!--
        Part of Id which is an integer.
    -->
    <column name="ID_COUNT" type="INTEGER" size="10" required="true" 
        javaType="primitive"/>
    <!--
        The instance of scarab the issue was originally reported to.
        This field could be null for the normal instance where the issue
        is local to this database.
    -->
    <column name="ID_DOMAIN"  type="VARCHAR" size="127"/>
    <!--
        Type : Issue, or Enter Issue Template
    -->
    <column name="TYPE_ID"  required="false" type="INTEGER"/>
    <!--
        Module that issue relates to.
    -->
    <column name="MODULE_ID" required="true" type="INTEGER"></column>
    <!--
        Flag, which marks that issue has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
    <index name="IX_TYPE_MODULE">
        <index-column name="TYPE_ID"/>
        <index-column name="MODULE_ID"/>
    </index>
    <index name="IX_COUNT_PREFIX">
        <index-column name="ID_COUNT"/>
        <index-column name="ID_PREFIX"/>
    </index>
</table>

<table name="SCARAB_ISSUE_TYPE" idMethod="idbroker" javaName="IssueType">
    <!--
        Unique identifier used for primary key.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="NAME" javaName="Name" required="true" type="VARCHAR" 
            size="100"/>
    <!--
        Description.
    -->
    <column name="DESCRIPTION" javaName="Description" required="false" type="VARCHAR" size="255"></column>
    <!--
        If this issue type is a template, the id of the issue type it
        Corresponds to. If is not, parent id is 0.
    -->
    <column name="PARENT_ID" required="true" type="INTEGER"></column>
    <!--
        Deduping on/off for this issuetype.
    -->
    <column name="DEDUPE" required="false" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="LOCKED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="ISDEFAULT" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="PARENT_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
</table>

<!--
    Mapping between modules and issue types.
-->
<table name="SCARAB_R_MODULE_ISSUE_TYPE" idMethod="none" javaName="RModuleIssueType">
    <!--
        Module.
    -->
    <column name="MODULE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Artifact type.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Flag, which marks that the issue type is not used.
    -->
    <column name="ACTIVE" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Whether or not the issue type shows up in left hand nav.
    -->
    <column name="DISPLAY" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Order the the issue types appear in the left nav.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="false"
         default="0" type="INTEGER" javaType="primitive"/>
    <!--
        Deduping on/off for this module/issuetype.
    -->
    <column name="DEDUPE" required="false" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Default number of history entries.
    -->
    <column name="HISTORY" required="false" default="5" type="INTEGER"
         javaType="primitive"/>
    <!--
        Default number of comments.
    -->
    <column name="COMMENTS" required="false" default="5" type="INTEGER"
        javaType="primitive"/>
    <!--
        Value that represents the name of the issue type in the UI.
    -->
    <column name="DISPLAY_NAME" required="false" type="VARCHAR" size="255"/>
    <!--
        Value that represents the description of the issue type in the UI.
    -->
    <column name="DISPLAY_DESCRIPTION" required="false" type="VARCHAR" size="255"/>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
</table>


<table name="SCARAB_MIT_LIST" idMethod="idbroker" javaName="MITList">
    <!--
        Unique identifier used for primary key.
    -->
    <column name="LIST_ID" primaryKey="true" required="true" type="BIGINT" />
    <!--
        Name.
    -->
    <column name="NAME" javaName="Name" required="false" type="VARCHAR" 
            size="100"/>
    <column name="ACTIVE" type="BOOLEANINT" default="1" 
        size="1" javaType="primitive"/>
    <column name="MODIFIABLE" type="BOOLEANINT" default="1" 
        size="1" javaType="primitive"/>
    <column name="USER_ID" required="false" type="INTEGER"/>

    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    Mapping between modules and issue types.
-->
<table name="SCARAB_MIT_LISTITEM" idMethod="idbroker" javaName="MITListItem">
    <!--
        Module.
    -->
    <column name="ITEM_ID" primaryKey="true" required="true" type="BIGINT"/>
    <!--
        Module.
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"/>
    <!--
        Artifact type.
    -->
    <column name="ISSUE_TYPE_ID" required="false" type="INTEGER"/>
    <!--
        The list this item belongs to.
    -->
    <column name="LIST_ID" required="true" type="BIGINT"/>

    <foreign-key foreignTable="SCARAB_MIT_LIST">
        <reference local="LIST_ID" foreign="LIST_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
</table>


<!--
    Actual attribute of the issue with its value.
-->
<table name="SCARAB_ISSUE_ATTRIBUTE_VALUE" idMethod="idbroker" 
        javaName="AttributeValue">
    <!--
        PK.
    -->
    <column name="VALUE_ID" primaryKey="true" required="true" type="BIGINT" />
    <!--
        Issue that attribute belongs to.
    -->
    <column name="ISSUE_ID" required="true" type="BIGINT"></column>
    <!--
        Attribute.
    -->
    <column name="ATTRIBUTE_ID" required="true" 
            type="INTEGER" inheritance="single" />
    <!-- 
         some attributes are better saved in numeric format, so this column
         can be used in place of VALUE 
    -->
    <column name="NUMERIC_VALUE" required="false" type="INTEGER" size="11" />
    <!--
        Option that is the value of the attribute if attribute is option based.
    -->
    <column name="OPTION_ID" required="false" type="INTEGER"></column>
    <!--
        Person that is the value of the attribute if attribute is person based.
    -->
    <column name="USER_ID" required="false" type="INTEGER"></column>

    <!--
        Display value of the attribute.
        This column should always contain a value which serves as a "summary value"
        of the attribute, you MAY need to look elsewhere to get real value.
        Purpose of this "duplication" is to be able to get overview of the attribute
        independently of what kind of attribute this is. This also improves performance
        so you do not need to perform (sometimes complex) processing each time you view the issue.
        It lets you get list of issues with their attributes with a single SQL statement.
        Examples of what would go into this fields for different kinds of attributes:
         - For "free-form" attributes this would be the actual value (it's String
            representation to be exact)
         - For "select-one" this would be a copy of value in SCARAB_ATTRIBUTE_OPTION.DISPLAY_VALUE.
            There will also be an apropriate value in OPTION_ID column which you should use to
            join with SCARAB_ATTRIBUTE_OPTION
         - For "voted" attributes this would be the vote result. For bugzilla-style votes it is sum
            of all votes casted. For average vote this result is DISPLAY_VALUE of OPTION which has
             computed as: round(sum(votes.numeric_value)/count(votes)). For "Tracking"
            attribute which is also considered a voted attribute this value is a list of login_IDs
            of users tracking the issue.

         It is responsibility of Attribute's subclass which implements this ATTRIBUTE_TYPE to
         populate this field with an apropriate value.

    -->
    <column name="VALUE" required="false" type="LONGVARCHAR"></column>

    <!--
        Flag, which marks that attribute has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="ISSUE_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <index name="IX_DELETED_ISSUE_ATTRIBUTE">
        <index-column name="DELETED"/>
        <index-column name="ISSUE_ID"/>
        <index-column name="ATTRIBUTE_ID"/>
     </index>
     <!-- index which greatly improves searches for issues based on 
          option_ids (AdvancedQuery.vm). The test showed having deleted as
          the last key was slightly better than having it as the first
          key, but the dataset was skewed towards having all deleted=0, so
          I don't know how it might work with a more even distribution. -->
     <index name="IX_AV_OPTION_ISSUE_DEL">
        <index-column name="OPTION_ID"/>
        <index-column name="ISSUE_ID"/>
        <index-column name="DELETED"/>
     </index>
     <!-- Similar indices to the above for non-option attributes -->
     <index name="IX_AV_USER_ISSUE_DEL">
        <index-column name="USER_ID"/>
        <index-column name="ISSUE_ID"/>
        <index-column name="DELETED"/>
     </index>
     <index name="IX_AV_INT_ISSUE_DEL">
        <index-column name="NUMERIC_VALUE"/>
        <index-column name="ISSUE_ID"/>
        <index-column name="DELETED"/>
     </index>
     <!-- with only the above indices a search criteria containing several
          attributes with multiple options per attribute was not able to 
          make use of the common issue_id join condition which led to a
          cross join of sorts.  We could replace the index above with those
          below, but the optimum speed is obtained with both. -->
     <index name="IX_AV_ISSUE_OPTION_DEL">
        <index-column name="ISSUE_ID"/>
        <index-column name="OPTION_ID"/>
        <index-column name="DELETED"/>
     </index>
     <index name="IX_AV_ISSUE_USER_DEL">
        <index-column name="ISSUE_ID"/>
        <index-column name="USER_ID"/>
        <index-column name="DELETED"/>
     </index>
     <index name="IX_AV_ISSUE_INT_DEL">
        <index-column name="ISSUE_ID"/>
        <index-column name="NUMERIC_VALUE"/>
        <index-column name="DELETED"/>
     </index>
</table>

<!--
    Modification information for table. Not currently used.
-->
<table name="SCARAB_MODIFICATION" idMethod="idbroker" javaName="Modification">
    <!--
        Table.
    -->
    <column name="TABLE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Column of the table.
    -->
    <column name="COLUMN_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Person that made last modification to the column of the table.
    -->
    <column name="MODIFIED_BY" required="false" type="INTEGER"></column>
    <!--
        Person that set value to the column of the table initially.
    -->
    <column name="CREATED_BY" required="false" type="INTEGER"></column>
    <!--
        Date of the last modification of the column of the table.
    -->
    <column name="MODIFIED_DATE" required="false" type="TIMESTAMP"></column>
    <!--
        Date of the initial set of the column of the table.
    -->
    <column name="CREATED_DATE" required="false" type="TIMESTAMP"></column>
</table>

<!--
    Logical category of issues.
    Usually corresponds to the software project.
    Example: Scarab
-->
<table name="SCARAB_MODULE" idMethod="idbroker" javaName="ScarabModule" 
    baseClass="org.tigris.scarab.om.AbstractScarabModule"
    interface="Module">
    <!--
        Unique identifier.
    -->
    <column name="MODULE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name. It is RealName because Module implements the Turbine Group interface
        and having it as Name would clash with that interface. Please note that
        the result of group.getName() needs to be unique for each SCARAB_MODULE.
    -->
    <column name="MODULE_NAME" javaName="RealName" required="true" type="VARCHAR" size="255"></column>
    <!--
        The instance name of scarab the module is located within.
    -->
    <column name="DOMAIN"  type="VARCHAR" size="127"/>
    <!--
        Abbreviation whose primary use to identify related issues.
    -->
    <column name="MODULE_CODE" javaName="Code" required="true" 
            type="VARCHAR" size="4"/>
    <!--
        Description.
    -->
    <column name="MODULE_DESCRIPTION" javaName="Description" required="true" type="VARCHAR" size="255"></column>
    <!--
        URL pointing to the information on the module.
    -->
    <column name="MODULE_URL" javaName="Url" required="false" type="VARCHAR" size="255"></column>
    <!--
        An email address that all emails generated for this module 
        will be sent to.
    -->
    <column name="ARCHIVE_EMAIL" required="false" type="VARCHAR" size="99"/>
    <!--
        Parent module containing the module.
        Allows for hierarchical structure of modules.
    -->
    <column name="PARENT_ID" required="true" type="INTEGER"></column>
    <!--
        Person that is responsible for the module. @deprecated
    -->
    <column name="OWNER_ID" required="false" type="INTEGER"></column>
    <!--
        Key quality assurance person for the module. @deprecated
    -->
    <column name="QA_CONTACT_ID" required="false" type="INTEGER"></column>
    <!--
        Flag, which marks that module has been deleted.
    -->
    <column name="DELETED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="LOCKED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="CLASS_KEY" required="false" type="INTEGER" 
        javaType="primitive" inheritance="single">
      <inheritance key="1" class="ScarabModuleContainer" extends="org.tigris.scarab.om.ScarabModule"/>
    </column>

    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="PARENT_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="OWNER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="QA_CONTACT_ID" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    Attributes that are applicable to issues of the particular module.
-->
<table name="SCARAB_R_MODULE_ATTRIBUTE" idMethod="none" javaName="RModuleAttribute">
    <!--
        Module.
    -->
    <column name="MODULE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Attribute.
    -->
    <column name="ATTRIBUTE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Issue type.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Value that represents the attribute in the UI.
    -->
    <column name="DISPLAY_VALUE" required="true" type="VARCHAR" size="255"/>
    <!--
        Flag, which marks that module attribute is not used.
    -->
    <column name="ACTIVE" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Flag, which marks that issues entered for this module must have
        this attribute set.
    -->
    <column name="REQUIRED" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <!--
        Column order.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="true" default="0" type="INTEGER" javaType="primitive"/>
    <!--
        Flag, which marks this attribute as being eligible for quick search.
    -->
    <column name="QUICK_SEARCH" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <!--
        Flag, which marks that this attribute should be used in the email
        subject line, when an issue is created. May be used in other
        contexts as well
    -->
    <column name="DEFAULT_TEXT_FLAG" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>

    <index name="IX_MOD_ATTR_REQUIRED">
        <index-column name="REQUIRED"/>
    </index>
    <index name="IX_MOD_ATTR_QUICKSEARCH">
        <index-column name="QUICK_SEARCH"/>
    </index>
</table>

<!--
    Attributes that are mapped to a global issue type.
-->
<table name="SCARAB_R_ISSUETYPE_ATTRIBUTE" idMethod="none" javaName="RIssueTypeAttribute">
    <!--
        Attribute.
    -->
    <column name="ATTRIBUTE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Issue type.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Flag, which marks that module attribute is not used.
    -->
    <column name="ACTIVE" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Flag, which marks that issues entered for this module must have
        this attribute set.
    -->
    <column name="REQUIRED" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <!--
        Column order.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="true" default="0" type="INTEGER" javaType="primitive"/>
    <!--
        Flag, which marks this attribute as being eligible for quick search.
    -->
    <column name="QUICK_SEARCH" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <!--
        Flag, which marks that this attribute should be used in the email
        subject line, when an issue is created. May be used in other
        contexts as well
    -->
    <column name="DEFAULT_TEXT_FLAG" required="true" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <column name="LOCKED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>

    <index name="IX_ISSUETYPE_ATTR_REQUIRED">
        <index-column name="REQUIRED"/>
    </index>
    <index name="IX_ISSUETYPE_ATTR_QUICKSEARCH">
        <index-column name="QUICK_SEARCH"/>
    </index>
</table>

<!--
    Options that are applicable to issues of the particular module.
-->
<table name="SCARAB_R_MODULE_OPTION" idMethod="none" javaName="RModuleOption">
    <!--
        Module.
    -->
    <column name="MODULE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Issue Type.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Option.
    -->
    <column name="OPTION_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Value that represents the option in the UI.
    -->
    <column name="DISPLAY_VALUE" required="false" type="VARCHAR" size="255"/>
    <!--
        Flag, which marks that option has been deleted within the module.
    -->
    <column name="ACTIVE" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <!--
        Allows the template engineer and module owner some means to 
        order option listings.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="false" 
            default="-1" type="INTEGER" javaType="primitive"/>
    <column name="WEIGHT" javaName="Weight" required="false" 
            default="-1" type="INTEGER" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
</table>

<!--
    Attribute options that are mapped to a global issue type.
-->
<table name="SCARAB_R_ISSUETYPE_OPTION" idMethod="none" javaName="RIssueTypeOption">
    <!--
        Issue Type.
    -->
    <column name="ISSUE_TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Option.
    -->
    <column name="OPTION_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Flag, which marks that option has been deleted within the module.
    -->
    <column name="ACTIVE" required="true" type="BOOLEANINT" 
        default="1" size="1" javaType="primitive"/>
    <column name="LOCKED" required="false" type="BOOLEANINT" 
        default="0" size="1" javaType="primitive"/>
    <!--
        Allows the template engineer and module owner some means to 
        order option listings.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="false" 
            default="-1" type="INTEGER" javaType="primitive"/>
    <column name="WEIGHT" javaName="Weight" required="false" 
            default="-1" type="INTEGER" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OPTION_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
</table>

<!--
    Sets up relations between options.
-->
<table name="SCARAB_R_OPTION_OPTION" idMethod="none" javaName="ROptionOption">
    <!--
        Parent Option.
    -->
    <column name="OPTION1_ID" primaryKey="true" required="true" 
            type="INTEGER"/>
    <!--
        Child Option.
    -->
    <column name="OPTION2_ID" primaryKey="true" required="true" 
            type="INTEGER"/>
    <!--
        The type of relationship. See the SCARAB_OPTION_RELATIONSHIP
        table for the different types
    -->
    <column name="RELATIONSHIP_ID" required="true" type="INTEGER"/>
    <!--
        This gives "weight" to an option. In other words, it can be used
        to set the "importance" of one option vs. another option. P1 can 
        be made more "important" than P2. This is currently not used
        in any of the code. This may become more useful in 
        the future when we have outside workflow logic. This is placed 
        here because an Attribute Option may have different weights 
        with different parents.
    -->
    <column name="WEIGHT" required="false" type="INTEGER" javaType="primitive"/>
    <!--
        The preferred order that these options should be shown in.
        Each option should have a 1-N ordering for all of its
        options (regardless of nesting).
    -->
    <column name="PREFERRED_ORDER" required="true" type="INTEGER"
        javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OPTION1_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE_OPTION">
        <reference local="OPTION2_ID" foreign="OPTION_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_OPTION_RELATIONSHIP">
        <reference local="RELATIONSHIP_ID" foreign="RELATIONSHIP_ID"/>
    </foreign-key>
</table>

<!--
    User's choice of attributes to appear on the Issue List screen.
-->
<table name="SCARAB_R_MODULE_USER_ATTRIBUTE" idMethod="idbroker" 
        javaName="RModuleUserAttribute">
    <!--
        pk.
    -->
    <column name="RMUA_ID" primaryKey="true" required="true" type="BIGINT"/>

    <!--
        MITList .
    -->
    <column name="LIST_ID" required="false" type="BIGINT"/>
    <!--
        Module.
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"/>
    <!--
        Person.
    -->
    <column name="USER_ID" required="true" type="INTEGER"/>
    <!--
        Artifact type.
    -->
    <column name="ISSUE_TYPE_ID" required="false" type="INTEGER"/>
    <!--
        Attribute.
    -->
    <column name="ATTRIBUTE_ID" required="true" type="INTEGER"/>
    <!--
        Column order.
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="true" 
        default="0" type="INTEGER" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_MIT_LIST">
        <reference local="LIST_ID" foreign="LIST_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTRIBUTE">
        <reference local="ATTRIBUTE_ID" foreign="ATTRIBUTE_ID"/>
    </foreign-key>

    <unique>
        <unique-column name="LIST_ID"/>
        <unique-column name="MODULE_ID"/>
        <unique-column name="USER_ID"/>
        <unique-column name="ISSUE_TYPE_ID"/>
        <unique-column name="ATTRIBUTE_ID"/>
    </unique>
</table>

<!--
    Transaction is a group of attribute modification that are performed 
    together.
-->
<table name="SCARAB_TRANSACTION" idMethod="idbroker" javaName="ActivitySet">
    <!--
        Unique identifier.
    -->
    <column name="TRANSACTION_ID" primaryKey="true" required="true" type="BIGINT" javaName="ActivitySetId"/>
    <!--
        Possible enumerated activitySet type.
    -->
    <column name="TYPE_ID"  required="false" type="INTEGER"/>
    <!--
        Comment added to modification.
    -->
    <column name="ATTACHMENT_ID"  required="false" type="BIGINT"/>
    <!--
        Person that performed the activitySet.
    -->
    <column name="CREATED_BY" required="false" type="INTEGER"></column>
    <!--
        Date of the activitySet.
    -->
    <column name="CREATED_DATE" required="false" type="TIMESTAMP"></column>

    <foreign-key foreignTable="TURBINE_USER">
        <reference local="CREATED_BY" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_TRANSACTION_TYPE">
        <reference local="TYPE_ID" foreign="TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ATTACHMENT">
        <reference local="ATTACHMENT_ID" foreign="ATTACHMENT_ID"/>
    </foreign-key>
</table>

<!--
    Possible types of transactions.
    Example: Issue Created
    Example: Issue Moved
-->
<table name="SCARAB_TRANSACTION_TYPE" idMethod="idbroker" 
        javaName="ActivitySetType">
    <!--
        Unique identifier.
    -->
    <column name="TYPE_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Name.
    -->
    <column name="NAME" javaName="Name" required="true" type="VARCHAR" 
            size="100"/>
</table>


<!--
    Dummy table for where the USER_ID lives. In most cases, this will be a
    foreign table outside of the scope of Scarab itself. For example, if you are
    using Scarab with Turbine, then this will be defined as TURBINE_USER. For
    use in other systems, you will want to define this to be the name of your 
    own USER table and update the FK references in this file to point at the new 
    name. Then, all you need to do is regenerate the OR code to use the new 
    table name.
-->
<table name="TURBINE_USER" javaName="ScarabUserImpl" alias="TurbineUser" 
    baseClass="org.apache.fulcrum.security.impl.db.entity.TurbineUser"
    basePeer="org.apache.fulcrum.security.impl.db.entity.TurbineUserPeer"
    interface="ScarabUser">
    <!--
        Unique identifier.
    -->
    <column name="USER_ID" primaryKey="true" required="true" type="INTEGER"/>
</table>

<!--
    This table is used to store user preferences and other information
    relating to a specific user.
-->
<table name="SCARAB_USER_PREFERENCE" idMethod="none" javaName="UserPreference">
    <!--
        Unique identifier.
    -->
    <column name="USER_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        This is a column that Scarab standalone needs. Torque doesn't do anything
        with it at this point because this is an aliased table. Leaving it in
        here just as an FYI and in the hope that one day, Torque will generate
        the right methods even for aliased tables.
    -->
    <column name="PASSWORD_EXPIRE" type="TIMESTAMP"/>
    <column name="ENTER_ISSUE_REDIRECT" type="INTEGER" javaType="primitive"/>
    <column name="HOME_PAGE" type="VARCHAR" size="32"/>
    <!--
        Currently stores information in a format which conforms to
        the definition of the HTTP Accept-Language header.

        Real world examples:
            de-at,de;q=0.8,en-us;q=0.5,en;q=0.3
            en-us,en;q=0.5
            en-gb,en-us;q=0.5
            zh-cn
            de-de,de-ch;q=0.8,en-us;q=0.5,en;q=0.3
            en-us, en;q=0.50
            
        If this value cannot be parsed or is null, then the Modules default
        language will be used. If the Module does not have a default language
        then the JVM's default language will be used.
    -->
    <column name="LANGUAGE" type="VARCHAR" size="255"/>

    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    A user's record of votes.  It is assumed that a module that supports
    voting will give a new user some votes to use when the user is added, 
    otherwise the user has no votes. 
-->
<table name="SCARAB_USER_VOTE" idMethod="none" javaName="UserVote">
    <!--
        Module.
    -->
    <column name="MODULE_ID" primaryKey="true" required="true" type="INTEGER" />
    <!--
        Person.
    -->
    <column name="USER_ID" primaryKey="true" required="true" type="INTEGER" />
    <!--
        The total votes a user is allowed to cast in a project.
    -->
    <column name="TOTAL_VOTES" required="false" type="INTEGER" 
        default="0" size="3" javaType="primitive"/>
    <!--
        The number of votes a user has cast in a project.
    -->
    <column name="USED_VOTES" required="false" type="INTEGER" 
        default="0" size="3" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    The number of votes a user has cast for an issue.
-->
<table name="SCARAB_ISSUE_VOTE" idMethod="none" javaName="IssueVote">
    <!--
        Module.
    -->
    <column name="ISSUE_ID" primaryKey="true" required="true" type="BIGINT" />
    <!--
        Person.
    -->
    <column name="USER_ID" primaryKey="true" required="true" type="INTEGER" />
    <!--
        The votes a user has cast for the issue.
    -->
    <column name="VOTES" required="false" type="INTEGER" 
        default="0" size="3" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="ISSUE_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
</table>

<!--
    A saved user query.
-->
<table name="SCARAB_QUERY" idMethod="idbroker" javaName="Query">

    <column name="QUERY_ID" primaryKey="true" required="true" type="BIGINT"></column>
    <!--
        Person who created the query.
    -->
    <column name="USER_ID" required="true" type="INTEGER"></column>
    <!--
        The name the query will be saved under.
    -->
    <column name="NAME" required="true" type="VARCHAR" size="255" />

    <!--
        The description of the saved query.
    -->
    <column name="DESCRIPTION" required="false" type="VARCHAR" size="255" />
    <!--
        The query string.
    -->
    <column name="VALUE" required="true" type="LONGVARCHAR"  />

    <!--
        Type.
    -->
    <column name="SCOPE_ID" javaName="ScopeId" required="true" type="INTEGER"></column>
    <!--
        Issue type.
    -->
    <column name="ISSUE_TYPE_ID" required="false" type="INTEGER"></column>
    <!--
        Module.
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"></column>
    <!--
        List id.  Either issuetype/module id or list_id is used.
    -->
    <column name="LIST_ID" required="false" type="BIGINT"></column>

    <column name="DELETED" required="false" type="BOOLEANINT" 
            default="0" size="1" javaType="primitive"/>
    <column name="APPROVED" required="false" type="BOOLEANINT"
            default="0" size="1" javaType="primitive"/>
    <column name="CREATED_DATE" required="false" type="TIMESTAMP"></column>
    <!--
        Default subscription frequency.
    -->
    <column name="SUBSCRIPTION_FREQUENCY_ID" required="false" type="INTEGER" />
    <!--
        Whether or not this query should show up on the homepage.
    -->
    <column name="HOME_PAGE" javaName="HomePage" required="false"
            default="0" size="1" type="BOOLEANINT" javaType="primitive"/>
    <!--
        The order in which the user wants to see the queries in the home page
    -->
    <column name="PREFERRED_ORDER" javaName="Order" required="false"
            default="0" type="INTEGER" javaType="primitive"/>

    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_SCOPE">
        <reference local="SCOPE_ID" foreign="SCOPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MIT_LIST">
        <reference local="LIST_ID" foreign="LIST_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_FREQUENCY">
        <reference local="SUBSCRIPTION_FREQUENCY_ID" foreign="FREQUENCY_ID"/>
    </foreign-key>
</table>

<!--
    Users subscribed to a query.
-->
<table name="SCARAB_R_QUERY_USER" idMethod="none" 
        javaName="RQueryUser">
    <!--
        Query.
    -->
    <column name="QUERY_ID" primaryKey="true" required="true" type="BIGINT"></column>
    <!--
        Person subscribed to a query (might not be the person who created it).
    -->
    <column name="USER_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Is user subscribed.
    -->
    <column name="IS_SUBSCRIBED" required="false" type="BOOLEANINT" 
            default="0" size="1" javaType="primitive"/>
    <!--
        User's subscription frequency.
    -->
    <column name="SUBSCRIPTION_FREQUENCY_ID" javaName="SubscriptionFrequency" required="false" type="INTEGER" ></column>
    <!--
        Whether this is the user's default query.
    -->
    <column name="ISDEFAULT" required="false" type="BOOLEANINT" 
            default="0" size="1" javaType="primitive"/>

    <foreign-key foreignTable="SCARAB_QUERY">
        <reference local="QUERY_ID" foreign="QUERY_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_FREQUENCY">
        <reference local="SUBSCRIPTION_FREQUENCY_ID" foreign="FREQUENCY_ID"/>
    </foreign-key>
</table>

<!--
    Frequencies of an event.
    Examples: every half hour, weekly
-->
<table name="SCARAB_FREQUENCY" idMethod="none" javaName="Frequency">
    <!--
        Unique identifier.
    -->
    <column name="FREQUENCY_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="FREQUENCY_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
</table>

<!--
    A saved user template for entering issues.
-->
<table name="SCARAB_ISSUE_TEMPLATE_INFO" idMethod="none" javaName="IssueTemplateInfo">

    <column name="ISSUE_ID" primaryKey="true" required="true" type="BIGINT"></column>
    <!--
        Person.
    -->
    <column name="NAME" required="true" type="VARCHAR" size="255" />

    <!--
        The description of the saved template.
    -->
    <column name="DESCRIPTION" required="false" type="VARCHAR" size="255" />
    <column name="ATTACHMENT_TYPE_ID" javaName="TypeId" required="true" type="INTEGER"></column>
    <column name="APPROVED" required="false" type="BOOLEANINT"
            default="0" size="1" javaType="primitive"/>
    <!--
        Scope : personal or global.
    -->
    <column name="SCOPE_ID" javaName="ScopeId" required="true" type="INTEGER"></column>
    <foreign-key foreignTable="SCARAB_ISSUE">
        <reference local="ISSUE_ID" foreign="ISSUE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_SCOPE">
        <reference local="SCOPE_ID" foreign="SCOPE_ID"/>
    </foreign-key>
</table>

<!--
    Scope: personal, global.
-->
<table name="SCARAB_SCOPE" idMethod="none" javaName="Scope">
    <!--
        Unique identifier.
    -->
    <column name="SCOPE_ID" primaryKey="true" required="true" type="INTEGER"></column>
    <!--
        Name.
    -->
    <column name="SCOPE_NAME" javaName="Name" required="true" type="VARCHAR" size="255"></column>
</table>

<!--
    A saved report.
-->
<table name="SCARAB_REPORT" idMethod="idbroker" javaName="Report">

    <column name="REPORT_ID" primaryKey="true" required="true" type="INTEGER"/>
    <!--
        Person.
    -->
    <column name="USER_ID" required="true" type="INTEGER"/>
    <!--
        Module.
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"/>
    <!--
        Issue type.
    -->
    <column name="ISSUE_TYPE_ID" required="true" type="INTEGER"></column>
    <!--
        The name the report will be saved under.
    -->
    <column name="NAME" required="true" type="VARCHAR" size="255"/>

    <!--
        The description of the saved report.
    -->
    <column name="DESCRIPTION" required="false" type="VARCHAR" size="255"/>

    <!--
        The report string.
    -->
    <column name="QUERY_STRING" required="true" type="LONGVARCHAR"/>

    <!--
        Type.
    -->
    <column name="SCOPE_ID" javaName="ScopeId" required="true" type="INTEGER"/>

    <column name="DELETED" required="false" type="BOOLEANINT" 
            default="0" size="1" javaType="primitive"/>
    <column name="CREATED_DATE" required="false" type="TIMESTAMP"/>

    <foreign-key foreignTable="SCARAB_ISSUE_TYPE">
        <reference local="ISSUE_TYPE_ID" foreign="ISSUE_TYPE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="TURBINE_USER">
        <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_SCOPE">
        <reference local="SCOPE_ID" foreign="SCOPE_ID"/>
    </foreign-key>
</table>


<table name="SCARAB_PENDING_GROUP_USER_ROLE" javaName="PendingGroupUserRole">
    <column name="USER_ID" required="true" primaryKey="true" type="INTEGER"/>
    <column name="GROUP_ID" required="true" primaryKey="true" type="INTEGER"/>
    <column name="ROLE_NAME" required="true" primaryKey="true" 
        type="VARCHAR" size="255"/>
  
    <foreign-key foreignTable="TURBINE_USER">
      <reference local="USER_ID" foreign="USER_ID"/>
    </foreign-key>
    <foreign-key foreignTable="SCARAB_MODULE">
      <reference local="GROUP_ID" foreign="MODULE_ID"/>
    </foreign-key>
</table>

<table name="SCARAB_GLOBAL_PARAMETER" idMethod="idbroker" 
       javaName="GlobalParameter">
    <column name="PARAMETER_ID" required="true" primaryKey="true" 
        type="INTEGER"/>
    <column name="NAME" required="true" type="VARCHAR" size="255"/>
    <column name="VALUE" required="true" type="VARCHAR" size="255"/>
    <!--
       Module id can be null, if the parameter is not module related.
       Module id can be 0, if it is to be a default if a given module
       does not have a more specific value
    -->
    <column name="MODULE_ID" required="false" type="INTEGER"/>
    <foreign-key foreignTable="SCARAB_MODULE">
        <reference local="MODULE_ID" foreign="MODULE_ID"/>
    </foreign-key>
</table>

</database>
