<project name="TestRun" default="main" init="init">

   <target name="init">
     <property name="host" value="localhost" />
     <property name="port"     value="8080" />
     <property name="tomcat.home" value="." />
     <property name="gdir" value="${tomcat.home}/lib/test/Golden" />

     <taskdef name="gtest" class="org.apache.tomcat.task.GTest" />
   </target>

  <!-- ==================== File tests ==================== -->
  <target name="file">
    <gtest description="Content Type Test"
           request="GET /test/binaries/image1.gif HTTP/1.0"
           expectHeaders="Content-Type:image/gif" />

    <gtest description="File Integrity and Length Test"
           request="GET /test/binaries/image1.gif HTTP/1.0"
           goldenFile="${gdir}/image1.gif"
           exactMatch="true"  />

    <gtest description="Welcome File Test1"
           request="GET /test/welcome HTTP/1.0"
           expectHeaders="Location:/welcome/" 
           returnCode="HTTP/1.0 302" />

    <gtest description="Welcome File Test2"
           request="GET /test/binaries HTTP/1.0"
           returnCode="HTTP/1.0 200" />
 
    <gtest description="Welcome File Test3"
           request="GET /test/welcome/ HTTP/1.0"
           returnCode="HTTP/1.0 200" 
           goldenFile="${gdir}/welcome.txt" />
 
   </target>

  <!-- ==================== Dispatch tests ==================== -->
    <target name="dispatch">
      <gtest description="SimpleRedirect"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?/index.html HTTP/1.0"
             expectHeaders="Location:http://${host}:${port}/index.html" 
             returnCode="HTTP/1.0 302" 
       />
      <gtest description="SimpleRedirect2"
             request="GET /test/servlet/dispatch.SimpleRedirectServlet?index.html HTTP/1.0"
             expectHeaders="Location:http://${host}:${port}/test/servlet/index.html" 
             returnCode="HTTP/1.0 302" 
       />
      <gtest description="SimpleInclude"
             request="GET /test/servlet/dispatch.SimpleIncludeServlet HTTP/1.0"
             expectHeaders="Content-Type:text/foobar" 
             returnCode="HTTP/1.0 200"
             goldenFile="${gdir}/SimpleInclude.txt" 
       />
      <gtest description="SimpleForward"
             request="GET /test/servlet/dispatch.SimpleForwardServlet HTTP/1.0"
             expectHeaders="Content-Type:text/funky" 
             returnCode="HTTP/1.0 200"
             goldenFile="${gdir}/SimpleForward.txt" 
       />
      <gtest description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="PreInclude" 
       />
      <gtest description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="PostInclude" 
       />
      <gtest description="PrintWriterTest"
             request="GET /test/servlet/dispatch.PrintWriterTest1Servlet HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="Included servlet error: 500" 
       />
      <gtest description="Mismatch2"
             request="GET /test/servlet/dispatch.Mismatch2 HTTP/1.0"
             returnCode="HTTP/1.0 200"
             goldenFile="${gdir}/Mismatch2.txt" 
       />

      <gtest description="IncludeMismatch1-1"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="LINE1" 
       />

      <gtest description="IncludeMismatch1-2"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="error: 500" 
       />

      <gtest description="IncludeMismatch1-3"
             request="GET /test/servlet/dispatch.IncludeMismatch1 HTTP/1.0"
             returnCode="HTTP/1.0 200"
             responseMatch="LINE1" 
       />

      <gtest description="IncludeFile"
             request="GET /test/servlet/dispatch.IncludeFileServlet HTTP/1.0"
             returnCode="HTTP/1.0 200"
             expectHeaders="Content-Type:text/foobar" 
             goldenFile="${gdir}/IncludeFile.txt" 
       />

      <gtest description="ForwardWithQuery"
             request="GET /test/servlet/dispatch.ForwardWithQueryServlet?name=Sun%20Microsystems&amp;age=100000&amp;city=Cupertino HTTP/1.0"
             returnCode="HTTP/1.0 200"
             expectHeaders="Content-Type:text/funky" 
             goldenFile="${gdir}/ForwardWithQuery.txt" 
       />

    

    </target>

  <!-- ==================== Jsp tests ==================== -->
  <target name="jsp">
    <gtest request="GET /test/jsp/HelloWorld.jsp HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
    />

    <gtest request="GET /test/doesNotExist.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/ HTTP/1.0"
           goldenFile="${gdir}/index.txt"  
           description="Serves index.html"
    />

    <gtest request="GET /test/jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           description="Getting -- HTTP/1.0 302 Found"
           magnitude="false" />

    <gtest request="GET /test/.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/HelloWorld.jsp?????? HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
           debug="0"
    />

    <gtest request="GET /test/jsp/HelloWorld.jsp?a=b&amp;c=d HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
           debug="0"
    />

    <gtest request="GET /test/jsp/HelloWorld.jsp?&amp;&amp; HTTP/1.0"
           goldenFile="${gdir}/HelloWorld.txt"
    />

    <gtest request="GET /test/jsp/declaration/IntegerOverflow.jsp HTTP/1.0"
           returnCode="HTTP/1.0 500 Internal Server Error"
           debug="0"
    />

    <gtest request="GET /test/jsp/error/err.jsp HTTP/1.0"
           goldenFile="${gdir}/Err.txt"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/forward/forward.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/jsptoserv/jsptoservlet.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/jsptoservlet.txt"
    />

    <gtest request="GET /test/jsp/initDestroy.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/classTest.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/classTest.txt"
    />

    <gtest request="GET /test/jsp/import.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/import.txt"
    />

    <gtest request="GET /test/jsp/buffer.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/buffer.txt"
    />

    <gtest request="GET /test/jsp/buffer1.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/buffer2.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/buffer3.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/buffer4.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/comments.jsp HTTP/1.0"
           returnCode="HTTP/1.0 500 Internal Server Error"
    />

    <gtest request="GET /test/jsp/parse.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/parse.txt"
    />

    <gtest request="GET /test/jsp/pageInfo.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageLanguage.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageIsThreadSafe.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageSession.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageAutoFlush.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageError.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/pageExtends.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageIsErrorPage.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageContentType.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/pageImport2.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageImport.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/pageImport.txt"
    />

    <gtest request="GET /test/jsp/beanTest1.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/beanTest.txt"
    />

    <gtest request="GET /test/jsp/beanTest2.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/beanScopePage.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/beanScopeSession.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           debug="0"
    />

    <gtest request="GET /test/jsp/implicitOut.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitOut.txt"
    />

    <gtest request="GET /test/jsp/implicitConfig.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitConfig.txt"
    />

    <gtest request="GET /test/jsp/implicitException.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitException.txt"
    />

    <gtest request="GET /test/jsp/implicitPageContext.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitPageContext.txt"
    />

    <gtest request="GET /test/jsp/implicitContext.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitContext.txt"
    />

    <gtest request="GET /test/jsp/implicitRequest.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitRequest.txt"
    />

    <gtest request="GET /test/jsp/implicitResponse.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitResponse.txt"
    />

    <gtest request="GET /test/jsp/implicitSession.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitSession.txt"
    />

    <gtest request="GET /test/jsp/implicitPageContext.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/implicitPageContext.txt"
    />

    <gtest request="GET /test/jsp/pageInvalid.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageDouble.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/pageContent3.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/servlet/servletParam1 HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/servletParam1.txt"
    />

    <gtest request="GET /test/servlet/servletParam2 HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/servletParam2.txt"
    />

    <gtest request="GET /test/servlet/ServletParam HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/ServletParam.txt"
    />

    <gtest request="GET /test/jsp/bigDeclaration.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

    <gtest request="GET /test/jsp/include/include.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           goldenFile="${gdir}/Include.txt"
    />
 
    <gtest request="GET /test/jsp/chinese.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

   <gtest request="GET /test/jsp/japanese.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

   <gtest request="GET /test/jsp/extend1.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" 
    />

   <gtest request="GET /test/jsp/extend2.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" 
    />

   <gtest request="GET /test/jsp/extend3.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

   <gtest request="GET /test/jsp/extend4.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
    />

   </target>

  <target name="wrong_request">
    <gtest request="GET /test/*.jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET *jsp HTTP/1.0"
           returnCode="HTTP/1.0 200 OK"
           magnitude="false" />

    <gtest request="GET /test/jsp/HelloWorld.jsp HTTP"
           returnCode="HTTP/1.0 400"
    />

    <gtest request="GET /test/jsp/HelloWorld.jsp 1.0"
           returnCode="HTTP/1.0 400"
    />

    <gtest request="GET /test/jsp/HelloWorld.jsp /1.0"
           returnCode="HTTP/1.0 400"
    />

  </target>



   <target name="get">
      <gtest request="GET /test/servlet/Cookie25 HTTP/1.0"
             expectHeaders="Set-Cookie2: foo=bar;Version=1;MaxAge=8640000"
      />

      <gtest request="GET /test/servlet/ResponseError HTTP/1.0"
             returnCode="HTTP/1.0 400"
             responseMatch="Wrong data"
      />

      <gtest request="GET /test/request/uri/does/not/exist"
             responseMatch="Error: 404"
      />

      <gtest request="GET /test/request/uri/does/not/exist HTTP/1.0"
             returnCode="HTTP/1.0 404 Not Found"
      />

      <gtest request="GET /test/"
             returnCode="Error: "
             magnitude="false" />

      <gtest request="   GET   /   "
             returnCode="Error: "
             magnitude="false" />

      <gtest request="GET /test/ HTTP/1.0"
             returnCode="HTTP/1.0 200 OK"
      />

      <gtest request="   GET   /   HTTP/1.0"
             returnCode="HTTP/1.0 200 OK"
      />

      <gtest request="GET /test/index.ht ml HTTP/1.0"
             returnCode="HTTP/1.0 400 Bad Request"
      />

      <gtest request="   GET   /index.ht ml HTTP/1.0 "  
             returnCode="HTTP/1.0 400 Bad Request"
      />


      <gtest request="GET /test/servlet HTTP/1.0"
             returnCode="HTTP/1.0 404 Not Found"
      />

      <gtest request="GET /test/servlet/ HTTP/1.0"
             returnCode="HTTP/1.0 404"
      />

      <gtest request="GET /test/servlet/foo HTTP/1.0"
             returnCode="HTTP/1.0 404 Not Found"
      />

      <gtest request="GET /test/welcome HTTP/1.0"
             returnCode="HTTP/1.0 302"
      />


   </target>


   <target name="requestMap">
      <gtest description="/foo/bar/index.html : 1.0 : 200"
             request="GET /test/foo/bar/index.html HTTP/1.0"
             responseMatch="Servlet: Servlet1"
            />

      <gtest description="/foo/bar/index.bop : 1.0 : 200"
             request="GET /test/foo/bar/index.bop HTTP/1.0"
             responseMatch="Servlet: Servlet1"
            />

      <gtest description="/baz : 1.0 : 200"
             request="GET /test/baz HTTP/1.0"
             responseMatch="Servlet: Servlet2"
            />

      <gtest description="/baz/index.html : 1.0 : 200"
             request="GET /test/baz/index.html HTTP/1.0"
             responseMatch="Servlet: Servlet2"
            />

      <gtest description="/catalog : 1.0 : 200"
             request="GET /test/catalog HTTP/1.0"
             responseMatch="Servlet: Servlet3"
            />

      <gtest description="/catalog/index.html : 1.0 : 200"
             request="GET /test/catalog/index.html HTTP/1.0"
             returnCode="HTTP/1.0 404 Not Found"
             />

      <gtest description="/catalog/racecar.bop : 1.0 : 200"
             request="GET /test/catalog/racecar.bop HTTP/1.0"
             responseMatch="Servlet: Servlet4"
            />

      <gtest description="/index.bop : 1.0 : 200"
             request="GET /test/index.bop HTTP/1.0"
             responseMatch="Servlet: Servlet4"
            />
   </target>

   <target name="post">
      <gtest request="POST /test/servlet/request.NotThere HTTP/1.0"
             content="name=lightness of being"
             returnCode="HTTP/1.0 404 Not Found"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="GHOST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="HTTP/1.0 501 Not Implemented"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HT TP/1.0"
             content="name=lightness of being"
             returnCode="Error: 400"
            />

      <gtest request="POST "
             content="name=lightness of being"
             returnCode="Error: 400"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content=""
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST /test/servlet HTTP/1.0"
             content=""
             returnCode="HTTP/1.0 404 Not Found"
            />

      <gtest request="POST /test/servlet/ HTTP/1.0"
             content=""
             returnCode="HTTP/1.0 404"
            />

      <gtest request="POST /test/ HTTP/0.9"
             content=""
             returnCode="HTTP/1.0 400 Bad Request"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/0.9"
             content="name=lightness of being"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/0.9"
             content="name=lightness of being,,,,,,,....###///&amp;&amp;@@@@@***"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/0.9"
             content="name=lightness of being,,,,,,,....###///&amp;&amp;&amp;&amp;@@@@@***"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST \/test/servlet/request.EchoServlet?name=sun&amp;age=2000 HTTP/0.9"
             content="name=lightness of being,,,,,,,....###///&amp;@@@@@***"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST \ HTTP/0.9"
             content="name=lightness of being"
             returnCode="Error: 400"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="post /test/servlet/request.EchoServlet HTTP/1.0"
             content="name=lightness of being"
             returnCode="HTTP/1.0 501 Not Implemented"
            />

      <gtest request="GET http://www.javasoft.com/index.html HTTP/1.0   "
             returnCode="HTTP/1.0 400 Bad Request"
            />

      <gtest request="POST /test/servlet/request.EchoServlet HTTP/1.0"
             headers="Content-Encoding: x-gzip"
             content="name=lightness of being"
             returnCode="HTTP/1.0 200 OK"
            />

      <gtest request="POST /test/servlet/request.EchoServlet    HTTP/4.4"
             content="name=lightness of being"
             returnCode="HTTP/1.0 200 OK"
            />
   </target>


   <target name="startup">
     <java class="org.apache.tomcat.startup.Tomcat" args="" />
   </target>


   <target name="client" depends="file,dispatch,get,requestMap,post,jsp,wrong_request">
   </target>


   <target name="shutdown">
     <java class="org.apache.tomcat.startup.Tomcat" args="-stop" />
   </target>


   <target name="main" depends="startup,client,shutdown" />


</project>

